stimport="";
function LoadSister_357FC8E() 
if UnitAffectingCombat("player") == nil then

	local temp = CreateFrame('Button', 'wowamSister',UIParent, 'SecureActionButtonTemplate');
	temp:SetAttribute('type', 'macro');
	temp:SetAttribute('macrotext','/run type(1)' .. string.rep(' ', 544));
	SetOverrideBindingClick(temp, true,'Insert',temp:GetName());
	LoadSister_357FC8E_Loaded_Variable = true --避免衝突
	--print("Loaded!")
end
end
local function LoadCommonScript()
RunScript("\r\nif IsLoad_runspell then\r\n\treturn;\r\nend\r\n\r\nlocal GetEclipseDirection = _G.GetEclipseDirection;\r\nlocal UnitGUID = _G.UnitGUID;\r\nlocal UnitName = _G.UnitName;\r\nlocal GetActionCooldown = _G.GetActionCooldown;\r\nlocal UnitIsUnit = _G.UnitIsUnit;\r\n\r\n--local temp = CreateFrame('Button', 'wowamSister',UIParent, 'SecureActionButtonTemplate');\r\n--temp:SetAttribute('type', 'macro');\r\n--temp:SetAttribute('macrotext','/run type(1)' .. string.rep(' ', 544));\r\n--SetOverrideBindingClick(temp, true,'Insert',temp:GetName());\r\n\r\n------------------------------\r\nlocal stime=GetTime();\r\nam_index={};\r\nfor i=1 , 700 do am_index[i]=0;end;\r\nam_index[1]=tonumber(\"910000000010\");\r\nam_index[300]=tonumber(\"820000000010\");\r\nam_index[2]=100;\r\n\r\nlocal tempFrame = CreateFrame(\"Frame\");\r\ntempFrame:RegisterEvent(\"PLAYER_LOGOUT\")\t\r\ntempFrame:RegisterEvent(\"PLAYER_LOGIN\")\r\n\r\n\r\nlocal function tempFrame_OnEvent(self, event, ...)\r\n\t\r\n\tif ( event == \"PLAYER_LOGIN\" )  then\r\n\t\r\n\t\tam_index[2]=100;\r\n\telseif ( event == \"PLAYER_LOGOUT\" )  then\r\n\t\tam_index[2]=101;\r\n\t\tam_index[1]=0;\r\n\tend\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\n\r\nlocal function tempFrame_OnUpdate()\r\n\t\r\n\t\t\r\n\tif am_index[3]==100 then\r\n\t\tam_index[3]=101;\r\n\t\t\t\r\n\tend\r\n\t\r\n\tif am_index[4]~=0 and GetTime() - stime>0.5 then\r\n\t\tam_index[4]=0;\r\n\t\tstime=GetTime();\r\n\tend\r\n\t\r\n\tif am_index[4]==0 then\r\n\t\tstime=GetTime();\r\n\tend\r\n\t\r\nend\r\n\r\n\r\ntempFrame:SetScript(\"OnEvent\", tempFrame_OnEvent);\r\ntempFrame:SetScript(\"OnUpdate\",tempFrame_OnUpdate)\r\n\r\n-----------------------------\r\n\r\nfunction Wowam_Runsp_old(spell,Type)\r\n\t\r\n\t--spell=gsub(spell,\"\\n\", \"\\\\n\");\r\n\t\r\n\t--spell = '/amRunMacro(\"' .. spell .. '\")';\r\n\tif am_index[4] ~=0 then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\tlocal length = string.len(spell)\r\n\t\r\n\tif length>200 then\r\n\t\tDEFAULT_CHAT_FRAME:AddMessage(\"請縮短命令!\",192,0,192,0)\r\n\t\treturn;\r\n\tend\r\n\t\r\n\tfor i=1 , length do\r\n\t\r\n\t\tam_index[i+10]=string.byte(spell, i);\t\t\r\n\t\r\n\tend\r\n\tam_index[length+1+10]=0;\r\n\t\r\n\tif not Type then\r\n\t\tam_index[4]=101;\r\n\t\r\n\telse\r\n\t\tam_index[4]=1000 + tonumber(Type);\r\n\tend\r\n\t\r\n\tstime=GetTime();\t\r\nend\r\n\r\n-----------------------------\r\nlocal isLoadAffDots=false;\r\n\r\nlocal function AffDots_OnEnter(self)\r\n\t\r\n\tGameTooltip:SetOwner(self, \"ANCHOR_BOTTOMRIGHT\");\r\n\tGameTooltip:ClearLines();\r\n\t\r\n\tGameTooltip:AddLine(\"|T\" ..self.icon:GetTexture()..\":16|t 第\".. self.index .. \"个返回值\");\r\n\tGameTooltip:Show()\r\nend\r\n\r\nlocal function AffDots_OnLeave(self)\r\n\tGameTooltip:ClearLines();\r\n\tGameTooltip:Hide()\r\nend\r\n\r\nlocal function AffDotsFrame_OnUpdate()\r\n\t\r\n\tif AffDotsTarget and not isLoadAffDots then \r\n\t\tlocal m= AffDotsTarget;\r\n\t\t\r\n\t\tfor i =1 , 6 do\r\n\t\t\r\n\t\t\tlocal f = m[\"f\"..i]\r\n\t\t\tif f and type(f) == \"table\" and m[\"f\"..i].t1 then\r\n\t\t\t\tf:SetScript(\"OnEnter\", AffDots_OnEnter)\r\n\t\t\t\tf:SetScript(\"OnLeave\", AffDots_OnLeave)\r\n\t\t\t\tf.index=i;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\tm= AffDotsFocus;\r\n\t\t\r\n\t\tfor i =1 , 6 do\r\n\t\t\r\n\t\t\tlocal f = m[\"f\"..i]\r\n\t\t\tif f and type(f) == \"table\" and m[\"f\"..i].t1 then\r\n\t\t\t\tf:SetScript(\"OnEnter\", AffDots_OnEnter)\r\n\t\t\t\tf:SetScript(\"OnLeave\", AffDots_OnLeave)\r\n\t\t\t\tf.index=i;\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\tisLoadAffDots=true;\r\n\tend\r\n\t\r\nend\r\n\r\n\r\nlocal AffDotsFrame = CreateFrame(\"Frame\");\r\nAffDotsFrame:SetScript(\"OnUpdate\", AffDotsFrame_OnUpdate);\r\nfunction amAffDots(target)\r\n\t\r\n\t\r\n\tif not target then\r\n\t\r\n\t\treturn -1,-1,-1,-1,-1,-1;\r\n\t\t\r\n\tend\r\n\t\t\r\n\tif not AffDotsTarget then\r\n\t\tprint(\"|cffff0000请安装AffDots插件！\");\r\n\t\treturn -1,-1,-1,-1,-1,-1;\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif target == 0 and UnitName(\"Target\") then\r\n\t\tif AffDotsTarget:IsShown() then\r\n\t\t\r\n\t\t\tlocal m= AffDotsTarget;\r\n\t\t\r\n\t\t\tfor i =1 , 6 do\r\n\t\t\t\r\n\t\t\t\tlocal f = m[\"f\"..i]\r\n\t\t\t\tif f and type(f) == \"table\" and m[\"f\"..i].t1 then\r\n\t\t\t\t\tf.value = tonumber(f.t1:GetText()) or -1;\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\treturn m.f1.value or -1,\r\n\t\t\tm.f2.value or -1,\r\n\t\t\tm.f3.value or -1,\r\n\t\t\tm.f4.value or -1,\r\n\t\t\tm.f5.value or -1,\r\n\t\t\tm.f6.value or -1;\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tif target == 1 and UnitName(\"Focus\") then\r\n\t\tif AffDotsFocus:IsShown() then\r\n\t\t\r\n\t\t\tlocal m= AffDotsFocus;\r\n\t\t\r\n\t\t\tfor i =1 , 6 do\r\n\t\t\t\r\n\t\t\t\tlocal f = m[\"f\"..i]\r\n\t\t\t\tif f and type(f) == \"table\" and m[\"f\"..i].t1 then\r\n\t\t\t\t\tf.value = tonumber(f.t1:GetText()) or -1;\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\treturn m.f1.value or -1,\r\n\t\t\tm.f2.value or -1,\r\n\t\t\tm.f3.value or -1,\r\n\t\t\tm.f4.value or -1,\r\n\t\t\tm.f5.value or -1,\r\n\t\t\tm.f6.value or -1;\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\t\r\n\treturn -1,-1,-1,-1,-1,-1;\r\n\t\r\n\t\r\nend\r\n\r\nfunction amClickExtraActionButton1()\r\n\tamrun(\"/click ExtraActionButton1\");\r\n\treturn true;\r\nend\r\n\r\n\r\nfunction amExtraActionBarCooldown()\r\n\r\n\tlocal isname = nil;\r\n\r\n\tlocal a,b,c = GetActionCooldown(121) \r\n\t\r\n\tif a then\r\n\t\tisname=1;\r\n\telse\r\n\t\tisname=nil;\r\n\t\treturn -1,isname;\r\n\tend\r\n\t\r\n\tif c ==0 or not a then\r\n\t\treturn -1,isname;\r\n\tend\r\n\t\t\r\n\t\tn = a+b-GetTime()\r\n\t\r\n\t\tif n<0 then\r\n\t\t\tn=0\r\n\t\tend\r\n\t\t\r\n\t\treturn n,isname;\r\nend\r\n\r\nlocal function findAffDots(tbl,target,spell)\r\n\tfor i, v in pairs(tbl) do\r\n\t\tif (v[\"target\"]==target and v[\"name\"]==spell) or \r\n\t\t(v[\"target\"]==target and v[\"spell\"]==spell) then\r\n\t\t\r\n\t\t\treturn v[\"t1\"];\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\treturn false;\r\n\t\r\nend\r\n\r\nfunction amAffDotsVer120(target,spell)\r\n\r\n\tif tonumber(spell) then\r\n\t\tspell = tonumber(spell);\r\n\tend\r\n\t\r\n\t\r\n\r\n\tif not target or not spell or (type(spell) == \"string\" and not UnitName(target)) then\r\n\t\r\n\t\treturn -1;\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tif not AffDots then\r\n\t\tprint(\"|cffff0000请安装AffDots插件！\");\r\n\t\treturn -1;\r\n\tend\r\n\t\r\n\tif not AffDots.amtrack then\r\n\t\tprint(\"|cffff0000请安装魔兽助手专用的AffDots插件！\");\r\n\t\treturn -1;\r\n\tend\r\n\t\r\n\tlocal tar=\"\";\r\n\r\n\tif UnitIsUnit(target, \"target\") or target == 0 then\r\n\t\ttar =  \"target\";\r\n\telseif UnitIsUnit(target, \"focus\") or target == 1 then\r\n\t\ttar =  \"focus\";\r\n\t\t\r\n\telse\r\n\t\treturn -1;\r\n\tend\r\n\t\r\n\tlocal f;\r\n\t\r\n\tif AffDotsTarget:IsShown() and tar == \"target\" then\r\n\t\r\n\t\tf = findAffDots(AffDots.amtrack,tar,spell)\r\n\t\t\t\r\n\telseif AffDotsFocus:IsShown() and tar == \"focus\" then\r\n\t\t\r\n\t\tf = findAffDots(AffDots.amtrack,tar,spell)\r\n\t\r\n\telse\r\n\t\treturn -1;\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif f then\r\n\t\r\n\t\treturn tonumber(f:GetText()) or -1;\r\n\telse\r\n\t\treturn -1;\r\n\tend\r\n\t\t\r\n\t\r\n\t\r\n\t\r\nend\r\n\r\nlocal FunType = {\r\n\tIsFaceTarget = 1,\r\n\tIsFaceFocus = 2,\r\n\tPlayerTargetDistance = 3,\r\n\tPetPlayerDistance = 4,\r\n\r\n\tPetTargetDistance = 5,\r\n\tPetFocusDistance = 6,\r\n\tTargetFocusDistance = 7,\r\n\tPetPetTargetDistance = 8,\r\n\r\n\tGetRangeUnitCount = 9,\r\n\tGetRangeRadianUnitCount = 10,\r\n\tGetUnitDistance = 11\r\n}      \r\n\r\nlocal FunOffsets = 300;\r\n\t\r\nlocal FunIndex = {\r\n\tRefreshInf = 2 + FunOffsets,\r\n\tIsFaceTarget = 11 + FunOffsets,\r\n\tIsFaceFocus = 14 + FunOffsets,\r\n\tPlayerTargetDistance = 17 + FunOffsets,\r\n\tPetPlayerDistance = 20 + FunOffsets,\r\n\tPetTargetDistance = 23 + FunOffsets,\r\n\tPetFocusDistance = 26 + FunOffsets,\r\n\tTargetFocusDistance = 29 + FunOffsets,\r\n\tPetPetTargetDistance = 32 + FunOffsets,\r\n\t\r\n\tCustom1 = 35 + FunOffsets,\r\n\tCustom2 = 50 + FunOffsets,\t\r\n\tCustom3 = 65 + FunOffsets,\r\n\tCustom4 = 80 + FunOffsets,\r\n\tCustom5 = 95 + FunOffsets,\r\n\tCustom6 = 110 + FunOffsets,\r\n\tCustom7 = 125 + FunOffsets,\r\n\tCustom8 = 140 + FunOffsets,\r\n\tCustom9 = 155 + FunOffsets,\r\n\tCustom10 = 170 + FunOffsets,\r\n\tCustom11 = 185 + FunOffsets,\r\n\tCustom12 = 200 + FunOffsets,\r\n\tCustom13 = 215 + FunOffsets,\r\n\tCustom14 = 230 + FunOffsets,\r\n\tCustom15 = 245 + FunOffsets,\r\n\tCustom16 = 260 + FunOffsets,\r\n\tCustom17 = 275 + FunOffsets,\r\n\tCustom18 = 290 + FunOffsets,\r\n\tCustom19 = 305 + FunOffsets,\r\n\tCustom20 = 320 + FunOffsets\r\n\t\r\n}\r\n\r\nlocal UnitIndex = {\r\n\tplayer = 1,\r\n\tpet = 2,\r\n\ttarget = 3,\r\n\tfocus = 4\r\n}\r\n\r\nlocal function GetFun_3(FunType,FunIndex)\r\n\t\r\n\tam_index[FunIndex] = FunType;\r\n\t\r\n\tif FunType == 0 then return -1; end;\r\n\t\r\n\t\t\t\r\n\tif am_index[FunIndex + 1] == 1 then\r\n\t\treturn am_index[FunIndex + 2];\r\n\tend\r\n\t\r\n\treturn -1;\r\nend\r\n\r\n\r\n\r\n\r\n--面对当前目标，面对返回1,后背0，没目标-1\r\nfunction amIsFaceTarget(Switch)\r\n\r\n\r\n\tif Switch ==1 or Switch == nil then\t\r\n\t\tSwitch = FunType.IsFaceTarget;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFun_3(Switch ,FunIndex.IsFaceTarget) or -1;\r\nend\r\n--面对焦点，面对返回1,后背0，没目标-1\r\nfunction amIsFaceFocus(Switch)\r\n\t\r\n\tif Switch ==1 or Switch == nil then\t\r\n\t\tSwitch = FunType.IsFaceFocus;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\treturn GetFun_3(Switch,FunIndex.IsFaceFocus) or -1;\r\nend\r\n\r\n--------\r\n--我到当前目标的距离\r\nfunction amPlayerTargetDistance(Switch)\r\n\t\r\n\tif Switch ==1 or Switch == nil then\t\t\r\n\t\tSwitch = FunType.PlayerTargetDistance;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFun_3(Switch ,FunIndex.PlayerTargetDistance) or -1;\r\nend\r\n--我到宠物的距离\r\nfunction amPetPlayerDistance(Switch)\r\n\r\n\tif Switch ==1 or Switch == nil then\t\t\r\n\t\tSwitch = FunType.PetPlayerDistance;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFun_3(Switch ,FunIndex.PetPlayerDistance) or -1;\r\nend\r\n--宠物到当前目标的距离\r\nfunction amPetTargetDistance(Switch)\r\n\r\n\tif Switch ==1 or Switch == nil then\t\t\r\n\t\tSwitch = FunType.PetTargetDistance;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFun_3(Switch ,FunIndex.PetTargetDistance) or -1;\r\nend\r\n--宠物到焦点的距离\r\nfunction amPetFocusDistance(Switch)\r\n\r\n\tif Switch ==1 or Switch == nil then\t\t\r\n\t\tSwitch = FunType.PetFocusDistance;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFun_3(Switch ,FunIndex.PetFocusDistance) or -1;\r\nend\r\n--当前目标到焦点的距离\r\nfunction amTargetFocusDistance(Switch)\r\n\r\n\tif Switch ==1 or Switch == nil then\t\r\n\t\tSwitch = FunType.TargetFocusDistance;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFun_3(Switch,FunIndex.TargetFocusDistance) or -1;\r\nend\r\n--宠物到宠物当前目标的距离\r\nfunction amPetPetTargetDistance(Switch)\r\n\r\n\tif Switch ==1 or Switch == nil then\t\r\n\t\tSwitch = FunType.PetPetTargetDistance;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFun_3(Switch ,FunIndex.PetPetTargetDistance) or -1;\r\nend\r\n\r\n\r\n\r\nlocal function GetFunRangeUnitCount(FunType,FIndex,index,Guid,Range,Type,MinHealth,MaxHealth,Percentage,Lack)\r\n\t\r\n\t\r\n\tlocal HGuid = tonumber(\"0x\" .. string.sub(Guid,3,10));\r\n\tlocal LGuid = tonumber(\"0x\" .. string.sub(Guid,11,18));\r\n\t\t\r\n\tam_index[FIndex] = FunType;\r\n\t\r\n\tif FunType == 0 then return -1; end;\r\n\t\r\n\tam_index[FIndex + 3] = index;\r\n\tam_index[FIndex + 4] = HGuid;\r\n\tam_index[FIndex + 5] = LGuid;\r\n\tam_index[FIndex + 6] = Range;\r\n\tam_index[FIndex + 7] = Type;\r\n\tam_index[FIndex + 8] = MinHealth;\r\n\tam_index[FIndex + 9] = MaxHealth;\r\n\tam_index[FIndex + 10] = Percentage;\r\n\tam_index[FIndex + 11] = Lack;\r\n\t\r\n\tif am_index[FIndex + 1] == 1 then\r\n\t\treturn am_index[FIndex + 2];\r\n\tend\r\n\t\r\n\treturn -1;\r\nend\r\n\r\n--获得某目标的友方/敌方距离范围内的目标数量\r\n--index 线程ID 1-20\r\n--Switch nil true 为开 false 关\r\n--unit 目标\r\n--Range 距离\r\n--Type 1：友方 2：敌方\r\n--MinHealth 血量下限\r\n--MaxHealth 血量上限\r\n--Percentage 1为百分比\r\n--Lack 1为缺血量\r\nfunction amGetRangeUnitCount(index,Switch,unit,Range,Type,MinHealth,MaxHealth,Percentage,Lack)\r\n\t\r\n\tRange = Range or -1;\r\n\tType = Type or -1;\r\n\tMinHealth = MinHealth or -1;\r\n\tMaxHealth = MaxHealth or -1;\r\n\tPercentage = Percentage or -1;\r\n\tLack = Lack or -1;\r\n\t\r\n\t\r\n\t\r\n\tif index >20 and index<=0 then\r\n\t\treturn -1;\r\n\tend\r\n\tlocal Guid ;\r\n\tlocal FIndex = FunIndex[\"Custom\" .. index];\r\n\t--print(unit,UnitIndex[string.lower(unit)])\r\n\tif UnitIndex[string.lower(unit)] then\r\n\t\t\t\t\r\n\t\tGuid = \"0x00000000\" .. format(\"%08X\",UnitIndex[string.lower(unit)]);\r\n\telse\r\n\t\t\r\n\t\tGuid = UnitGUID(unit);\t\r\n\t\t\r\n\t\t\r\n\t\tif not Guid then return -1; end;\r\n\t\t\t\t\r\n\tend\r\n\t\r\n\tif Switch then\t\r\n\t\tSwitch = FunType.GetRangeUnitCount;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetFunRangeUnitCount(Switch,FIndex,\r\n\tindex,Guid,Range,Type,MinHealth,MaxHealth,Percentage,Lack\r\n\t);\r\nend\r\n\r\n\r\nlocal function GetRangeRadianUnitCount(FunType,FunIndex,index,Guid,Range,Radian,Type,MinHealth,MaxHealth,Percentage,Lack)\r\n\t\r\n\t\r\n\tlocal HGuid = tonumber(\"0x\" .. string.sub(Guid,3,10));\r\n\tlocal LGuid = tonumber(\"0x\" .. string.sub(Guid,11,18));\r\n\t\t\r\n\tam_index[FunIndex] = FunType;\r\n\t\r\n\tif FunType == 0 then return -1; end;\r\n\t\r\n\tam_index[FunIndex + 3] = index;\r\n\tam_index[FunIndex + 4] = HGuid;\r\n\tam_index[FunIndex + 5] = LGuid;\r\n\tam_index[FunIndex + 6] = Range;\r\n\tam_index[FunIndex + 7] = Radian;\r\n\tam_index[FunIndex + 8] = Type;\r\n\tam_index[FunIndex + 9] = MinHealth;\r\n\tam_index[FunIndex + 10] = MaxHealth;\r\n\tam_index[FunIndex + 11] = Percentage;\r\n\tam_index[FunIndex + 12] = Lack;\r\n\t\r\n\tif am_index[FunIndex + 1] == 1 then\r\n\t\treturn am_index[FunIndex + 2];\r\n\tend\r\n\t\r\n\treturn -1;\r\nend\r\n\r\n\r\n--获得某目标的友方/敌方弧度距离范围内的目标数量\r\nfunction amGetRangeRadianUnitCount(index,Switch,unit,Range,Radian,Type,MinHealth,MaxHealth,Percentage,Lack)\r\n\t\r\n\tRange = Range or -1;\r\n\tRadian = Radian or -1;\r\n\tType = Type or -1;\r\n\tMinHealth = MinHealth or -1;\r\n\tMaxHealth = MaxHealth or -1;\r\n\tPercentage = Percentage or -1;\r\n\tLack = Lack or -1;\r\n\t\r\n\tif index >20 and index<=0 then\r\n\t\treturn -1;\r\n\tend\r\n\t\r\n\tlocal Guid ;\r\n\tlocal FIndex = FunIndex[\"Custom\" .. index];\r\n\t\r\n\tif not FIndex then return -1;end;\r\n\t\r\n\tif UnitIndex[string.lower(unit)] then\r\n\t\t\t\t\r\n\t\tGuid = \"0x00000000\" .. format(\"%08X\",UnitIndex[string.lower(unit)]);\r\n\telse\r\n\t\t\r\n\t\tGuid = UnitGUID(unit);\t\r\n\t\tif not Guid then return -1; end;\r\n\t\t\t\t\r\n\tend\r\n\t\r\n\tif Switch then\t\r\n\t\tSwitch = FunType.GetRangeRadianUnitCount;\r\n\telse\r\n\t\tSwitch = 0;\r\n\tend\r\n\t\r\n\treturn GetRangeRadianUnitCount(Switch,FIndex,\r\n\tindex,Guid,Range,Radian,Type,MinHealth,MaxHealth,Percentage,Lack\r\n\t);\r\nend\r\n\r\n\r\n----------------\r\n--我到2-40码范围敌对目标数量\r\n-- 2/5/8/10/12/15/20/30/35/40\r\nfunction amPlayerToEnemyRangeCount(i)\r\n\treturn amGetRangeUnitCount(17,1,\"player\",i,2,-1,-1,-1,-1);\r\nend\r\n--我到2-40码范围友好目标数量\r\n-- 2/5/8/10/12/15/20/30/35/40\r\nfunction amPlayerToFriendlyRangeCount(i)\r\n\treturn amGetRangeUnitCount(18,1,\"player\",i,1,-1,-1,-1,-1);\r\nend\r\n--我到10-40码范围90度敌对目标数量\r\n-- 10-90/30-90/40-90\r\nfunction amPlayerRangeRadianEnemyCount(i)\r\n\treturn amGetRangeRadianUnitCount(19,1,\"player\",i,90,2,-1,-1,-1,-1);\r\nend\r\n--我到10-40码范围90度友好目标数量\r\n-- 10-90/30-90/40-90\r\nfunction amPlayerRangeRadianFriendlyCount(i)\r\n\treturn amGetRangeRadianUnitCount(20,1,\"player\",i,90,1,-1,-1,-1,-1);\r\nend\r\n\r\n\r\n\r\nfunction amSetThreadSpeed(v)\r\n\t\r\n\tif am_index and am_index[303] then\r\n\t\tam_index[303] = v;\r\n\tend\r\nend\r\n\r\nfunction amRunThreadSpeedTime()\r\n\t\r\n\tif am_index and am_index[304] then\r\n\t\treturn am_index[304];\r\n\tend\r\n\r\nend\r\n\r\nfunction amIsEclipseDirection()\r\n\t\r\n\treturn GetEclipseDirection() == \"sun\";\r\n\r\nend\r\n\r\n\r\nfunction amExtraActionBarPower()\t\r\n\treturn UnitPower(\"player\", ALTERNATE_POWER_INDEX) or -1;\r\nend\r\n\r\nfunction amExtraActionBarSpellName()\r\n\t_, _, _, spellID = GetActionInfo(121);\r\n\tlocal Name = GetSpellInfo(spellID);\t\r\n\treturn Name or \"\";\r\nend\r\n\r\nfunction amTargetTargetNotMe(t)\r\n\t\r\n\tif t == 1 then\r\n\t\r\n\t\tif not UnitName(\"targettarget\") then\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\t\r\n\t\tif not UnitIsUnit(\"player\",\"targettarget\") then\r\n\t\t\treturn true;\r\n\t\tend\r\n\telse\r\n\t\t\r\n\t\tif not UnitName(\"target\") then\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\t\r\n\t\tif not UnitName(\"targettarget\") then\r\n\t\t\treturn true;\r\n\t\tend\r\n\t\t\t\t\r\n\t\tif not UnitIsUnit(\"player\",\"targettarget\") then\r\n\t\t\treturn true;\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\nend\r\n\r\nfunction amTargetTargetToMe()\r\n\t\r\n\tif not UnitIsUnit(\"player\",\"targettarget\") then \r\n\t\treturn true\r\n\telse\r\n\t\treturn false\r\n\tend;\r\n\t\r\nend\r\n\r\nif IsLoad_runspell then\r\n\treturn;\r\nend\r\n\r\n\r\nlocal aml = aml;\r\nlocal amact = amact;\r\nlocal amac = amac;\r\nlocal amr = amr;\r\nlocal amSpellCooldown = amSpellCooldown;\r\nlocal amGetUnitName = amGetUnitName;\r\nlocal amIsPlayerCastSpell = amIsPlayerCastSpell;\r\nlocal amisr = amisr;\r\nlocal aminspell = aminspell;\r\n\r\nlocal amrun = amrun;\r\nlocal amdelay = amdelay;\r\nlocal amCountAttack = amCountAttack;\r\nlocal ambufflist = ambufflist;\r\nlocal amecd = amecd;\r\nlocal amtotem = amtotem;\r\n\r\nlocal UnitIsDead = _G.UnitIsDead;\r\nlocal UnitIsDeadOrGhost = _G.UnitIsDeadOrGhost;\r\nlocal UnitIsConnected = _G.UnitIsConnected;\r\nlocal UnitInRaid = _G.UnitInRaid;\r\nlocal UnitInParty = _G.UnitInParty;\r\nlocal UnitIsUnit = _G.UnitIsUnit;\r\n\r\nlocal GetSpellInfo = _G.GetSpellInfo;\r\nlocal UnitName = _G.UnitName;\r\nlocal UnitPlayerOrPetInParty = _G.UnitPlayerOrPetInParty;\r\nlocal UnitPlayerOrPetInRaid = _G.UnitPlayerOrPetInRaid;\r\nlocal GetRaidRosterInfo = _G.GetRaidRosterInfo;\r\nlocal UnitClass = _G.UnitClass;\r\nlocal UnitGroupRolesAssigned = _G.UnitGroupRolesAssigned;\r\n\r\n\r\n\r\nlocal UnitHealth = _G.UnitHealth;\r\nlocal UnitHealthMax = _G.UnitHealthMax;\r\nlocal UnitMana = _G.UnitMana;\r\nlocal UnitManaMax = _G.UnitManaMax;\r\nlocal UnitDebuff = _G.UnitDebuff;\r\nlocal format = _G.format;\r\nlocal tonumber = _G.tonumber;\r\nlocal GetTime = _G.GetTime;\r\nlocal UnitCastingInfo = _G.UnitCastingInfo;\r\nlocal UnitChannelInfo = _G.UnitChannelInfo;\r\nlocal GetSpellCooldown = _G.GetSpellCooldown;\r\nlocal GetItemCooldown = _G.GetItemCooldown;\r\nlocal GetItemInfo = _G.GetItemInfo;\r\nlocal IsEquippedItem = _G.IsEquippedItem;\r\nlocal UnitPower = _G.UnitPower;\r\nlocal GetShapeshiftFormInfo = _G.GetShapeshiftFormInfo;\r\nlocal GetPetActionInfo = _G.GetPetActionInfo;\r\n\r\nlocal IsCurrentSpell = _G.IsCurrentSpell;\r\nlocal UnitGUID = _G.UnitGUID;\r\nlocal type = _G.type;\r\nlocal GetSpellBookItemInfo = _G.GetSpellBookItemInfo;\r\nlocal GetSpellLink = _G.GetSpellLink;\r\nlocal GetInventoryItemID = _G.GetInventoryItemID;\r\n\r\nlocal GetBagName = _G.GetBagName;\r\nlocal GetContainerNumSlots = _G.GetContainerNumSlots;\r\nlocal GetContainerItemID = _G.GetContainerItemID;\r\nlocal GetUnitSpeed = _G.GetUnitSpeed;\r\n\r\nlocal select = _G.select;\r\nlocal UnitCanAssist = _G.UnitCanAssist;\r\nlocal UnitCanAttack = _G.UnitCanAttack;\r\nlocal IsSpellInRange = _G.IsSpellInRange;\r\nlocal IsUsableSpell = _G.IsUsableSpell;\r\nlocal IsUsableItem = _G.IsUsableItem;\r\nlocal IsItemInRange = _G.IsItemInRange;\r\nlocal GetMacroIndexByName = _G.GetMacroIndexByName;\r\nlocal GetMacroInfo = _G.GetMacroInfo;\r\nlocal ItemHasRange = _G.ItemHasRange;\r\n\r\nlocal UnitLevel = _G.UnitLevel\r\n\r\n\r\n\r\nlocal addon = SuperTreatment[\"Menu\"][\"Main\"][\"addon\"];\r\nlocal SD ;\r\nlocal ST = SuperTreatmentInf;\r\n\r\nSuperTreatmentInf.UNIT_HEALTHS ={}\r\n\r\nSuperTreatmentInf.UNIT_HEALTHS.Health_Percentage_Min={};\r\nSuperTreatmentInf.UNIT_HEALTHS.LackHealth_Max={};\r\n\r\nlocal UNIT_HEALTHS= SuperTreatmentInf.UNIT_HEALTHS;\r\n\r\nlocal UNIT_HEALTH_TBL = {};\r\nlocal UNIT_HEALTH_TBL_INDEX ={};\r\n\r\nST.CastSpell={};\r\nST.CastSpell.Cast={};\r\nST.CastSpell.CastOver={};\r\n\r\nST.CastOffSchem={};\r\nST.CastOffSchem.Cast={};\r\nST.CastOffSchem.End={};\r\n\r\nlocal Colors={};\r\nColors.RED = \"|cffff0000\";\r\nColors.GREEN = \"|cff00ff00\";\r\nColors.BLUE = \"|cff0000ff\";\r\nColors.MAGENTA = \"|cffff00ff\";\r\nColors.YELLOW = \"|cffffff00\";\r\nColors.CYAN = \"|cff00ffff\";\r\nColors.WHITE = \"|cffffffff\";\r\n\r\nfunction IsRangeCheckAngle(v)\r\n\r\n\t\t\r\n\tlocal TBL = SuperTreatmentDBF;\r\n\tfor i, data in pairs(TBL[\"Spells\"][\"List\"]) do\r\n\t\t\r\n\t\tfor k, t in pairs(data[\"spell\"]) do\r\n\t\t\r\n\t\t\tif t[\"TargetSubgroup\"]==-2 and t[\"unit\"]==v then\r\n\t\t\t\treturn true;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif t[\"Targets\"] then\r\n\t\t\t\r\n\t\t\t\tfor k1, t1 in pairs(t[\"Targets\"]) do\r\n\t\t\t\t\tif t1[\"Conditions\"] then\r\n\t\t\t\t\t\tfor k2, t2 in pairs(t1[\"Conditions\"]) do\r\n\t\t\t\t\t\t\tif t2[\"TargetSubgroup\"] == -2 and t2[\"unit\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif TBL[\"Unit\"][\"RaidList\"][t2[\"unit\"]] and TBL[\"Unit\"][\"RaidList\"][t2[\"unit\"]][\"types\"]==\"RangeCheckAngle\" then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\n\r\n\treturn false;\r\n\r\n\r\nend\r\n\r\n\t\r\nlocal function ExcludedTargetGroup(name)\r\n\r\n\t\t\r\n\t\t\r\n\t\tlocal index = ST[\"Spells_Index\"];\r\n\t\t\t\t\r\n\t\tlocal tbl = SD[\"Spells\"][\"List\"][index];\r\n\t\t\r\n\t\r\n\t\tlocal Global_subgroup;\r\n\t\tlocal GlobalExcludedGroup = true;\r\n\t\tlocal GlobalExcludeTarget= true;\r\n\t\tlocal GlobalExcludeMT = true;\r\n\t\t\r\n\t\tif tbl[\"ExcludedGroupChecked\"] then\r\n\t\t\r\n\t\t\tif SD[\"Unit\"][\"RaidList\"][name] and SD[\"Unit\"][\"RaidList\"][name][\"subgroup\"] then\r\n\t\t\t\tGlobal_subgroup = SD[\"Unit\"][\"RaidList\"][name][\"subgroup\"];\r\n\t\t\t\tGlobalExcludedGroup = not tbl[\"ExcludedGroup\"][Global_subgroup];\r\n\t\t\tend\r\n\t\t\t\t\t\r\n\t\telse\r\n\t\t\r\n\t\t\tif SD[\"Unit\"][\"RaidList\"][name] and SD[\"Unit\"][\"RaidList\"][name][\"subgroup\"] then\r\n\t\t\t\tGlobal_subgroup = SD[\"Unit\"][\"RaidList\"][name][\"subgroup\"];\r\n\t\t\t\tGlobalExcludedGroup = not SD[\"Unit\"][\"ExcludedGroup\"][Global_subgroup];\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif tbl[\"ExcludeTargetChecked\"] then\r\n\t\t\t\t\t\r\n\t\t\tGlobalExcludeMTChecked = not tbl[\"ExcludeTarget\"][name];\r\n\t\t\t\r\n\t\t\t\r\n\t\telse\r\n\t\t\r\n\t\t\tGlobalExcludeTarget = not SD[\"Unit\"][\"ExcludeTarget\"][name];\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif tbl[\"ExcludeMTChecked\"] then\r\n\t\t\r\n\t\t\tlocal tblmt = stGetMtList();\t\t\r\n\t\t\tGlobalExcludeMT = not tblmt[name];\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\treturn GlobalExcludedGroup and GlobalExcludeTarget and GlobalExcludeMT;\r\n\t\t\r\nend\r\n\t\r\n\r\nlocal function IsBuffPlayer(v,unitCaster)\r\n\t\r\n\tlocal IsPlayer = false;\r\n\tif v[\"IsPlayer\"]== \"All\" or not v[\"IsPlayer\"] then\r\n\t\r\n\t\tIsPlayer = true;\r\n\t\t\r\n\telseif v[\"IsPlayer\"]== \"PLAYER\" then\r\n\r\n\t\tIsPlayer = unitCaster == \"player\"\r\n\t\t\r\n\telseif v[\"IsPlayer\"]== \"NoPlayer\" then\r\n\t\r\n\t\tIsPlayer = unitCaster ~= \"player\"\r\n\t\t\r\n\tend\r\n\r\n\treturn IsPlayer;\r\n\r\nend\r\n\r\nlocal function IsBuffValue(v,isok,IsPlayer,name,count,duration, expirationTime, unitCaster)\r\n\t\r\n\t\r\n\t\r\n\tif name then\r\n\t\t\t\r\n\t\tIsPlayer = IsBuffPlayer(v,unitCaster);\r\n\t\t\t\t\t\t\t\r\n\tend\r\n\t\r\n\r\n\t\r\n\tif not name and v[\"IsCd\"] == \"NotPresence\" then\r\n\t\r\n\t\tisok = true;\r\n\t\t\r\n\telseif v[\"IsCd\"] == \"No\" then\r\n\t\r\n\t\treturn true;\r\n\t\r\n\telseif name and (v[\"IsCd\"] == \"Presence\" or not v[\"IsCd\"]) then\r\n\t\t\r\n\t\tisok = IsPlayer;\r\n\t\r\n\t\r\n\telseif v[\"IsCd\"] == \"End\" or v[\"IsCd\"] == \"Start\" then\r\n\t\t\r\n\t\tlocal n;\r\n\t\tlocal a,b=true,true;\r\n\t\t\r\n\t\tif name then\r\n\t\t\r\n\t\t\tif IsPlayer then\r\n\t\t\t\r\n\t\t\t\tif v[\"IsCd\"] == \"End\" then\r\n\t\t\t\t\r\n\t\t\t\t\tn = expirationTime - GetTime();\r\n\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t\telseif v[\"IsCd\"] == \"Start\" then\r\n\t\t\t\t\t\r\n\t\t\t\t\tn = duration - (expirationTime - GetTime());\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\ta,b=true,true;\r\n\t\t\t\t\r\n\t\t\t\tif v[\"Cd\"][\">\"][\"Checked\"] then\r\n\t\t\t\t\ta = n >= v[\"Cd\"][\">\"][\"Value\"];\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif v[\"Cd\"][\"<\"][\"Checked\"] then\r\n\t\t\t\t\tb = n <= v[\"Cd\"][\"<\"][\"Value\"];\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tisok = a and b;\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\telse\r\n\t\t\t\r\n\t\t\tn=-1;\r\n\t\t\t\t\t\t\t\r\n\t\t\ta,b=true,true;\r\n\t\t\t\r\n\t\t\tif v[\"Cd\"][\">\"][\"Checked\"] then\r\n\t\t\t\ta = n >= v[\"Cd\"][\">\"][\"Value\"];\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif v[\"Cd\"][\"<\"][\"Checked\"] then\r\n\t\t\t\tb = n <= v[\"Cd\"][\"<\"][\"Value\"];\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tisok = a and b;\r\n\t\t\t\r\n\t\tend\t\t\r\n\t\r\n\tend\r\n\t\r\n\t\r\n\tif v[\"IsCount\"] then\r\n\t\t\t\t\r\n\t\tlocal n = count or -1;\r\n\t\tlocal a,b=true,true;\r\n\t\t\r\n\t\tif v[\"Count\"][\">\"][\"Checked\"] then\r\n\t\t\ta = n >= v[\"Count\"][\">\"][\"Value\"] ;\r\n\t\tend\r\n\t\t\r\n\t\tif v[\"Count\"][\"<\"][\"Checked\"] then\r\n\t\t\tb = n <= v[\"Count\"][\"<\"][\"Value\"] ;\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif name and v[\"IsCd\"] == \"NotPresence\" then\r\n\t\t\tisok = IsPlayer and a and b;\r\n\t\telse\r\n\t\t\tisok = isok and a and b;\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif name and v[\"IsCd\"] == \"NotPresence\" then\r\n\t\r\n\t\tisok = not IsPlayer;\r\n\t\r\n\tend\r\n\t\r\n\t\r\n\treturn isok;\r\n\r\nend\r\n\r\n\r\n\r\nlocal function GetBuffFilter(v)\r\n\t\r\n\tlocal filter;\r\n\t\r\n\tif v[\"IsPlayer\"]== \"PLAYER\" then\r\n\t\tfilter = \"PLAYER\";\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif v.IsCanceLable ~= \"No\" then\r\n\t\tif filter then\r\n\t\t\tfilter = filter .. \"|\" ..v.IsCanceLable;\r\n\t\telse\r\n\t\t\tfilter = v.IsCanceLable;\r\n\t\tend\r\n\tend\r\n\t\r\n\t\r\n\tif v.IsRaid ~= \"No\" then\r\n\t\tif filter then\r\n\t\t\tfilter = filter .. \"|\" ..v.IsRaid;\r\n\t\telse\r\n\t\t\tfilter = v.IsRaid;\r\n\t\tend\r\n\tend\r\n\t\r\n\treturn filter;\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\nlocal function RGBToHex(r, g, b)\r\n\tr = r <= 255 and r >= 0 and r or 0\r\n\tg = g <= 255 and g >= 0 and g or 0\r\n\tb = b <= 255 and b >= 0 and b or 0\r\n\treturn string.format(\"%02x%02x%02x\", r, g, b)\r\nend\r\n\r\nlocal function RGBPercToHex(r, g, b)\r\n\tr = r <= 1 and r >= 0 and r or 0\r\n\tg = g <= 1 and g >= 0 and g or 0\r\n\tb = b <= 1 and b >= 0 and b or 0\r\n\treturn  \"|cff\" .. string.format(\"%02x%02x%02x\", r*255, g*255, b*255)\r\nend\r\n\r\nlocal sortedpairs = sortedpairs;\r\n\r\nlocal DelayCastSpellMacro_StartTime=GetTime();\r\nlocal function DelayCastSpellMacro_OnUpdate(arg1)\r\n\r\n\t\r\n\t\r\n\tif  GetTime() - DelayCastSpellMacro_StartTime > 0.01  then\r\n\t\r\n\t\tDelayCastSpellMacro_StartTime=GetTime();\r\n\r\n\t\tfor i, data in pairs(ST.CastSpell.Cast) do\r\n\t\t\t\r\n\t\t\tif data.SpellCommand and data[\"DelayValue\"] and data[\"DelayValue\"] >0 and GetTime() - data[\"time\"] > data[\"DelayValue\"] then\r\n\t\t\t\r\n\t\t\t\tlocal r = data.SpellCommand;\r\n\t\t\t\tr(data.SpellText);\r\n\t\t\t\tST.CastSpell.Cast[i]=nil;\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\tend\t\r\nend\r\n\r\nlocal DelayCastSpellMacroFrame= CreateFrame(\"Frame\", nil ,UIParent);\r\nDelayCastSpellMacroFrame:SetScript(\"OnUpdate\",DelayCastSpellMacro_OnUpdate);\r\n\r\n\r\nlocal Sort_Health_Percentage_Min = function(a, b) \r\n\treturn b[\"Health%\"] > a[\"Health%\"];\r\nend;\r\n\r\nlocal Sort_LackHealth_Max = function(a, b) \r\n\treturn b[\"HealthLack\"] < a[\"HealthLack\"];\r\nend;\r\n\t\r\nfunction stSort_Health()\r\n\t\r\n\tST.UNIT_HEALTHS.Health_Percentage_Min={};\r\n\ttable.sort(UNIT_HEALTH_TBL_INDEX, Sort_Health_Percentage_Min)\r\n\t\r\n\tfor i, v in pairs(UNIT_HEALTH_TBL_INDEX) do\r\n\t\ttable.insert(UNIT_HEALTHS.Health_Percentage_Min,v)\r\n\tend\r\n\t\r\n\tST.UNIT_HEALTHS.LackHealth_Max={};\r\n\ttable.sort(UNIT_HEALTH_TBL_INDEX, Sort_LackHealth_Max)\r\n\t\r\n\tfor i, v in pairs(UNIT_HEALTH_TBL_INDEX) do\r\n\t\ttable.insert(UNIT_HEALTHS.LackHealth_Max,v)\r\n\tend\r\n\t\r\n\tSuperTreatmentInf.UNIT_HEALTHS.UNIT_HEALTH_TBL = UNIT_HEALTH_TBL;\r\n\tSuperTreatmentInf.UNIT_HEALTHS.UNIT_HEALTH_TBL_INDEX = UNIT_HEALTH_TBL_INDEX;\r\n\t\r\nend\r\n\r\n\r\nlocal function UP_HEALTH(unit)\r\n\t\r\n\t\t\t\r\n\tif UNIT_HEALTH_TBL[unit] then\r\n\t\tlocal _,e = UnitClassBase(unit);\r\n\t\tUNIT_HEALTH_TBL[unit][\"Health\"] = UnitHealth(unit) or 0;\r\n\t\tUNIT_HEALTH_TBL[unit][\"HealthMax\"] = UnitHealthMax(unit) or 0;\r\n\t\tUNIT_HEALTH_TBL[unit][\"Health%\"] = aml(unit,\"%\");\r\n\t\t--UNIT_HEALTH_TBL[unit][\"HealthLack%\"]= aml(unit,\"%\",1);\r\n\t\tUNIT_HEALTH_TBL[unit][\"HealthLack\"] = aml(unit,nil,1);\r\n\t\tUNIT_HEALTH_TBL[unit][\"Enable\"]= not UnitIsDeadOrGhost(unit) and UnitIsConnected(unit) or false;\r\n\t\tUNIT_HEALTH_TBL[unit][\"Class\"]= e or \"\";\r\n\t\t\r\n\t\tif UNIT_HEALTH_TBL[unit][\"UnitId\"] ~= unit then\r\n\t\t\tUNIT_HEALTH_TBL[unit][\"UnitId\"]= unit;\r\n\t\tend\r\n\t\t\r\n\t\treturn true;\r\n\tend\r\n\t\r\nend\r\n\t\r\nlocal function EVENTS_UNIT_HEALTH_REST()\r\n\t\r\n\tUNIT_HEALTH_TBL={};\r\n\tUNIT_HEALTH_TBL_INDEX={};\r\n\t\r\n\tif UnitInRaid(\"player\") then\r\n\t\r\n\t\tlocal k = GetNumGroupMembers();\r\n\t\tfor i=1 , k do\r\n\t\t\tUNIT_HEALTH_TBL[\"raid\" .. i]={};\r\n\t\t\tif UP_HEALTH(\"raid\" .. i) then\r\n\t\t\t\tUNIT_HEALTH_TBL_INDEX[i] = UNIT_HEALTH_TBL[\"raid\" .. i];\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\telseif GetNumSubgroupMembers()>0 then\r\n\t\t\r\n\t\tlocal k = GetNumSubgroupMembers();\r\n\t\tfor i=1 , k do\r\n\t\t\tUNIT_HEALTH_TBL[\"party\" .. i]={};\r\n\t\t\tif UP_HEALTH(\"party\" .. i) then\r\n\t\t\t\tUNIT_HEALTH_TBL_INDEX[i] = UNIT_HEALTH_TBL[\"party\" .. i];\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\t\tUNIT_HEALTH_TBL[\"player\"]={};\r\n\t\t\r\n\t\tif UP_HEALTH(\"player\") then\r\n\t\t\tUNIT_HEALTH_TBL_INDEX[k+1] = UNIT_HEALTH_TBL[\"player\"];\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\tstSort_Health();\r\nend\r\n\r\n\r\nlocal function EVENTS_UNIT_HEALTH(self,event,arg1)\r\n\t\r\n\t\t\r\n\tif (event == \"UNIT_HEALTH\" or event == \"UNIT_CONNECTION\") and arg1 then\r\n\t\r\n\t\tUP_HEALTH(arg1);\r\n\t\tstSort_Health();\r\n\t\t\r\n\telseif  arg1 and (event ==  \"PARTY_MEMBER_ENABLE\" or event ==  \"PARTY_MEMBER_DISABLE\") and not UnitInRaid(\"player\") then\r\n\t\t\r\n\t\tUP_HEALTH(\"party\" .. arg1 );\r\n\t\tstSort_Health();\r\n\t\t\r\n\telseif  event ==  \"UPDATE_BATTLEFIELD_STATUS\" or\r\n\t\t\t(event ==  \"PARTY_LEADER_CHANGED\" and not UnitInRaid(\"player\"))\r\n\t\t\tthen\r\n\t\t\t\r\n\t\t\tEVENTS_UNIT_HEALTH_REST();\r\n\t\t\r\n\t\t\r\n\t\t\r\n\telseif ( event ==  \"RAID_ROSTER_UPDATE\")  then\r\n\t\r\n\t\tif GetNumGroupMembers()>0 then\r\n\t\t\tEVENTS_UNIT_HEALTH_REST();\r\n\t\tend\r\n\t\r\n\r\n\telseif ( event == \"PARTY_MEMBERS_CHANGED\" and not UnitInRaid(\"player\"))  then\r\n\t\t\r\n\t\tif GetNumGroupMembers() == 0 then\r\n\t\t\tEVENTS_UNIT_HEALTH_REST();\r\n\t\tend\t\r\n\t\t\r\n\t\r\n\tend\r\n\r\nend\r\n\r\nlocal st_Unit_Health= CreateFrame(\"Frame\", nil ,UIParent);\r\n--[[\r\nst_Unit_Health:SetScript(\"OnEvent\", EVENTS_UNIT_HEALTH);\r\n\r\nst_Unit_Health:RegisterEvent(\"UNIT_HEALTH\");--\r\nst_Unit_Health:RegisterEvent(\"PARTY_MEMBERS_CHANGED\");\r\nst_Unit_Health:RegisterEvent(\"RAID_ROSTER_UPDATE\");\r\n\t\r\nst_Unit_Health:RegisterEvent(\"UPDATE_BATTLEFIELD_STATUS\");\r\n--st_Unit_Health:RegisterEvent(\"UNIT_NAME_UPDATE\");\r\nst_Unit_Health:RegisterEvent(\"UNIT_CONNECTION\");--\r\nst_Unit_Health:RegisterEvent(\"PARTY_MEMBER_ENABLE\"); --ID\r\nst_Unit_Health:RegisterEvent(\"PARTY_MEMBER_DISABLE\"); --ID\r\nst_Unit_Health:RegisterEvent(\"PARTY_LEADER_CHANGED\");\r\nst_Unit_Health:RegisterEvent(\"PARTY_CONVERTED_TO_RAID\");\r\n--]]\r\n\r\nfunction ST.MacroFinishing(macro,unit,isunit)\r\n\r\n\t--local Linebreaks = strchar(13) .. strchar(10);\t\r\n\t--local temp =gsub(macro,\"\\\\n\",Linebreaks);\r\n\tif not unit then\r\n\t\treturn macro;\r\n\tend\r\n\t\r\n\tlocal temp;\r\n\t\r\n\tif isunit then\r\n\t\r\n\t\ttemp =gsub(macro,\"*unit\",unit);\r\n\t\ttemp =gsub(temp,'\"' .. unit .. '\"',unit);\r\n\telse\r\n\t\ttemp =gsub(macro,\"*unit\",unit);\r\n\tend\r\n\t\r\n\treturn temp;\r\n\t\r\nend\r\n\r\nlocal function CastOffSchemProcessing(vv,spell,unit,event)\r\n\t\r\n\tif vv == \"star\" then\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\tfor k,v in pairs(ST.CastOffSchem.Cast) do\r\n\t\t\r\n\t\t\tif v[spell] then\r\n\t\t\t\tstcommand(\"select:off \" .. k);\r\n\t\t\t\t\r\n\t\t\t\tST.CastOffSchem.Cast[k]=nil;\r\n\t\t\t\tbreak;\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\telseif vv == \"end\" and event==\"UNIT_SPELLCAST_SUCCEEDED\" then\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\tfor k,v in pairs(ST.CastOffSchem.End) do\r\n\t\t\r\n\t\t\tif v[spell] then\r\n\t\t\t\tstcommand(\"select:off \" .. k);\r\n\t\t\t\t\r\n\t\t\t\tST.CastOffSchem.End[k]=nil;\r\n\t\t\t\tbreak;\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\t\r\n\t\r\n\tend\r\n\t\r\n\r\nend\r\n\r\nfunction ST.CastSpellfinishing(arg1,vv,spell,unit,event)\r\n\t\r\n\tCastOffSchemProcessing(vv,spell,unit,event);\r\n\t\r\n\tif vv == \"star\" then\r\n\t\t\r\n\t\tif ST.CastSpell.Cast[spell] and GetTime()- ST.CastSpell.Cast[spell][\"time\"]<3 then\r\n\t\t\t\r\n\t\t\tlocal s = ST.CastSpell.Cast[spell];\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t--print(s.ChatCommand,s.ScriptCommand,s.SpellCommand)\r\n\t\t\t\r\n\t\t\tlocal r ;\r\n\t\t\tif s.ChatCommand then\r\n\t\t\t\tr = s.ChatCommand;\r\n\t\t\t\tr(s.ChatText);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif s.ScriptCommand then\r\n\t\t\t\tr = s.ScriptCommand;\r\n\t\t\t\tr(s.ScriptText);\r\n\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\tif s.SpellCommand and s[\"DelayValue\"] and s[\"DelayValue\"] ==0 then\r\n\t\t\t\tr = s.SpellCommand;\r\n\t\t\t\tr(s.SpellText);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif s.SpellCommand and s[\"DelayValue\"] and s[\"DelayValue\"] >0 then\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tST.CastSpell.Cast[spell]=nil;\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\r\n\telseif vv == \"end\" and event==\"UNIT_SPELLCAST_SUCCEEDED\" then\r\n\t\t--print(111)\r\n\t\tif ST.CastSpell.CastOver[spell] and GetTime()- ST.CastSpell.CastOver[spell][\"time\"]<20 then\r\n\t\t\t\r\n\t\t\tlocal s = ST.CastSpell.CastOver[spell];\r\n\t\t\tlocal r ;\r\n\t\t\t\r\n\t\t\tif s.ChatCommand then\r\n\t\t\t\tr = s.ChatCommand;\r\n\t\t\t\tr(s.ChatText);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif s.ScriptCommand then\r\n\t\t\t\tr = s.ScriptCommand;\r\n\t\t\t\tr(s.ScriptText);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tST.CastSpell.CastOver[spell]=nil;\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\nend\r\n\r\nfunction amtoboolean(v)\r\n\t\r\n\tif v then\r\n\t\treturn true;\r\n\telse\r\n\t\treturn false;\r\n\tend\r\n\r\nend\r\n\r\nfunction ST.SpellsRun() \r\n\t\r\n\tif not SD then\r\n\t\tSD = SuperTreatmentDBF;\r\n\tend\r\n\t\r\n\tif not ST.runindex then\r\n\t\tST.runindex=1;\r\n\telse\r\n\t\tST.runindex = ST.runindex +1;\r\n\tend\r\n\t\r\n\tif SuperTreatmentDBF[\"Config\"][\"aminspell\"] and amruninspell() then\r\n\t\treturn true;\r\n\tend\r\n\r\n\tif not SuperTreatmentDBF then\r\n\t\treturn false;\r\n\tend\r\n\r\n\r\n\tlocal Spells = SuperTreatmentDBF[\"Spells\"][\"List\"];\r\n\t\t\r\n\tfor i, data in pairs(Spells) do\r\n\t\t\r\n\t\tif data[\"checked\"] then\r\n\t\t\tlocal v,v1 = ST.SpellsRun_1(i);\r\n\t\t\r\n\t\t\tif v and not v1 then\r\n\t\t\t\treturn true;\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\r\nend\r\n\r\n\r\n\r\nfunction ST.SpellsRun_1(index) \r\n\r\n\tST[\"Spells_Index\"]=index;\r\n\r\n\tlocal Spells = SuperTreatmentDBF[\"Spells\"][\"List\"][index][\"spell\"];\r\n\tlocal re = ST.cq[1];\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tfor i, data in pairs(Spells) do\r\n\t\r\n\t\tif data[\"checked\"] then\r\n\t \r\n\t\t\tlocal unit,FireHasBeenSet,u,namespell,Rank,castTime;\r\n\t\t\tlocal amrsdt=getglobal(\"RunScript\");local group = data[\"TargetSubgroup\"];\r\n\t\t\tlocal IsNoStopCastingSpells = true;\r\n\t\t\tlocal iscd,iscdc = true,\"IsSpell\";\r\n\t\t\tlocal acspellname;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif data[\"Type\"] == \"spell\" then\r\n\t\t\t\r\n\t\t\t\tnamespell,Rank, _, _,_,_,castTime = GetSpellInfo(data[\"spellId\"]);\r\n\t\t\t\r\n\t\t\telseif data[\"Type\"] == \"item\" then\r\n\t\t\t\r\n\t\t\t\tnamespell = GetItemInfo(data[\"spellId\"]);\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tunit=nil;\r\n\t\t\t\r\n\t\t\t--acspellname = amact(\"player\") > wowam_config.SpellAttackTime;\r\n\t\t\tacspellname = amac(\"player\");\r\n\t\t\t\r\n\t\t\t--ST.acspellid = tonumber(format(\"%.f\",RaidIndex or 0))>25;\t\r\n\t\t\t\r\n\t\t\t\tif acspellname then\r\n\t\t\t\t\tIsNoStopCastingSpells = not SuperTreatmentDBF[\"Spells\"][\"NoStopCastingSpells\"][acspellname];\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal allNoStopCastingChecked = SuperTreatmentDBF[\"Spells\"][\"List\"][index][\"NoStopCastingChecked\"]\r\n\t\t\t\r\n\t\t\tif data[\"StopCastingChecked\"] then\r\n\t\t\t\t\r\n\t\t\t\tif namespell ~= acspellname then\r\n\t\t\t\t\tIsNoStopCastingSpells = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\telseif allNoStopCastingChecked and acspellname then\r\n\t\t\t\r\n\t\t\t\tIsNoStopCastingSpells = false;\r\n\t\t\t\t\r\n\t\t\telseif SuperTreatmentDBF[\"Spells\"][\"NoStopCastingSpells\"][acspellname] then\r\n\t\t\t\r\n\t\t\t\tIsNoStopCastingSpells = false;\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif data[\"Type\"] == \"spell\" and amac(\"player\") == namespell then\r\n\t\t\t\r\n\t\t\t\tIsNoStopCastingSpells = false;\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif data[\"NoAcChecked\"] then\r\n\t\t\t\r\n\t\t\t\tIsNoStopCastingSpells = true;\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif data[\"RankChecked\"] and Rank and Rank ~= \"\" then\r\n\t\t\t\tnamespell = namespell ..\"(\" .. Rank ..\")\";\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t--local disabled = data[\"Type\"] and (data[\"Type\"] ==\"macro\" or data[\"Type\"] ==\"script\");local strcdc=iscdc..\"InRange\";\r\n\t\t\tlocal disabled = data[\"Type\"] and (data[\"Type\"] ~=\"spell\");local strcdc=iscdc..\"InRange\";\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif data[\"Type\"] == \"spell\" and namespell then\r\n\t\t\t\r\n\t\t\t\tlocal Cooldown = amSpellCooldown(namespell);\r\n\t\t\t\t\r\n\t\t\t\tif castTime<=0 then\r\n\t\t\t\t\tCooldown=Cooldown-wowam_config.PromptSpellAttackTime;\r\n\t\t\t\telse\r\n\t\t\t\t\tCooldown=Cooldown-wowam_config.SpellAttackTime;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tiscd = Cooldown <=0 ;\r\n\t\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif getglobal(re) and amrsdt then\r\n\t\t\tamrsdt(\"function \"..strcdc..\"() return aml()<0;end;\");\r\n\t\t\tend\r\n\t\t\tif iscd and data[\"checked\"] and (data[\"unit\"] or disabled) and IsNoStopCastingSpells then\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t--print(group)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\tif group == -1 then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tunit = stUnitExplanation(data[\"unit\"],data); --unit\r\n\t\t\t\t\t\t--unit = data[\"unit\"];\r\n\t\t\t\t\t\t--print(\">>\",data[\"unit\"],unit)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\telseif group == -2 then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t--unit = ST.AmminimumFast_SpellsRun(data);\r\n\t\t\t\t\t\t\t--SuperTreatmentDBF[\"Unit\"][\"RaidList\"][data[\"unit\"]][\"ReturnsUnit\"]=unit;\r\n\t\t\t\t\t\t\t--SuperTreatmentDBF[\"Unit\"][\"RaidList\"][data[\"unit\"]][\"runindex\"]=ST.runindex;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlocal tbl = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][data[\"unit\"]];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif not tbl[\"runindex\"] then\r\n\t\t\t\t\t\t\ttbl[\"runindex\"] =0;\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif not ST.Multitasking[data[\"unit\"]] then\r\n\t\t\t\t\t\t\tST.Multitasking[data[\"unit\"]]={};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif tbl[\"runindex\"] ~= ST.runindex then\r\n\t\t\t\t\t\t\tlocal ism = ST[\"Multitasking\"][data[\"unit\"]];\r\n\t\t\t\t\t\t\tif ism[\"MultitaskingStart\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tunit =ism[\"ReturnsUnit\"];\r\n\t\t\t\t\t\t\t\t--print(\"a\",i,unit)\r\n\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tunit = ST.AmminimumFast_SpellsRun(data);\r\n\t\t\t\t\t\t\t\t--print(\"b\",i,unit)\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\ttbl[\"ReturnsUnit\"]=unit;\r\n\t\t\t\t\t\t\ttbl[\"runindex\"]=ST.runindex;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tunit = tbl[\"ReturnsUnit\"];\r\n\t\t\t\t\t\t\t--print(\"c\",i,unit)\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t--print(\"xxx\",data[\"unit\"],ism[\"MultitaskingStart\"],unit)\r\n\t\t\t\t\t\r\n\t\t\t\t\telseif group >= 1 then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tunit = data[\"unit\"];\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telseif group == 0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tunit = data[\"unit\"];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t--print(data[\"spellId\"],amIsNoSpellTarget(data[\"spellId\"]))\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t--if data[\"spellId\"] and amIsNoSpellTarget and amIsNoSpellTarget(data[\"spellId\"]) then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--\tunit = \"nogoal\";\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t--end\r\n\t\t\t\t\t\r\n\t\t\t\t\tif unit and unit ~= \"nogoal\" then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlocal TargetLayer = data[\"TargetLayer\"] or 0;\r\n\t\t\t\t\t\tlocal TargetLayerText=\"\";\r\n\t\t\t\t\r\n\t\t\t\t\t\tfor n=1,TargetLayer do\r\n\t\t\t\t\t\t\tTargetLayerText = TargetLayerText .. \"-target\"\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tunit = unit .. TargetLayerText;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tlocal IsEx =true;\r\n\t\t\t\t\tlocal name;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif unit then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tname = amGetUnitName(unit,true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif name then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlocal tbl = SuperTreatmentDBF[\"Spells\"][\"List\"][index];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlocal Global_subgroup;\r\n\t\t\t\t\t\t\tlocal GlobalExcludedGroup = true;\r\n\t\t\t\t\t\t\tlocal GlobalExcludeTarget= true;\r\n\t\t\t\t\t\t\tlocal GlobalExcludeMT = true;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif tbl[\"ExcludedGroupChecked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name] and SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"] then\r\n\t\t\t\t\t\t\t\t\tGlobal_subgroup = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"];\r\n\t\t\t\t\t\t\t\t\tGlobalExcludedGroup = not tbl[\"ExcludedGroup\"][Global_subgroup];\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name] and SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"] then\r\n\t\t\t\t\t\t\t\t\tGlobal_subgroup = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"];\r\n\t\t\t\t\t\t\t\t\tGlobalExcludedGroup = not SuperTreatmentDBF[\"Unit\"][\"ExcludedGroup\"][Global_subgroup];\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif tbl[\"ExcludeTargetChecked\"] then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tGlobalExcludeTarget = not tbl[\"ExcludeTarget\"][name];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tGlobalExcludeTarget = not SuperTreatmentDBF[\"Unit\"][\"ExcludeTarget\"][name];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif tbl[\"ExcludeMTChecked\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal tblmt = stGetMtList();\t\t\r\n\t\t\t\t\t\t\t\tGlobalExcludeMT = not tblmt[name];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tIsEx = GlobalExcludedGroup and GlobalExcludeTarget and GlobalExcludeMT;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif not data[\"StopCastingChecked\"] then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlocal tbl = SuperTreatmentDBF[\"Spells\"][\"List\"][index];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif tbl[\"WaitSpellCastComplete\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlocal t = amIsPlayerCastSpell();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tIsEx = IsEx and not t;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif IsEx and unit and unitfr and (name or unit ==\"nogoal\" ) then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tlocal temp_v = ST.Unit_SpellsRun(data,unit);\r\n\t\t\t\r\n\t\t\t\t\t\tif data[\"subgroup\"] ~= -3 and data[\"subgroup\"] ~= -4 then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif unit and temp_v then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal tv ;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif data[\"PlayerChaosChecked\"] and UnitGUID(unit) == UnitGUID(\"player\") then\r\n\t\t\t\t\t\t\t\t\ttv = not UnitIsCorpse(unit) and not UnitIsDeadOrGhost(unit);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tlocal PowerCostChecked =amtoboolean(data[\"PowerCostChecked\"]);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal tempPowerCostChecked;\r\n\t\t\t\t\t\t\t\t\tif PowerCostChecked then\r\n\t\t\t\t\t\t\t\t\t\ttempPowerCostChecked=1;\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\ttv = amisr(namespell,unit,false,tempPowerCostChecked,false,data[\"StopCastingChecked\"] and true,nil,data[\"NoAcChecked\"]);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif not(unit ==\"nogoal\" or unit==\"none\") then\r\n\t\t\t\t\t\t\t\t\t\ttv = tv and UnitIsConnected(unit) and not UnitIsCorpse(unit) and not UnitIsDeadOrGhost(unit);\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif tv then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif data[\"AOEChecked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif data[\"CastingSpellStartOrEnd\"] and data[\"CastingSpellStartOrEnd\"][\"checked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal tbl = data[\"CastingSpellStartOrEnd\"][\"Start\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal checked = tbl[\"checked\"];\r\n\t\t\t\t\t\t\t\t\t\t\t--local isRadio = tbl[\"isRadio\"];\r\n\t\t\t\t\t\t\t\t\t\t\tlocal script;\r\n\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"Chat\"][\"text\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\tlocal channel = tbl[\"Chat\"][\"isRadio\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal Chat = tbl[\"Chat\"][\"channel\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*unit\",name or \"\");\r\n\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*spell\",namespell);\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t--print(text)\r\n\t\t\t\t\t\t\t\t\t\t\t--RunScript\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif checked then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tlocal namespell = amGetSpellName(data[\"spellId\"]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ChatChecked\"] and text ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif channel == \"channel\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"',nil,GetChannelName(\" .. Chat ..\"))\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telseif channel == \"print\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript =\"print('\" .. text ..\"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--RunScript(script);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.Cast[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ChatText\"]=script;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ChatCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ScriptChecked\"] and (tbl[\"script\"] or \"\") ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"script\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.Cast[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ScriptText\"]=text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Macro = strsub(text,1,1) == \"/\" ;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif Macro then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ScriptCommand\"]=amrun;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ScriptCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"SpellChecked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Spells =tbl[\"spell\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal text=\"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor i, data in pairs(Spells) do\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocal spellId = data[\"spellId\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocal spellType = data[\"Type\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocal name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif spellType==\"item\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=GetItemInfo(spellId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=\"/use \" .. name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telseif spellType==\"spell\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=GetSpellInfo(spellId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=\"/cast \" .. name ;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telseif spellType==\"macro\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=data[\"Macro\"];\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif text == \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext = name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext = text .. \"\\n\" .. name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif  text ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"DelayValue\"]== -1 then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDelayCastSpellMacro = text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t--print(100)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.Cast[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"SpellText\"]=text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"DelayValue\"]=tbl[\"DelayValue\"] or 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"SpellCommand\"]=amrun;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t--print(200)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal tbl = data[\"CastingSpellStartOrEnd\"][\"End\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal checked = tbl[\"checked\"];\r\n\t\t\t\t\t\t\t\t\t\t\t--local isRadio = tbl[\"isRadio\"];\r\n\t\t\t\t\t\t\t\t\t\t\tlocal script;\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal channel = tbl[\"Chat\"][\"isRadio\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal Chat = tbl[\"Chat\"][\"channel\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif checked then\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tlocal namespell = amGetSpellName(data[\"spellId\"]);\r\n\t\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"Chat\"][\"text\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ChatChecked\"] and text ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*unit\", \"[\".. (name or \"\") .. \"]\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*spell\",data[\"itemLink\"]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif channel == \"channel\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"',nil,GetChannelName(\" .. Chat ..\"))\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telseif channel == \"print\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript =\"print('\" .. text ..\"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.CastOver[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ChatText\"]=script;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ChatCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ScriptChecked\"] and (tbl[\"script\"] or \"\") ~= \"\"  then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"script\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.CastOver[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ScriptText\"]=text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Macro = strsub(text,1,1) == \"/\" ;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif Macro then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ScriptCommand\"]=amrun;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ScriptCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\taminspell(namespell,\"aoe\",amtoboolean(data[\"StopCastingChecked\"]),2,1);\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlocal CastOffSchem = SuperTreatmentDBF[\"Spells\"][\"List\"][index];\r\n\t\t\t\t\t\t\t\t\t\tlocal CastOffSchemName = CastOffSchem[\"name\"];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif CastOffSchem[\"CastOffSchem\"] then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif not ST.CastOffSchem.Cast[CastOffSchemName] then\r\n\t\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.Cast[CastOffSchemName]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.Cast[CastOffSchemName][namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.Cast[CastOffSchemName][namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlocal strtarget,t_unit ;\r\n\t\t\t\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t\t\t\t\tif data[\"Type\"] == \"item\"  or unit ==\"nogoal\" then\r\n\t\t\t\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t\t\t\t\t\tstrtarget=\"\";\r\n\t\t\t\t\t\t\t\t\t\t\tt_unit=\"\";\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t\t\t\t\t\tstrtarget = \"[target=\" .. unit .. \"]\";\r\n\t\t\t\t\t\t\t\t\t\t\tt_unit=unit;\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlocal gospell;\r\n\t\t\t\t\t\t\t\t\t\tlocal DelayCastSpellMacro;\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlocal CastingSpell = data[\"CastingSpell\"];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif CastingSpell and CastingSpell[\"Checked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\tlocal temp = addon:TblToMacro(CastingSpell[\"spell\"],strtarget);\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif temp ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\tgospell = temp;\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\telse\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif data[\"StopCastingChecked\"] and acspellname then\r\n\t\t\t\t\t\t\t\t\t\t\t\t--gospell = \"/stopcasting[nochanneling:\"..namespell ..\"]\\n/cast \" .. strtarget .. namespell;\r\n\t\t\t\t\t\t\t\t\t\t\t\tgospell = \"/stopcasting\\n/cast \" .. strtarget .. namespell\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tgospell = \"/cast \" .. strtarget .. namespell\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif data[\"CastingSpellStartOrEnd\"] and data[\"CastingSpellStartOrEnd\"][\"checked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal tbl = data[\"CastingSpellStartOrEnd\"][\"Start\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal checked = tbl[\"checked\"];\r\n\t\t\t\t\t\t\t\t\t\t\t--local isRadio = tbl[\"isRadio\"];\r\n\t\t\t\t\t\t\t\t\t\t\tlocal script;\r\n\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"Chat\"][\"text\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\tlocal channel = tbl[\"Chat\"][\"isRadio\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal Chat = tbl[\"Chat\"][\"channel\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*unit\",name or \"\");\r\n\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*spell\",namespell);\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t--print(text)\r\n\t\t\t\t\t\t\t\t\t\t\t--RunScript\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif checked then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tlocal namespell = amGetSpellName(data[\"spellId\"]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ChatChecked\"] and text ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif channel == \"channel\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"',nil,GetChannelName(\" .. Chat ..\"))\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telseif channel == \"print\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript =\"print('\" .. text ..\"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--RunScript(script);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.Cast[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ChatText\"]=script;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ChatCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ScriptChecked\"] and (tbl[\"script\"] or \"\") ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"script\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.Cast[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ScriptText\"]=text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Macro = strsub(text,1,1) == \"/\" ;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif Macro then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ScriptCommand\"]=amrun;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"ScriptCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"SpellChecked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Spells =tbl[\"spell\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal text=\"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor i, data in pairs(Spells) do\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocal spellId = data[\"spellId\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocal spellType = data[\"Type\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocal name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif spellType==\"item\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=GetItemInfo(spellId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=\"/use \" .. name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telseif spellType==\"spell\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=GetSpellInfo(spellId);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=\"/cast \" .. name ;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telseif spellType==\"macro\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname=data[\"Macro\"];\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif text == \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext = name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext = text .. \"\\n\" .. name;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif  text ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"DelayValue\"]== -1 then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDelayCastSpellMacro = text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t--print(100)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.Cast[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"SpellText\"]=text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"DelayValue\"]=tbl[\"DelayValue\"] or 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.Cast[namespell][\"SpellCommand\"]=amrun;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t--print(200)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal tbl = data[\"CastingSpellStartOrEnd\"][\"End\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal checked = tbl[\"checked\"];\r\n\t\t\t\t\t\t\t\t\t\t\t--local isRadio = tbl[\"isRadio\"];\r\n\t\t\t\t\t\t\t\t\t\t\tlocal script;\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal channel = tbl[\"Chat\"][\"isRadio\"]\r\n\t\t\t\t\t\t\t\t\t\t\tlocal Chat = tbl[\"Chat\"][\"channel\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif checked then\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tlocal namespell = amGetSpellName(data[\"spellId\"]);\r\n\t\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"Chat\"][\"text\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ChatChecked\"] and text ~= \"\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--local playerClass, englishClass = UnitClass(unit);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--local color = RAID_CLASS_COLORS[englishClass];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--local NameRGBToHex = RGBPercToHex(color.r,color.g,color.b)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--text=gsub(text,\"*unit\", \"[\"..NameRGBToHex .. (name or \"\") .. \"|r]\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*unit\", \"[\".. (name or \"\") .. \"]\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext=gsub(text,\"*spell\",data[\"itemLink\"]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif channel == \"channel\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"',nil,GetChannelName(\" .. Chat ..\"))\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telseif channel == \"print\" then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript =\"print('\" .. text ..\"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript = \"SendChatMessage('\" .. text ..\"','\" .. channel .. \"')\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--SendChatMessage(\">>\" .. text,channel,nil,GetChannelName(Chat));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--RunScript(script)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t--print(script);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.CastOver[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ChatText\"]=script;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ChatCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif tbl[\"ScriptChecked\"] and (tbl[\"script\"] or \"\") ~= \"\"  then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal text = tbl[\"script\"] or \"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif not ST.CastSpell.CastOver[namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ScriptText\"]=text;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"target\"]=unit;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Macro = strsub(text,1,1) == \"/\" ;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif Macro then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ScriptCommand\"]=amrun;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tST.CastSpell.CastOver[namespell][\"ScriptCommand\"]=RunScript;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlocal CastOffSchem = SuperTreatmentDBF[\"Spells\"][\"List\"][index];\r\n\t\t\t\t\t\t\t\t\t\tlocal CastOffSchemName = CastOffSchem[\"name\"];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif CastOffSchem[\"CastOffSchem\"] then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif not ST.CastOffSchem.Cast[CastOffSchemName] then\r\n\t\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.Cast[CastOffSchemName]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\tif not ST.CastOffSchem.Cast[CastOffSchemName][namespell] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.Cast[CastOffSchemName][namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.Cast[CastOffSchemName][namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif CastOffSchem[\"CastOffSchemEnd\"] then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif not ST.CastOffSchem.End[CastOffSchemName] then\r\n\t\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.End[CastOffSchemName]={};\r\n\t\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.End[CastOffSchemName][namespell]={};\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tST.CastOffSchem.End[CastOffSchemName][namespell][\"time\"]=GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif DelayCastSpellMacro and not data[\"CastingSpell\"][\"Checked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = gospell .. \"\\n\" .. DelayCastSpellMacro;\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif SuperTreatmentDBF[\"Config\"][\"aminspellGo_checked\"] then\r\n\t\t\t\t\t\t\t\t\t\t\taminspell(gospell,\"Macro\");\r\n\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t--gospell = gospell .. \";#\" .. namespell .. \"#\"..t_unit;\r\n\t\t\t\t\t\t\t\t\t\t\tamrun(gospell,t_unit,false,false,namespell);\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif data[\"DelayChecked\"] then\r\n\t\t\t\t\t\t\t\t\t--print(amGetSpellName(data[\"spellId\"]),data[\"DelayValue\"],unit)\r\n\t\t\t\t\t\t\t\t\t\tamdelay(amGetSpellName(data[\"spellId\"]),data[\"DelayValue\"],unit)\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\telseif data[\"subgroup\"] == -3 and temp_v then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlocal checked = data[\"PropertiesSetChecked\"];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlocal gospell,MacroTbl;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif data[\"id\"] then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor k, t in pairs(SuperTreatmentDBF[\"Macro\"]) do\r\n\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif t[\"id\"] == data[\"id\"] then\r\n\t\t\t\t\t\t\t\t\t\tgospell=t[\"Macro\"];\r\n\t\t\t\t\t\t\t\t\t\tMacroTbl = t;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tgospell = data[\"Macro\"];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\tif checked ==1 then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif data[\"Type\"]==\"script\" then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t--gospell=gsub(gospell,\"*unit\",unit);\r\n\t\t\t\t\t\t\t\t\tgospell = \"/Script \" .. gospell;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telseif data[\"Type\"]==\"macro\" then\r\n\t\t\t\t\t\t\t\t\t--gospell=gsub(gospell,\"*unit\",unit);\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t--gospell=gsub(gospell,\"\\\\n\",strchar(13));\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,unit);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif SuperTreatmentDBF[\"Config\"][\"aminspellGo_checked\"] then\r\n\t\t\t\t\t\t\t\t\taminspell(gospell,\"Macro\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tamrun(gospell);\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t--ST.showruninf(data[\"itemLink\"],unit);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif not data[\"PropertiesSet_Continue_Checked\"] then\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif checked ==2 then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t--[[\r\n\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,unit);\r\n\t\t\t\t\t\t\t\tRunScript(gospell);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t--]]\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal v;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif MacroTbl and MacroTbl[\"time\"] then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif MacroTbl[\"func\"] and MacroTbl[\"time\"] == MacroTbl[\"functime\"] and checked == MacroTbl[\"runType\"] then\r\n\t\t\t\t\t\t\t\t\t\t\tv = MacroTbl[\"func\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,\"SuperTreatment_Run_unit\",true);\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = \"return function(SuperTreatment_Run_unit) \\n\" .. gospell .. \"\\n end\";\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal func = assert(loadstring(gospell));\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal vv = func();\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif vv then\r\n\t\t\t\t\t\t\t\t\t\t\t\tif MacroTbl and MacroTbl[\"time\"] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Stime = GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"func\"] = vv;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"time\"] = Stime;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"functime\"] = Stime;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"runType\"] = checked;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tv = vv;\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telse\r\n\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,unit);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal func = assert(loadstring(gospell));\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tv = func;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal vr = v(unit);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif not data[\"PropertiesSet_Continue_Checked\"] then\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif checked ==3 then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal v;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif MacroTbl and MacroTbl[\"time\"] then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif MacroTbl[\"func\"] and MacroTbl[\"time\"] == MacroTbl[\"functime\"] and checked == MacroTbl[\"runType\"] then\r\n\t\t\t\t\t\t\t\t\t\t\tv = MacroTbl[\"func\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,\"SuperTreatment_Run_unit\",true);\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = \"return function(SuperTreatment_Run_unit) \\n\" .. gospell .. \"\\n end\";\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal func = assert(loadstring(gospell));\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal vv = func();\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif vv then\r\n\t\t\t\t\t\t\t\t\t\t\t\tif MacroTbl and MacroTbl[\"time\"] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Stime = GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"func\"] = vv;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"time\"] = Stime;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"functime\"] = Stime;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"runType\"] = checked;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tv = vv;\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telse\r\n\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,unit);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal func = assert(loadstring(gospell));\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tv = func;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal vr = v(unit);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif not data[\"PropertiesSet_Continue_Checked\"] then\r\n\t\t\t\t\t\t\t\t\tif vr then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\treturn vr;\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tif vr then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif checked ==4 then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\tlocal v;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif MacroTbl and MacroTbl[\"time\"] then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif MacroTbl[\"func\"] and MacroTbl[\"time\"] == MacroTbl[\"functime\"] and checked == MacroTbl[\"runType\"] then\r\n\t\t\t\t\t\t\t\t\t\t\tv = MacroTbl[\"func\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = gospell .. \"\\n if true then return false; end;\";\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,\"SuperTreatment_Run_unit\",true);\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tgospell = \"return function(SuperTreatment_Run_unit) \\n\" .. gospell .. \"\\n end\";\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal func = assert(loadstring(gospell));\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tlocal vv = func();\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif vv then\r\n\t\t\t\t\t\t\t\t\t\t\t\tif not isunit and MacroTbl and MacroTbl[\"time\"] then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlocal Stime = GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"func\"] = vv;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"time\"] = Stime;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"functime\"] = Stime;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMacroTbl[\"runType\"] = checked;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tv = vv;\r\n\t\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telse\r\n\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,unit);\r\n\t\t\t\t\t\t\t\t\tgospell = gospell .. \"\\n if true then return false; end;\"\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal func = assert(loadstring(gospell));\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tv = func;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal vr = v(unit);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif not data[\"PropertiesSet_Continue_Checked\"] then\r\n\t\t\t\t\t\t\t\t\tif vr then\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\treturn vr;\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tif vr then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\r\n\r\n\t\t\t\t\t\t\t\t--[[\r\n\t\t\t\t\t\t\t\tgospell = ST.MacroFinishing(gospell,unit);\r\n\t\t\t\t\t\t\t\tgospell = gospell .. \"\\n if true then return false; end;\"\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal func = assert(loadstring(gospell));\r\n\t\t\t\t\t\t\t\tlocal v= func();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif v == nil then\r\n\t\t\t\t\t\t\t\t\t\tv = true;\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t--print(v,false)\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif not data[\"PropertiesSet_Continue_Checked\"] then\r\n\t\t\t\t\t\t\t\t\tif v then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\treturn v;\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tif v then\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t--]]\r\n\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\telseif data[\"subgroup\"] == -4 and temp_v then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlocal Run_ApiDbf_v;\r\n\t\t\t\t\t\t\tlocal Run_ApiDbf = data[\"ApiDbf\"];\r\n\t\t\t\t\t\t\tlocal Run_ApiDbf_tbl=Run_ApiDbf[1];\r\n\t\t\t\t\t\t\tRun_ApiDbf_v = ST.Unit_SpellsRun_Run_ApiDbf(Run_ApiDbf_tbl,unit);\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif Run_ApiDbf_v then\r\n\t\t\t\t\t\t\t\t--ST.showruninf(data[\"itemLink\"],unit);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlocal apiinf = SuperTreatment[\"Api\"][Run_ApiDbf_tbl[\"id\"]] ;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t--print(apiinf[\"end\"])\r\n\t\t\t\t\t\t\t\treturn true,apiinf[\"end\"];\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\r\n\t\tend\r\n\t\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\r\nend\r\n\r\n\r\n\r\n\r\nfunction ST.AmminimumFast_SpellsRun(data,u)\r\n\t\r\n\tlocal v = data[\"unit\"];\r\n\tif u then\r\n\t\tv = u;\r\n\tend\r\n\t\r\n\tlocal tbl = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][v][\"AmminimumFast\"];\r\n\tlocal MultitaskingChecked=tbl[\"MultitaskingChecked\"];\r\n\t\r\n\tif not ST.Multitasking[v] then\r\n\t\tST.Multitasking[v]={};\r\n\t\t\r\n\tend\r\n\tlocal tb = ST.Multitasking[v];\r\n\t\r\n\tif MultitaskingChecked then\r\n\t\t\r\n\t\tif not ST.Multitasking[v][\"MultitaskingStart\"] then\r\n\t\t\r\n\t\t\tST.Multitasking[v][\"MultitaskingStart\"]=true;\r\n\t\t\t\r\n\t\t\tST[\"Multitasking\"][\"MultitaskingStart\"]=true;\r\n\t\t\r\n\t\t\tlocal Count=ST[\"Multitasking\"][\"Count\"];\r\n\t\t\t\r\n\t\t\tif not Count then\r\n\t\t\t\tCount=1;\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\t\ttb.thread = coroutine.create(amGetHandle(ST.AmminimumFast_SpellsRun_1));\r\n\t\t\r\n\t\t\ttb.frame = CreateFrame(\"Frame\") \r\n\t\t\t\r\n\t\t\tif not tbl.MultitaskingTime or tbl.MultitaskingTime<50 then\r\n\t\t\t\ttbl.MultitaskingTime=50;\r\n\t\t\tend\r\n\t\t\ttb.counter = 0 \r\n\t\t\tlocal throttle = tbl.MultitaskingTime/1000/Count;\r\n\t\t\tif throttle<0.001  then\r\n\t\t\t\tthrottle=0.001;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif not tbl.func then\r\n\t\t\t\r\n\t\t\t\ttb.func = function(self, elapsed) \r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t  tb.counter = tb.counter + elapsed \r\n\t\t\t\t  if tb.counter >= throttle then\r\n\t\t\t\t  \r\n\t\t\t\t\t tb.counter = tonumber(format(\"%.4f\",tb.counter - throttle)) ;\r\n\t\t\t\t\t \r\n\t\t\t\t\t if coroutine.status(tb.thread) ~= \"dead\" then\r\n\t\t\t\t\t \r\n\t\t\t\t\t\tcoroutine.resume(tb.thread,data,u,v) ;\r\n\t\t\t\t\t end\r\n\t\t\t\t\t \r\n\t\t\t\t  end\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\ttb.frame:SetScript(\"OnUpdate\", tb.func);\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\tend\r\n\telse\r\n\t\r\n\t\treturn ST.AmminimumFast_SpellsRun_2(data,u);\r\n\t\t\r\n\tend\r\nend\r\n\r\nfunction ST.AmminimumFast_SpellsRun_1(data,u,v)\r\n\t\r\n\t---print(\">>99<<\",data,u,v)\r\n\tlocal IsExit=true;\r\n\t\r\n\tlocal tbl = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][v];\r\n\tlocal i=1;\r\n\t\r\n\twhile IsExit do\r\n\t\t\t\t \r\n\t  \r\n\t   local r1;\r\n\t   ST[\"Multitasking\"][v][\"ReturnsUnit\"],r1 =ST.AmminimumFast_SpellsRun_2(data,u);\r\n\t   \r\n\t   \r\n\t   if r1 then coroutine.yield(); end;\r\n\t   \r\n\t    if not ST[\"Multitasking\"][\"MultitaskingStart\"] then\r\n\t\t\tST.Multitasking[v][\"MultitaskingStart\"]=nil;\r\n\t\t\ttbl[\"AmminimumFast\"][\"func\"]=nil;\r\n\t\t\t\r\n\t\t\tIsExit=false;\r\n\t   end\r\n\t  -- print(i,ST[\"Multitasking\"][v][\"ReturnsUnit\"]);\r\n\t   i=i+1;\r\n\t   \r\n\tend\r\nend\r\n\r\nfunction ST.AmminimumFast_SpellsRun_2(data,u)\r\n\t\r\n\tlocal v = data[\"unit\"];\r\n\tif u then\r\n\t\tv = u;\r\n\tend\r\n\t\r\n\tlocal TBL = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][v];\r\n\tlocal unit;\r\n\tlocal Code,group,buff,spell,Class,SpellDistanceChecked,DistanceChecked,Distancevalue,AmminimumFastCode,Nobuff,NoDistanceChecked;\r\n\tlocal Maximum,MaximumCode,MinimumCode;\r\n\tlocal Minimumchecked = TBL[\"AmminimumFast\"][\"Minimumchecked\"];\r\n\tlocal Maximumchecked = TBL[\"AmminimumFast\"][\"Maximumchecked\"];\r\n\tlocal FireHasBeen;\r\n\t\r\n\t\r\n\tlocal MultitaskingChecked = ST.Multitasking[v][\"MultitaskingStart\"] and TBL[\"AmminimumFast\"][\"MultitaskingChecked\"];\r\n\t\t\r\n\t\r\n\tlocal namespell,Rank,PowerCostChecked;\r\n\t\tif data[\"spellId\"] then\r\n\t\t\tnamespell,Rank = GetSpellInfo(data[\"spellId\"]);\r\n\t\t\tif data[\"RankChecked\"] and Rank and Rank ~= \"\" then\r\n\t\t\t\tnamespell = amGetSpellName(data[\"spellId\"]);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tPowerCostChecked =amtoboolean(data[\"PowerCostChecked\"]);\r\n\t\tend\r\n\t\r\n\tif TBL.types ==\"unit\" or TBL[\"unitchecked\"] then\r\n\t\tunit = TBL[\"unit\"];\r\n\t\t \r\n\t\treturn unit;\r\n\t\t\r\n\telseif TBL.types ==\"RangeCheckAngle\" and TBL[\"PlayerRangeCheckAngle\"] then\r\n\t\t\r\n\t\tif not st_Unit_Health:GetScript(\"OnEvent\") then\r\n\t\t\t\r\n\t\t\tst_Unit_Health:SetScript(\"OnEvent\", EVENTS_UNIT_HEALTH);\r\n\t\t\tst_Unit_Health:RegisterEvent(\"UNIT_HEALTH\");\r\n\t\t\tst_Unit_Health:RegisterEvent(\"PARTY_MEMBERS_CHANGED\");\r\n\t\t\tst_Unit_Health:RegisterEvent(\"RAID_ROSTER_UPDATE\");\r\n\t\t\tst_Unit_Health:RegisterEvent(\"UPDATE_BATTLEFIELD_STATUS\");\r\n\t\t\tst_Unit_Health:RegisterEvent(\"UNIT_CONNECTION\");\r\n\t\t\tst_Unit_Health:RegisterEvent(\"PARTY_MEMBER_ENABLE\"); \r\n\t\t\tst_Unit_Health:RegisterEvent(\"PARTY_MEMBER_DISABLE\");\r\n\t\t\tst_Unit_Health:RegisterEvent(\"PARTY_LEADER_CHANGED\");\r\n\t\t\tst_Unit_Health:RegisterEvent(\"PARTY_CONVERTED_TO_RAID\");\r\n\t\t\tEVENTS_UNIT_HEALTH_REST();\r\n\t\tend\r\n\t\t\r\n\t\tif TBL[\"PlayerRangeCheckAngle\"][\"Min_Max\"][\"Type\"]==\"Minimum_Blood_Percentage\" then\r\n\t\t\t\r\n\t\t\tfor i, v in pairs(ST.UNIT_HEALTHS.Health_Percentage_Min) do\r\n\t\t\t\t\r\n\t\t\t\tif v.Enable then\r\n\t\t\t\t\tunit = ST.mminimumFast_SpellsRun_RangeCheckAngle(TBL,v.UnitId);\r\n\t\t\t\t\r\n\t\t\t\t\tif unit then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn unit;\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\telseif TBL[\"PlayerRangeCheckAngle\"][\"Min_Max\"][\"Type\"]==\"Maximum_LackBlood\" then\r\n\t\t\t\r\n\t\t\tfor i, v in pairs(ST.UNIT_HEALTHS.LackHealth_Max) do\r\n\t\t\t\t\r\n\t\t\t\tif v.Enable then\r\n\t\t\t\t\tunit = ST.mminimumFast_SpellsRun_RangeCheckAngle(TBL,v.UnitId);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif unit then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn unit;\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\telseif TBL.types ==\"function\" or TBL[\"functionchecked\"] then\r\n\t\t\r\n\t\tlocal Script = TBL[\"function\"];\r\n\t\tlocal func = assert(loadstring(Script));\r\n\t\tunit = func();\r\n\t\t \r\n\t\treturn unit;\r\n\t\t\r\n\telseif TBL.types ==\"AmminimumFast\" or TBL[\"AmminimumFastchecked\"] then\r\n\t\t\r\n\t\t\t\r\n\t\tgroup = TBL[\"AmminimumFast\"][\"group\"];\r\n\t\t\r\n\t\t--if group == \"partyraid\" and GetNumGroupMembers()>0 then\r\n\t\tif group == \"partyraid\" and UnitInRaid(\"player\") then\r\n\t\t\t\t\r\n\t\t\tgroup = \"raid\";\r\n\t\t\t\r\n\t\telseif group == \"partyraid\" and GetNumSubgroupMembers()>0 then\r\n\t\t\t\r\n\t\t\tgroup = \"party\";\r\n\t\t\t\r\n\t\telseif group == \"partyraidpet\" and GetNumGroupMembers()>0 then\r\n\t\t\t\r\n\t\t\tgroup = \"raidpet\";\r\n\t\t\t\r\n\t\telseif group == \"partyraid\" and GetNumSubgroupMembers()>0 then\r\n\t\t\t\r\n\t\t\tgroup = \"partypet\"\r\n\t\t\t\r\n\t\telseif group == \"partyraid\" and GetNumSubgroupMembers()==0 and  GetNumGroupMembers() ==0 then\r\n\t\t\t\r\n\t\t\tgroup = \"party\"\r\n\t\t\t\r\n\t\telseif group == \"partyraidpet\" and GetNumSubgroupMembers()==0 and  GetNumGroupMembers() ==0 then\r\n\t\t\t\r\n\t\t\tgroup = \"party\"\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\tSpellDistanceChecked = TBL[\"AmminimumFast\"][\"SpellDistanceChecked\"];\r\n\t\tDistanceChecked = TBL[\"AmminimumFast\"][\"DistanceChecked\"];\r\n\t\tDistancevalue = TBL[\"AmminimumFast\"][\"Distancevalue\"];\r\n\t\tNoDistanceChecked = TBL[\"AmminimumFast\"][\"NoDistanceChecked\"]\r\n\t\t\r\n\t\tif Minimumchecked then\r\n\t\t\t\r\n\t\t\tMinimumCode = TBL[\"AmminimumFast\"][\"Minimum\"][\"CodeFunction\"]\r\n\t\t\tif not MinimumCode then\r\n\t\t\t\r\n\t\t\t\tlocal temp = TBL[\"AmminimumFast\"][\"Minimum\"][\"Code\"];\r\n\t\t\t\tif temp then\r\n\t\t\t\t\tRunScript(\"function SuperTreatment_AmminimumFast_temp(unit) return \" .. temp .. \"; end\")\r\n\t\t\t\t\tMinimumCode = SuperTreatment_AmminimumFast_temp;\r\n\t\t\t\t\tSuperTreatment_AmminimumFast_temp = nil;\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\tend\r\n\t\t\t\r\n\t\tif Maximumchecked then\r\n\t\t\r\n\t\t\tMaximumCode = TBL[\"AmminimumFast\"][\"Maximum\"][\"CodeFunction\"]\r\n\t\t\tif not MaximumCode then\r\n\t\t\t\r\n\t\t\t\tlocal temp = TBL[\"AmminimumFast\"][\"Maximum\"][\"Code\"];\r\n\t\t\t\tif temp then\r\n\t\t\t\t\tRunScript(\"function SuperTreatment_AmminimumFast_temp(unit) return \" .. temp .. \"; end\")\r\n\t\t\t\t\tMaximumCode = SuperTreatment_AmminimumFast_temp;\r\n\t\t\t\t\tSuperTreatment_AmminimumFast_temp = nil;\r\n\t\t\t\tend\r\n\t\t\tend\t\r\n\t\t\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif TBL[\"AmminimumFast\"][\"CodeChecked\"] then\r\n\t\t\r\n\t\t\tAmminimumFastCode = TBL[\"AmminimumFast\"][\"CodeFunction\"]\r\n\t\t\tif not AmminimumFastCode then\r\n\t\t\t\r\n\t\t\t\tlocal temp = TBL[\"AmminimumFast\"][\"Code\"];\r\n\t\t\t\tif temp then\r\n\t\t\t\t\tRunScript(\"function SuperTreatment_AmminimumFast_temp(unit) return \" .. temp .. \"; end\")\r\n\t\t\t\t\tAmminimumFastCode = SuperTreatment_AmminimumFast_temp;\r\n\t\t\t\t\tSuperTreatment_AmminimumFast_temp = nil;\r\n\t\t\t\tend\r\n\t\t\tend\t\r\n\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif TBL[\"AmminimumFast\"][\"buffchecked\"] then\r\n\t\t\r\n\t\t\t----buff = TBL[\"AmminimumFast\"][\"buff\"];\r\n\t\t\tbuff = TBL[\"AmminimumFast\"][\"NewBuff\"][\"buffs\"];\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif TBL[\"AmminimumFast\"][\"Nobuffchecked\"] then\r\n\t\t\t\r\n\t\t\t--Nobuff = TBL[\"AmminimumFast\"][\"Nobuff\"];\r\n\t\t\tNobuff = TBL[\"AmminimumFast\"][\"NewNobuff\"][\"buffs\"]\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif TBL[\"AmminimumFast\"][\"spellchecked\"] then\r\n\t\t\r\n\t\t\t--spell = TBL[\"AmminimumFast\"][\"spell\"];\r\n\t\t\tspell = TBL[\"AmminimumFast\"][\"NewSpell\"];\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif TBL[\"AmminimumFast\"][\"Classchecked\"] then\r\n\t\t\r\n\t\t\tClass = TBL[\"AmminimumFast\"][\"Class\"];\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif not TBL[\"AmminimumFast\"][\"ApiDbf\"] then\r\n\t\t\t\r\n\t\t\tTBL[\"AmminimumFast\"][\"ApiDbf\"]={};\r\n\t\tend\r\n\t\t\r\n\t\tlocal ApiDbf = ST.Unit_SpellsRun_2_ApiDbf_Count(TBL[\"AmminimumFast\"])>0;\r\n\t\t\r\n\t\t\r\n\t\t--if not(MinimumCode or MaximumCode or buff or spell or Class or Nobuff or TBL[\"AmminimumFast\"][\"Countchecked\"] or ApiDbf) then\r\n\t\t\t \r\n\t\t\t--return false;\r\n\t\t--end\r\n\t\t\r\n\t\t--local temp = TBL[\"AmminimumFast\"][\"group\"]\r\n\t\t\r\n\t\tlocal temp = group;\r\n\t\tlocal Members;\r\n\t\t\r\n\t\tlocal disabled =  temp == \"maintank\" or temp == \"party\" or temp == \"partypet\" or temp == \"raid\" or temp == \"raidpet\" or temp == \"arena\" ;\r\n\t\t\t\r\n\t\tif temp == \"FireHasBeenSet\" then\r\n\t\r\n\t\t\tlocal FireHasBeenSetValue =TBL[\"AmminimumFast\"][\"FireHasBeenSetValue\"];\r\n\t\t\tif not FireHasBeenSetValue then\r\n\t\t\t\t \r\n\t\t\t\treturn false;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal FireHasBeenSet, u = amCountAttack();\r\n\t\t\tif FireHasBeenSet >= FireHasBeenSetValue then\r\n\t\t\t\r\n\t\t\t\tFireHasBeen=u;\r\n\t\t\telse\r\n\t\t\t\t \r\n\t\t\t\treturn false;\r\n\t\t\tend\r\n\t\t\t\r\n\r\n\t\t\r\n\t\telseif temp == \"SelectedTarget\" then\r\n\t\t\r\n\t\t\tif TBL[\"AmminimumFast\"][\"Group_SelectedTarget\"][\"name\"] then\r\n\t\t\t\tFireHasBeen = TBL[\"AmminimumFast\"][\"Group_SelectedTarget\"][\"name\"];\r\n\t\t\telse\r\n\t\t\t\t \r\n\t\t\t\treturn false;\r\n\t\t\tend\r\n\t\t\t\r\n\t\telseif temp == \"maintank1\" or \r\n\t\t\t\ttemp == \"maintank2\" or \r\n\t\t\t\ttemp == \"maintank3\" or \r\n\t\t\t\ttemp == \"maintank4\" or \r\n\t\t\t\ttemp == \"maintank5\" or \r\n\t\t\t\ttemp == \"maintank6\" or \r\n\t\t\t\ttemp == \"maintank7\" or \r\n\t\t\t\ttemp == \"maintank8\"  then\r\n\t\t\t\r\n\t\t\tlocal tbl =SuperTreatmentDBF[\"Unit\"][\"RaidList\"][temp];\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tlocal MT = SuperTreatmentDBF[\"Unit\"][\"MTList\"]\r\n\t\t\t\r\n\t\t\tlocal index = tonumber(strsub(temp,9,9));\r\n\t\t\tif MT[\"TypeChecked\"]==1 then\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tFireHasBeen = MT[\"Default\"][index] or \"\";\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\telseif MT[\"TypeChecked\"]==2 then\r\n\t\t\r\n\t\t\t\tFireHasBeen = MT[\"Custom\"][index];\r\n\t\t\t\r\n\t\t\tend\r\n\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\telseif not disabled and temp ~= \"SelectedTarget\" and temp ~= \"FireHasBeenSet\" then\t\r\n\t\t\tFireHasBeen = temp;\r\n\t\tend\r\n\t\r\n\t\t\r\n\t\t\r\n\t\tlocal value,temp,v_unit,name,s_unit;\r\n\t\tlocal Count =0;\r\n\t\tlocal MaximumValue,MinimumValue;\r\n\t\tlocal MaximumUnit,MinimumUnit;\r\n\t\t\r\n\t\tif FireHasBeen then\r\n\t\t\t\r\n\t\t\tMembers =1;\r\n\t\t\t\r\n\t\telse\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\tif group == \"party\" or group==\"partypet\"   then\r\n\t\t\t\tMembers =GetNumSubgroupMembers()+1 ;\r\n\t\t\telseif group==\"raid\"  or group==\"raidpet\" then\r\n\t\t\t\tMembers =GetNumGroupMembers() ;\r\n\t\t\telseif group==\"arena\" then\r\n\t\t\t\tMembers =5;\r\n\t\t\telseif group==\"arenapet\" then\r\n\t\t\t\tMembers =5;\r\n\t\t\telseif group==\"maintank\" then\r\n\t\t\t\tMembers =8;\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif MultitaskingChecked and Members<=0 then\r\n\t\t\tST.Multitasking[\"Count\"]=1;\r\n\t\t\tcoroutine.yield();\r\n\t\telse\r\n\t\t\tST.Multitasking[\"Count\"]=Members;\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tfor i=1, Members do\r\n\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tlocal isok=true;\r\n\t\t\tif  FireHasBeen then\r\n\t\t\t\r\n\t\t\t\tunit = FireHasBeen;\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif i==Members and group == \"party\" then\r\n\t\t\t\t\tunit=\"player\"\r\n\t\t\t\telseif i==Members and group == \"partypet\" then\r\n\t\t\t\t\tunit=\"pet\"\r\n\t\t\t\t\t\r\n\t\t\t\telseif group == \"maintank\" then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tlocal RDB =SuperTreatmentDBF[\"Unit\"][\"RaidList\"];\r\n\t\t\t\t\tlocal MT = SuperTreatmentDBF[\"Unit\"][\"MTList\"];\r\n\t\t\t\t\tlocal MTindex=i;\r\n\t\t\t\t\tlocal tbl = RDB[group .. tostring(MTindex)];\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif MT[\"TypeChecked\"]==1 then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tunit = MT[\"Default\"][MTindex];\r\n\t\t\t\t\t\tif not unit then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tunit=\"\";\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t--tbl[\"unit\"]=unit;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telseif MT[\"TypeChecked\"]==2 then\r\n\t\t\t\t\r\n\t\t\t\t\t\tunit = MT[\"Custom\"][MTindex];\r\n\t\t\t\t\t\t--tbl[\"unit\"]=unit;\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\tunit=group .. tostring(i);\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal TargetLayer = TBL[\"AmminimumFast\"][\"TargetLayer\"] or 0;\r\n\t\t\tlocal TargetLayerText=\"\";\r\n\t\r\n\t\t\tfor n=1,TargetLayer do\r\n\t\t\t\tTargetLayerText = TargetLayerText .. \"-target\"\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tunit = unit .. TargetLayerText;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif unit then\r\n\t\t\t\tname = amGetUnitName(unit,true);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif MultitaskingChecked then\r\n\t\t\r\n\t\t\t\tcoroutine.yield();\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal IsEx;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif  name then\r\n\t\t\t--print(name,SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name])\r\n\t\t\t\tlocal ExcludedTarget = not TBL[\"AmminimumFast\"][\"ExcludedTarget\"][name];\r\n\t\t\t\t\r\n\t\t\t\tlocal ExcludedGroup =true;\r\n\t\t\t\tif TBL[\"AmminimumFast\"][\"ExcludedGroup\"] and SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name] and SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"] then\r\n\t\t\t\t\tExcludedGroup = not TBL[\"AmminimumFast\"][\"ExcludedGroup\"][SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"]];\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tlocal index = ST[\"Spells_Index\"];\r\n\t\t\t\t\t\t\r\n\t\t\t\tlocal tbl = SuperTreatmentDBF[\"Spells\"][\"List\"][index];\r\n\t\t\t\t\t\t\r\n\t\t\t\tlocal Global_subgroup;\r\n\t\t\t\tlocal GlobalExcludedGroup = true;\r\n\t\t\t\tlocal GlobalExcludeTarget= true;\r\n\t\t\t\tlocal GlobalExcludeMT = true;\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"ExcludedGroupChecked\"] then\r\n\t\t\t\t\r\n\t\t\t\t\tif SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name] and SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"] then\r\n\t\t\t\t\t\tGlobal_subgroup = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"];\r\n\t\t\t\t\t\tGlobalExcludedGroup = not tbl[\"ExcludedGroup\"][Global_subgroup];\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\t\tif SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name] and SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"] then\r\n\t\t\t\t\t\tGlobal_subgroup = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][name][\"subgroup\"];\r\n\t\t\t\t\t\tGlobalExcludedGroup = not SuperTreatmentDBF[\"Unit\"][\"ExcludedGroup\"][Global_subgroup];\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"ExcludeTargetChecked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\tGlobalExcludeMTChecked = not tbl[\"ExcludeTarget\"][name];\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\t\tGlobalExcludeTarget = not SuperTreatmentDBF[\"Unit\"][\"ExcludeTarget\"][name];\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t \t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"ExcludeMTChecked\"] then\r\n\t\t\t\t\r\n\t\t\t\t\tlocal tblmt = stGetMtList();\t\t\r\n\t\t\t\t\tGlobalExcludeMT = not tblmt[name];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tIsEx = ExcludedGroup and ExcludedTarget and GlobalExcludedGroup and GlobalExcludeTarget and GlobalExcludeMT;\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif name and IsEx and unitfr then\r\n\t\t\t\r\n\t\t\t\t--local tv = amisr(namespell,unit) and UnitIsConnected(unit) and not UnitIsCorpse(unit) and not UnitIsDeadOrGhost(unit);\r\n\t\t\t\t\r\n\t\t\t\tlocal tv;\r\n\t\t\t\t\r\n\t\t\t\tif TBL[\"AmminimumFast\"][\"GhostChecked\"] then\r\n\t\t\t\t\ttv =  UnitIsConnected(unit) and not UnitIsCorpse(unit) and not UnitIsDeadOrGhost(unit);\r\n\t\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\ttv =true;\r\n\t\t\t\t\t\r\n\t\t\t\tend \r\n\t\t\t\t\r\n\t\t\t\tif tv then\r\n\t\t\t\t\r\n\t\t\t\t\tif SpellDistanceChecked then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t--tv = amisr(namespell,unit,false,PowerCostChecked,false,true)\r\n\t\t\t\t\t\tlocal tempPowerCostChecked;\r\n\t\t\t\t\t\tif PowerCostChecked then\r\n\t\t\t\t\t\t\ttempPowerCostChecked=1;\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\ttv = amisr(namespell,unit,false,tempPowerCostChecked,false,true,nil,data[\"NoAcChecked\"]);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telseif NoDistanceChecked then\r\n\t\t\t\t\t\r\n\t\t\t\t\telseif DistanceChecked then\r\n\t\t\t\t\t\ttv = amjl(unit) <= Distancevalue;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif name and tv then\r\n\t\t\t\t\t\r\n\t\t\t\t\tlocal v_buff,v_spell,v_Class,v_code,v_Nobuff,v_ApiDbf,v_RangeCheckAngle;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif buff then\r\n\t\t\t\t\t\tv_buff = ST.mminimumFast_SpellsRun_buff(unit,buff,TBL,TBL[\"AmminimumFast\"][\"NewBuff\"]);\r\n\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tv_buff = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tisok = isok and v_buff;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif Nobuff and isok then\r\n\t\t\t\t\t\t--v_Nobuff = ST.mminimumFast_SpellsRun_Nobuff(unit,Nobuff,TBL,TBL[\"AmminimumFast\"][\"NewNobuff\"]);\r\n\t\t\t\t\t\tv_Nobuff = not ST.mminimumFast_SpellsRun_buff(unit,Nobuff,TBL,TBL[\"AmminimumFast\"][\"NewNobuff\"]);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tv_Nobuff = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tisok = isok and v_Nobuff;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif spell  and isok then\r\n\t\t\t\t\t\tv_spell = ST.mminimumFast_SpellsRun_spell(unit,TBL[\"AmminimumFast\"][\"NewSpell\"]);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tv_spell = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\tisok = isok and v_nobuff and v_spell;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif AmminimumFastCode and isok then\r\n\t\t\t\t\t\tv_code = AmminimumFastCode(unit);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tv_code = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tisok = isok and v_code;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif Class and isok then\r\n\t\t\t\t\t\tv_Class = ST.mminimumFast_SpellsRun_Class(unit,Class);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tv_Class = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tisok = isok and v_Class;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tif ApiDbf and isok then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tv_ApiDbf = ST.mminimumFast_SpellsRun_ApiDbf(TBL[\"AmminimumFast\"],unit);\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tv_ApiDbf = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tisok = isok and v_ApiDbfEx and v_ApiDbf;\r\n\t\t\t\t\t\r\n\t\t\t\t\t--print(v_buff,v_spell,v_Class,v_code,v_Nobuff,v_ApiDbf)\r\n\t\t\t\t\t--print(\"isok\",isok)\r\n\t\t\t\t\t\r\n\t\t\t\t\tif isok then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif not Maximumchecked and not Minimumchecked then\r\n\t\t\t\t\t\t\tCount = Count+1;\r\n\t\t\t\t\t\t\ts_unit=unit;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t--return unit;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlocal IsMaximum;\r\n\t\t\t\t\t\t\tlocal IsMinimum;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif Maximumchecked then\r\n\t\t\t\t\t\t\t\tif MaximumCode then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal funcV1,funcV2 = MaximumCode(unit);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif funcV1 then\r\n\t\t\t\t\t\t\t\t\t\t--print(funcV1,funcV2)\r\n\t\t\t\t\t\t\t\t\t\tIsMaximum = funcV2;\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif Minimumchecked then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif MinimumCode then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal funcV1,funcV2 = MinimumCode(unit);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif funcV1 then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tIsMinimum = funcV2;\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif Maximumchecked and Minimumchecked then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif IsMaximum and IsMinimum then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif not value then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tvalue = IsMaximum;\r\n\t\t\t\t\t\t\t\t\t\tv_unit = unit;\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif IsMaximum < value then\r\n\t\t\t\t\t\t\t\t\t\t\t--value = funcV2;\r\n\t\t\t\t\t\t\t\t\t\t\tvalue = IsMaximum;\r\n\t\t\t\t\t\t\t\t\t\t\tv_unit = unit;\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tCount = Count+1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif Maximumchecked and not Minimumchecked then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif IsMaximum then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif not value then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tvalue = IsMaximum;\r\n\t\t\t\t\t\t\t\t\t\tv_unit = unit;\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t--if IsMaximum < value then\r\n\t\t\t\t\t\t\t\t\t\tif IsMaximum > value then\r\n\t\t\t\t\t\t\t\t\t\t\t--value = funcV2;\r\n\t\t\t\t\t\t\t\t\t\t\tvalue = IsMaximum;\r\n\t\t\t\t\t\t\t\t\t\t\tv_unit = unit;\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tCount = Count+1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif not Maximumchecked and Minimumchecked then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif IsMinimum then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif not value then\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tvalue = IsMinimum;\r\n\t\t\t\t\t\t\t\t\t\tv_unit = unit;\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif IsMinimum < value then\r\n\t\t\t\t\t\t\t\t\t\t\t--value = funcV2;\r\n\t\t\t\t\t\t\t\t\t\t\tvalue = IsMinimum;\r\n\t\t\t\t\t\t\t\t\t\t\tv_unit = unit;\r\n\t\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tCount = Count+1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif value then\r\n\t\t\t\t\t\t\t\t--print(s_unit,value)\r\n\t\t\t\t\t\t\t\ts_unit=v_unit;\r\n\t\t\t\t\t\t\t\t--return v_unit;\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t \r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\tlocal v_Count=TBL[\"AmminimumFast\"][\"Count\"];\r\n\t\tlocal v_Count_L = true;\r\n\t\tlocal v_Count_H = true;\r\n\t\tlocal IsCount = true;\r\n\t\t\r\n\t\tif TBL[\"AmminimumFast\"][\"Countchecked\"] then\r\n\t\t\t\r\n\t\t\tif v_Count[\"<\"][\"checked\"] and v_Count[\"<\"][\"Value\"] then\r\n\t\t\t\tv_Count_L = Count <= v_Count[\"<\"][\"Value\"]  ;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif v_Count[\">\"][\"checked\"] and v_Count[\">\"][\"Value\"] then\r\n\t\t\t\tv_Count_H = Count >= v_Count[\">\"][\"Value\"]  ;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tIsCount = v_Count_L and v_Count_H;\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t--print(Count,IsCount)\r\n\t\t--[[\r\n\t\tif (s_unit) then\r\n\t\t\t\r\n\t\t\tif st_h ~= amGetUnitName(s_unit,true).. aml(s_unit) then\r\n\t\t\t\r\n\t\t\t\tst_h = amGetUnitName(s_unit,true).. aml(s_unit);\r\n\t\t\t\tprint(IsCount,\"|cffff0000\" .. format(\"%.0f\",aml(s_unit,\"%\",1)) .. \"|r\",amGetUnitName(s_unit,true))\r\n\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t--]]\r\n\t\t\t\t\t\r\n\t\tif (TBL[\"AmminimumFast\"][\"CountFalseChecked\"] and not s_unit and IsCount) then\r\n\t\t\t\r\n\t\t\treturn \"player\",true;\r\n\t\t\t\r\n\t\telseif (s_unit and IsCount) then\r\n\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\treturn s_unit,true;\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\t\r\n\tend\r\n\t\r\n\t\r\n\r\nend\r\n\r\n\r\n\r\nfunction ST.mminimumFast_SpellsRun_Nobuff_bak(unit,BuffName,TBL)\r\n\t\r\n\tlocal OwnChecked = TBL[\"NobuffOwnChecked\"]\r\n\tlocal strlist={};\r\n\r\n\tlocal TextureTbl={};\r\n\tlocal SpellIdTbl={};\r\n\tlocal NameTbl={};\t\t\t\r\n\tlocal Name,Texture;\r\n\tlocal v1,v2,v3={},{},{};\r\n\t\r\n\tfor k, d in pairs(BuffName) do\r\n\t\t\r\n\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\r\n\t\tif d[\"IsTexture\"] then\r\n\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\r\n\t\telseif d[\"IsSpellId\"] then\r\n\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\r\n\t\telse\r\n\t\t\ttable.insert(NameTbl,Name)\r\n\t\tend\t\t\t\r\n\tend\r\n\t\r\n\tif #NameTbl>0 or #TextureTbl>0 or #SpellIdTbl>0 then\r\n\t\t\r\n\t\tif OwnChecked then\r\n\t\t\r\n\t\t\ttable.insert(v1,\"player\")\r\n\t\t\ttable.insert(v2,false)\r\n\t\t\ttable.insert(v3,false)\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif #NameTbl>0 then\r\n\t\t\ttable.insert(v1,\"name\")\r\n\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\ttable.insert(v3,0)\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif #TextureTbl>0 then\r\n\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\ttable.insert(v3,false)\r\n\t\tend\r\n\t\t\r\n\t\tif #SpellIdTbl>0 then\r\n\t\t\ttable.insert(v1,\"id\")\r\n\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\ttable.insert(v3,false)\r\n\t\tend\r\n\t\t\r\n\t\tlocal N = #ambufflist(unit,v1,v2,v3);\r\n\t\t\r\n\t\tamm={};\r\n\t\tamm.v1=v1\r\n\t\tamm.v2=v2\r\n\t\tamm.v3=v3\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\treturn  N <=0;\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\tend\r\n\t\t\r\n\t\r\n\treturn true;\r\n\t\r\n\t\r\nend\r\n\r\n\r\n\r\nfunction ST.mminimumFast_SpellsRun_buff_bak(unit,buff,TBL)\r\n\r\n\tlocal _,Class = UnitClassBase(unit);\r\n\t\r\n\t\r\n\tlocal IsClass = 0;\r\n\tlocal BuffCdChecked = TBL[\"AmminimumFast\"][\"BuffCdChecked\"];\r\n\tlocal BuffCdMaxChecked = TBL[\"AmminimumFast\"][\"BuffCdMaxChecked\"];\r\n\t\r\n\tlocal BuffCd = TBL[\"AmminimumFast\"][\"BuffCd\"];\r\n\tlocal BuffCdMax = TBL[\"AmminimumFast\"][\"BuffCdMax\"];\r\n\t\r\n\tlocal RemoveBuff = TBL[\"AmminimumFast\"][\"RemoveBuff\"];\r\n\tlocal AddBuff = TBL[\"AmminimumFast\"][\"AddBuff\"];\r\n\t\r\n\tlocal value = TBL[\"AmminimumFast\"][\"ValueBuff\"];\r\n\tlocal checked = TBL[\"AmminimumFast\"][\"ValueBuffchecked\"];\r\n\t\r\n\tlocal OwnChecked = TBL[\"AmminimumFast\"][\"BuffOwnChecked\"];\r\n\t\r\n\tlocal IsBuff = true;\r\n\t\r\n\tif not checked and (AddBuff or RemoveBuff) then\r\n\t\t\r\n\t\tIsBuff =false;\r\n\t\t\r\n\t\tlocal BuffName = buff;\r\n\t\tlocal Name,Texture;\r\n\t\tlocal v= TBL[\"AmminimumFast\"];\r\n\t\tlocal TextureTbl={};\r\n\t\tlocal SpellIdTbl={};\r\n\t\tlocal NameTbl={};\r\n\t\tlocal v1,v2,v3={},{},{};\r\n\t\t\r\n\t\tfor k, d in pairs(BuffName) do\r\n\t\t\t\r\n\t\t\tif not d[\"Class\"] or not d[\"Class\"][Class] then\r\n\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif d[\"IsTexture\"] then\r\n\t\t\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif d[\"IsSpellId\"] then\r\n\t\t\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(NameTbl,Name)\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\t\tif #NameTbl>0 then\r\n\t\r\n\t\t\tif OwnChecked then\r\n\t\t\t\r\n\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\t\ttable.insert(v1,\"name\")\r\n\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\ttable.insert(v3,0)\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif #TextureTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal N = #ambufflist(unit,v1,v2,v3);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif AddBuff then\r\n\t\t\t\r\n\t\t\t\tIsBuff = N <= 0;\r\n\t\t\t\t\r\n\t\t\telseif RemoveBuff then\r\n\t\t\t\t\r\n\t\t\t\tIsBuff = N > 0;\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\t\t\t\r\n\t\r\n\t\r\n\telseif  not checked and (BuffCdChecked or BuffCdMaxChecked) then\r\n\t\r\n\t\tIsBuff =false;\r\n\t\t\r\n\t\tlocal BuffName = buff;\r\n\t\tlocal Name,Texture;\r\n\t\tlocal v= TBL[\"AmminimumFast\"];\r\n\t\tlocal TextureTbl={};\r\n\t\tlocal SpellIdTbl={};\r\n\t\tlocal NameTbl={};\r\n\t\tlocal v1,v2,v3={},{},{};\r\n\t\t\r\n\t\tfor k, d in pairs(BuffName) do\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif not d[\"Class\"] or not d[\"Class\"][Class] then\r\n\t\t\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif d[\"IsTexture\"] then\r\n\t\t\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif d[\"IsSpellId\"] then\r\n\t\t\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(NameTbl,Name)\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\t\tif #NameTbl>0 then\r\n\t\r\n\t\t\tif OwnChecked then\r\n\t\t\t\r\n\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\t\ttable.insert(v1,\"name\")\r\n\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\ttable.insert(v3,0)\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif #TextureTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal N = #ambufflist(unit,v1,v2,v3);\r\n\t\t\t\r\n\t\t\tv1,v2,v3={},{},{};\r\n\t\t\t\r\n\t\t\tif N>0 then\r\n\t\t\t\t\r\n\t\t\t\tif OwnChecked then\r\n\t\t\t\r\n\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t --BuffCdChecked or BuffCdMaxChecked\r\n\t\t\t \r\n\t\t\t\t\r\n\t\t\t\tif BuffCdChecked then\r\n\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"time\")\r\n\t\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\t\ttable.insert(v3,BuffCd)\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif BuffCdMaxChecked then\r\n\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"time\")\r\n\t\t\t\t\ttable.insert(v2,BuffCdMax)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif v1 and #v1>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tif #TextureTbl>0 then\r\n\t\t\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tIsBuff = #ambufflist(unit,v1,v2,v3)>0;\r\n\t\t\t\t\t--[[\r\n\t\t\t\t\t\r\n\t\t\t\t\tamv={}\r\n\t\t\t\t\tamv[1]=v1\r\n\t\t\t\t\tamv[2]=v2\r\n\t\t\t\t\tamv[3]=v3\r\n\t\t\t\t\t\r\n\t\t\t\t\t--]]\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tif BuffCdChecked and not BuffCdMaxChecked then\r\n\t\t\t\t\t\r\n\t\t\t\t\tIsBuff =  0 <= BuffCd \r\n\t\t\t\t\t\r\n\t\t\t\telseif not BuffCdChecked and BuffCdMaxChecked then\r\n\t\t\t\t\r\n\t\t\t\t\tIsBuff = 0 >= BuffCdMax\r\n\t\t\t\t\t\r\n\t\t\t\telseif BuffCdChecked and BuffCdMaxChecked then\r\n\t\t\t\t\r\n\t\t\t\t\tIsBuff =  0 <= BuffCd and 0 >= BuffCdMax;\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\t\t\t\r\n\telseif checked then\r\n\t\r\n\t\tIsBuff =false;\r\n\t\t\r\n\t\tlocal BuffName = buff;\r\n\t\tlocal Name,Texture;\r\n\t\tlocal v= TBL[\"AmminimumFast\"];\r\n\t\tlocal TextureTbl={};\r\n\t\tlocal SpellIdTbl={};\r\n\t\tlocal NameTbl={};\r\n\t\tlocal v1,v2,v3={},{},{};\r\n\t\t\r\n\t\tfor k, d in pairs(BuffName) do\r\n\t\t\t\r\n\t\t\tif not d[\"Class\"] or not d[\"Class\"][Class] then\r\n\t\t\t\r\n\t\t\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif d[\"IsTexture\"] then\r\n\t\t\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif d[\"IsSpellId\"] then\r\n\t\t\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(NameTbl,Name)\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif #NameTbl>0 then\r\n\t\r\n\t\t\tif OwnChecked then\r\n\t\t\t\r\n\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\t\ttable.insert(v1,\"name\")\r\n\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\ttable.insert(v3,0)\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif #TextureTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal N = #ambufflist(unit,v1,v2,v3);\r\n\t\t\t\r\n\t\t\tv1,v2,v3={},{},{};\r\n\t\t\t\r\n\t\t\tif N>0 then\r\n\t\t\t\t\r\n\t\t\t\tif OwnChecked then\r\n\t\t\t\r\n\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif #TextureTbl>0 then\r\n\t\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(v1,\"passingtime\")\r\n\t\t\t\ttable.insert(v2,value)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\t\tIsBuff = #ambufflist(unit,v1,v2,v3)>0;\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\t --BuffCdChecked or BuffCdMaxChecked\r\n\t\t\t \r\n\t\t\t\t\r\n\t\r\n\tend\r\n\t\r\n\treturn IsBuff;\r\n\t\r\n\t--[[\r\n\tfor v, data in pairs(buff) do\r\n\t\t--print(v)\r\n\t\tif type(data) == \"table\" then\r\n\t\t\r\n\t\t\tlocal name,duration,expirationTime,TOTime;\r\n\t\t\tlocal isbuff = true;\r\n\t\t\t\r\n\t\t\tif BuffCdChecked or BuffCdMaxChecked then\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tlocal unitCaster,tn;\r\n\t\t\t\ttn,_,_,_,_,unitCaster,duration,expirationTime = amaura(v,unit,2,0);\r\n\t\t\t\t\r\n\t\t\t\tif tn > 0 then\r\n\t\t\t\t\tname = v;\r\n\t\t\t\telse\r\n\t\t\t\t\tname = false;\r\n\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\r\n\t\t\t\tlocal n;\r\n\t\t\t\tif name then\r\n\t\t\t\t\tn = expirationTime - GetTime();\r\n\t\t\t\t\tTOTime = duration - (expirationTime - GetTime());\r\n\t\t\t\telse\r\n\t\t\t\t\tn = 0 ;\r\n\t\t\t\t\tTOTime = 0;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif BuffCdChecked then\r\n\t\t\t\t\tisbuff = isbuff and n <= BuffCd ;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif BuffCdMaxChecked then\r\n\t\t\t\t\tisbuff = isbuff and n >= BuffCdMax ;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif checked then\r\n\t\t\t\t\t\r\n\t\t\t\t\tif name then\r\n\t\t\t\t\t\tisbuff = isbuff and TOTime > value;\r\n\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tisbuff = false;\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\r\n\t\t\telseif RemoveBuff then\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tlocal unitCaster,tn;\r\n\t\t\t\ttn,_,_,_,_,unitCaster,duration,expirationTime = amaura(v,unit,2,0);\r\n\t\t\t\t\r\n\t\t\t\tif tn > 0 then\r\n\t\t\t\t\tname = v;\r\n\t\t\t\telse\r\n\t\t\t\t\tname = false;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif name then\r\n\t\t\t\t\r\n\t\t\t\t\tif checked then\r\n\t\t\t\t\t\tisbuff = isbuff and (duration - (expirationTime - GetTime()) > value);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tisbuff = true;\r\n\t\t\t\t\tend\r\n\t\t\t\telse\r\n\t\t\t\t\t\r\n\t\t\t\t\tisbuff = false;\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\r\n\t\t\telseif AddBuff then\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tlocal unitCaster,tn;\r\n\t\t\t\ttn,_,_,_,_,unitCaster,duration,expirationTime = amaura(v,unit,2,0);\r\n\t\t\t\t\r\n\t\t\t\tif tn > 0 then\r\n\t\t\t\t\tname = v;\r\n\t\t\t\t\tisbuff = false;\r\n\t\t\t\telse\r\n\t\t\t\t\tname = false;\r\n\t\t\t\t\tisbuff = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif name then\r\n\t\t\t\t\r\n\t\t\t\t\tif checked then\r\n\t\t\t\t\t\tisbuff = isbuff and (duration - (expirationTime - GetTime()) > value);\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\t\tisbuff=true;\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\t\r\n\t\t\t\tisbuff = false;\t\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\tif isbuff then\r\n\t\t\r\n\t\t\t\tif not data[\"Class\"] or not data[\"Class\"][Class] then\r\n\t\t\t\t\r\n\t\t\t\t\tIsClass = IsClass + 1;\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\tend\r\n\t--]]\r\n\t--return IsClass > 0 ;\r\n\t\r\n\t\r\n\r\nend\r\n\r\n\r\nlocal function mminimumFast_SpellsRun_buff_IsName(isok,i,v,buffname,Rank,unit,buff)\r\n\t\r\n\tlocal name, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId;\r\n\tlocal IsPlayer = true;\r\n\tlocal filter,IsRank;\r\n\t\r\n\tfilter = GetBuffFilter(v);\r\n\t\r\n\t\r\n\tif v.IsSpellIdTexture == \"IsNameRank\" then\r\n\t\tIsRank = v.Rank or Rank;\r\n\tend\r\n\t\r\n\t\tif v[\"IsType\"]== \"Auto\" or not v[\"IsType\"] then\r\n\t\t\t\r\n\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId = UnitDebuff(unit,buffname,IsRank,filter);\r\n\t\t\t\r\n\t\t\tif not name then\r\n\t\t\t\r\n\t\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId= UnitBuff(unit,buffname,IsRank,filter);\r\n\t\t\tend\r\n\t\t\t\r\n\t\telseif v[\"IsType\"]== \"HELPFUL\" then\r\n\t\t\r\n\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId= UnitBuff(unit,buffname,IsRank,filter);\r\n\t\t\r\n\t\telseif v[\"IsType\"]== \"HARMFUL\" then\r\n\t\t\r\n\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId = UnitDebuff(unit,buffname,IsRank,filter);\r\n\t\t\r\n\t\tend\r\n\t\r\n\r\n\t\t\r\n\treturn \tIsBuffValue(v,isok,IsPlayer,name,count,duration, expirationTime, unitCaster);\r\n\t\r\nend\r\n\r\nlocal function mminimumFast_SpellsRun_buff_IsSpellIdTexture(isok,i,v,buffname,Rank,Texture,unit,buff)\r\n\t\r\n\tlocal name, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId;\r\n\tlocal IsPlayer = true;\r\n\tlocal filter,IsRank,buffname_e;\r\n\t\r\n\tfilter = GetBuffFilter(v);\r\n\t\r\n\t\r\n\tfor i=1,100 do\r\n\t\t\r\n\t\tif v[\"IsType\"]== \"Auto\" or not v[\"IsType\"] then\r\n\t\t\t\r\n\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId = UnitDebuff(unit,i,filter);\r\n\t\t\t\r\n\t\t\tif not name then\r\n\t\t\t\r\n\t\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId= UnitBuff(unit,i,filter);\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\telseif v[\"IsType\"]== \"HELPFUL\" then\r\n\t\t\r\n\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId= UnitBuff(unit,i,filter);\r\n\t\t\r\n\t\telseif v[\"IsType\"]== \"HARMFUL\" then\r\n\t\t\r\n\t\t\tname, rank, icon, count, debuffType, duration, expirationTime, unitCaster, isStealable,shouldConsolidate, spellId = UnitDebuff(unit,i,filter);\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif not name then\r\n\t\t\tbreak;\r\n\t\tend\r\n\t\t\r\n\t\tif (v.IsSpellIdTexture == \"IsSpellId\" and v.SpellId == spellId) or (v.IsSpellIdTexture == \"IsTexture\" and Texture == icon) then\r\n\t\t\r\n\t\t\tisok = true;\r\n\t\t\tbuffname_e=name;\r\n\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\r\n\tend\r\n\t\r\n\tisok = IsBuffValue(v,isok,IsPlayer,buffname_e,count,duration, expirationTime, unitCaster);\r\n\t\r\n\t\t\r\n\treturn isok;\r\n\t\r\nend\r\n\r\nfunction ST.mminimumFast_SpellsRun_buff(unit,buff,TBL,dbl)\r\n\r\n\t\t\r\n\tlocal IsCounts =0;\r\n\tlocal isok=false;\r\n\tlocal Counts=0;\r\n\tlocal Class = select(2,UnitClassBase(unit));\r\n\tlocal isClass =true;\r\n\t\r\n\tfor i, v in pairs(buff) do\r\n\t\t\r\n\t\tif v[\"IsCd\"] ~= \"No\" then\r\n\t\t\t\r\n\t\t\tisok=false;\r\n\t\t\t\r\n\t\t\tif v[\"IsClass\"] then\r\n\t\t\t\tisClass = not v[\"Class\"][Class];\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif isClass then\r\n\t\t\t\r\n\t\t\t\tlocal buffname,Rank,Texture = GetSpellInfo(v[\"SpellId\"]);\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif buffname then\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif v.IsSpellIdTexture == \"IsName\" or v.IsSpellIdTexture == \"IsNameRank\" or not v.IsSpellIdTexture then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tisok = mminimumFast_SpellsRun_buff_IsName(isok,i,v,buffname,Rank,unit,buff);\r\n\t\t\t\t\t\r\n\t\t\t\t\telseif v.IsSpellIdTexture == \"IsSpellId\" or v.IsSpellIdTexture == \"IsTexture\" then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tisok = mminimumFast_SpellsRun_buff_IsSpellIdTexture(isok,i,v,buffname,Rank,Texture,unit,buff);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif isok and v_isok then\r\n\t\t\t\t\t\tIsCounts = IsCounts +1;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif isok and dbl[\"IsOrAnd\"]==\"Or\" then\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tend\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tCounts = Counts +1;\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\tend\r\n\t\r\n\tif dbl[\"IsOrAnd\"]==\"Or\" or not dbl[\"IsOrAnd\"] then\r\n\t\treturn IsCounts>0;\r\n\telse\r\n\t\treturn IsCounts>0 and IsCounts == Counts;\r\n\tend\r\n\t\r\nend\r\n\r\n\r\nfunction ST.mminimumFast_SpellsRun_spell_BAK(unit,TBL,T)\r\n\r\n\t\r\n\tlocal spell, _, _, _, startTime, endTime = UnitCastingInfo(unit)\r\n\tif not spell then\r\n\t\tspell, _, _, _, startTime, endTime = UnitChannelInfo(unit)\r\n\t\t\r\n\tend\r\n\t\r\n\tif not spell then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\t\r\n\tlocal GTime =GetTime() - (startTime/1000);\r\n\tlocal LTime = (endTime/1000) - GetTime() ;\r\n\t\r\n\tlocal Isvalue,IsPoorvalue;\r\n\t\r\n\tlocal AllSpell = T[\"AmminimumFast\"][\"AllSpell\"];\r\n\t\r\n\tlocal AllValueChecked = T[\"AmminimumFast\"][\"SpellValueChecked\"];\r\n\tlocal AllValue = T[\"AmminimumFast\"][\"SpellValue\"];\r\n\t\r\n\tlocal AllSpellValuePoorChecked = T[\"AmminimumFast\"][\"SpellValuePoorChecked\"];\r\n\tlocal AllSpellValuePoorvalue = T[\"AmminimumFast\"][\"SpellValuePoorvalue\"];\r\n\t\r\n\t\r\n\tif AllSpell then\r\n\t\r\n\t\tif spell then\r\n\t\t\t\r\n\t\t\tif AllValueChecked then\r\n\t\t\t\tif not AllValue then\r\n\t\t\t\t\tAllValue=0;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tIsvalue =  GTime >= AllValue ;\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\tIsvalue = true;\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif AllSpellValuePoorChecked then\r\n\t\t\t\tif not AllSpellValuePoorvalue then\r\n\t\t\t\t\tAllSpellValuePoorvalue=0;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tIsPoorvalue =  LTime <= AllSpellValuePoorvalue ;\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\tIsPoorvalue = true;\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t\treturn IsPoorvalue and Isvalue ;\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\telse\r\n\t\r\n\t\tif TBL[spell] then\r\n\t\t\r\n\t\t\tif AllValueChecked then\r\n\t\t\t\r\n\t\t\t\tif not AllValue then\r\n\t\t\t\t\tAllValue=0;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tIsvalue =  GTime >= AllValue ;\r\n\t\t\r\n\t\t\telse\r\n\t\t\t\r\n\t\t\t\tif TBL[spell][\"Checked\"] then\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\tlocal vvv = TBL[spell][\"value\"];\r\n\t\t\t\t\t\r\n\t\t\t\t\tIsvalue = GTime >= vvv ;\r\n\t\t\t\telse\r\n\t\t\t\t\tIsvalue = true;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif AllSpellValuePoorChecked then\r\n\t\t\t\r\n\t\t\t\tif not AllSpellValuePoorvalue then\r\n\t\t\t\t\tAllSpellValuePoorvalue=0;\r\n\t\t\t\tend\r\n\t\t\t\tIsPoorvalue =  LTime <= AllSpellValuePoorvalue ;\r\n\t\t\r\n\t\t\telse\r\n\t\t\t\tif TBL[spell][\"PoorChecked\"] then\r\n\t\t\t\t\r\n\t\t\t\t\tlocal vvv = TBL[spell][\"Poorvalue\"];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tIsPoorvalue =  LTime <= vvv ;\r\n\t\t\t\telse\r\n\t\t\t\t\tIsPoorvalue = true;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\r\n\t\t\treturn IsPoorvalue and Isvalue ;\r\n\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\t\r\n\treturn false;\r\n\r\nend\r\n\r\nfunction ST.mminimumFast_SpellsRun_RangeCheckAngle(data,unit) ---职业 函数处理\r\n\t\t\r\n\tlocal tbl = data[\"PlayerRangeCheckAngle\"];\r\n\t\r\n\tlocal IsRange = false;\r\n\tlocal IsCount = true;\r\n\tlocal IsBuff = true;\r\n\tlocal IsHealth = true;\r\n\t\r\n\t\r\n\tlocal tblR = tbl[\"Range\"];\r\n\tlocal tblC = tbl[\"Count\"];\r\n\tlocal dots;\r\n\tlocal ExcludedPlayerChecked = tbl[\"ExcludedPlayerChecked\"];\r\n\t\r\n\t\r\n\tlocal MinHealth=0;\r\n\tlocal MaxHealth=0;\r\n\t\r\n\tlocal MinHealthUnit;\r\n\tlocal MaxHealthUnit;\r\n\t\r\n\tdots = ST.RangeCheck.Radar(unit,1000);\r\n\t\r\n\t\r\n\tif not dots then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\t\t\r\n\tif true then\r\n\t\r\n\t\tlocal Count = 0;\r\n\t\tlocal A,B;\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\t\r\n\t\t\tv.IsRange = false;\r\n\t\t\tv.ok = false;\r\n\t\t\t\r\n\t\t\tif not ExcludedPlayerChecked or (not UnitIsUnit(v.uId, \"player\")) then\r\n\t\t\t--print(ExcludedPlayerChecked,UnitName(v.uId),UnitName(unit))\r\n\t\t\t\tlocal x = v.x\r\n\t\t\t\tlocal y = v.y\r\n\t\t\t\tlocal range = (x*x + y*y) ^ 0.5\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif tblR[\"<\"][\"checked\"] then\r\n\t\t\t\t\tA = range <= 1.10 * tblR[\"<\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tA = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif tblR[\">\"][\"checked\"] then\r\n\t\t\t\t\tB = range >= tblR[\">\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tB = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif A and B and (tblR[\">\"][\"checked\"] or tblR[\"<\"][\"checked\"]) then\r\n\t\t\t\t\t\r\n\t\t\t\t\tCount = Count +1;\r\n\t\t\t\t\tv.IsRange = true;\r\n\t\t\t\t\tv.ok = true;\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\tend\t\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif Count<=0 then\r\n\t\t\treturn false;\r\n\t\telse\r\n\t\t\tIsRange=true;\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\tfor k, v in pairs(dots) do\r\n\t\r\n\t\tif v.ok then\r\n\t\t\r\n\t\t\tlocal Group = ST[\"UnitId\"][v.uId][\"subgroup\"];\r\n\t\t\tlocal name = ST[\"UnitId\"][v.uId][\"name\"];\r\n\t\t\t\t\r\n\t\t\tif tbl[\"ExcludedTarget\"][\"checked\"] then\t\r\n\t\t\t\r\n\t\t\r\n\t\t\t\tlocal IsExcludedTarget = true;\r\n\t\t\t\tlocal IsExcludedGroup = true;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"ExcludedTarget\"][\"TargetCount\"]>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tIsExcludedTarget = not tbl[\"ExcludedTarget\"][\"Target\"][name];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"ExcludedTarget\"][\"GroupCount\"]>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tIsExcludedGroup = not tbl[\"ExcludedTarget\"][\"Group\"][Group];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif IsExcludedGroup and IsExcludedTarget then\r\n\t\t\t\t\tv.ok = true;\r\n\t\t\t\telse\r\n\t\t\t\t\tv.ok = false;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\r\n\t\t\t\t--v.ok =  ExcludedTargetGroup(name);\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif tbl[\"ExcludedClass\"][\"checked\"] and v.ok then\r\n\t\r\n\t\t\t\tif tbl[\"ExcludedClass\"][\"ClassCount\"]>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tlocal Class = ST[\"UnitId\"][v.uId][\"englishClass\"];\r\n\t\t\t\t\t\r\n\t\t\t\t\tv.ok = not tbl[\"ExcludedClass\"][\"Class\"][Class];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\r\n\t\t\r\n\tend\r\n\t\r\n\tif true then\r\n\t\t\r\n\t\tlocal Percentage,Lack;\r\n\t\tlocal Count = 0;\r\n\t\t\r\n\t\tif tbl[\"Min_Max\"][\"Type\"]==\"Minimum_Blood_Percentage\" or\r\n\t\ttbl[\"Min_Max\"][\"Type\"]==\"Minimum_LackBlood_Percentage\" or\r\n\t\ttbl[\"Min_Max\"][\"Type\"]==\"Maximum_Blood_Percentage\" or\r\n\t\ttbl[\"Min_Max\"][\"Type\"]==\"Maximum_LackBlood_Percentage\" \r\n\t\tthen\r\n\t\t\r\n\t\t\tPercentage = \"%\";\r\n\t\telse\r\n\t\t\tPercentage = \"1\";\r\n\t\tend\r\n\t\t\r\n\t\tif tbl[\"Min_Max\"][\"Type\"]==\"Minimum_LackBlood_Percentage\" or\r\n\t\ttbl[\"Min_Max\"][\"Type\"]==\"Minimum_LackBlood\" or\r\n\t\ttbl[\"Min_Max\"][\"Type\"]==\"Maximum_LackBlood_Percentage\" or\r\n\t\ttbl[\"Min_Max\"][\"Type\"]==\"Maximum_LackBlood\" \r\n\t\tthen\r\n\t\t\tLack = 1;\r\n\t\telse\r\n\t\t\tLack = 0;\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif v.ok then\r\n\t\t\t\r\n\t\t\t\tlocal A,B;\r\n\t\t\t\tlocal Health = aml(v.uId,Percentage,Lack);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\tif tbl[\"Min_Max\"][\"<\"][\"checked\"] then\r\n\t\t\t\t\tA = Health <= tbl[\"Min_Max\"][\"<\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tA = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"Min_Max\"][\">\"][\"checked\"] then\r\n\t\t\t\t\tB = Health >= tbl[\"Min_Max\"][\">\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tB = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif A and B then\r\n\t\t\t\t\t\r\n\t\t\t\t\tCount = Count +1;\r\n\t\t\t\t\t\r\n\t\t\t\t\tv.ok = true;\r\n\t\t\t\t\t--[[\r\n\t\t\t\t\tif Health < MinHealth then\r\n\t\t\t\t\t\tMinHealth = Health;\r\n\t\t\t\t\t\tMinHealthUnit = v.uId;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif Health > MaxHealth then\r\n\t\t\t\t\t\tMaxHealth = Health;\r\n\t\t\t\t\t\tMaxHealthUnit = v.uId;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t--]]\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\tv.ok = false;\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\r\n\tend\r\n\t\r\n\t\t\t\r\n\t\r\n\tif tbl[\"NewBuff\"][\"checked\"] then\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\tif v.ok then\r\n\t\t\r\n\t\t\t\tv.ok= ST.mminimumFast_SpellsRun_buff(unit,tbl[\"NewBuff\"][\"buffs\"],nil,tbl[\"NewBuff\"]);\r\n\t\t\t\tv.IsBuff=v.ok;\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tif tbl[\"Count\"][\">\"][\"checked\"] or tbl[\"Count\"][\"<\"][\"checked\"] then\r\n\t\r\n\t\tlocal a,b;\r\n\t\tlocal Count = 0;\r\n\t\t\r\n\t\tIsCount = false\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tv.IsCount = false;\r\n\t\t\t\t\t\t\r\n\t\t\tif v.ok then\r\n\t\t\t\tCount = Count +1;\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif tblC[\"<\"][\"checked\"] then\r\n\t\t\ta = Count <= tblC[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\ta = true;\r\n\t\tend\r\n\t\t\r\n\t\tif tblC[\">\"][\"checked\"] then\r\n\t\t\tb = Count >= tblC[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tb = true;\r\n\t\tend\r\n\t\t\r\n\t\tif not tblC[\">\"][\"checked\"] and not tblC[\"<\"][\"checked\"] then\r\n\t\t\tIsCount = true;\r\n\t\telse\r\n\t\t\tIsCount = a and b;\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\tif IsCount then\r\n\t\t--[[\r\n\t\tif tbl[\"Min_Max\"][\"Type\"]==\"Minimum_Blood_Percentage\" or\r\n\t\t\ttbl[\"Min_Max\"][\"Type\"]==\"Minimum_Blood\" or\r\n\t\t\ttbl[\"Min_Max\"][\"Type\"]==\"Minimum_LackBlood_Percentage\" or\r\n\t\t\ttbl[\"Min_Max\"][\"Type\"]==\"Minimum_LackBlood\" \r\n\t\t\tthen \r\n\t\t\t\r\n\t\t\treturn MinHealthUnit;\r\n\t\telse\r\n\t\t\treturn MaxHealthUnit;\r\n\t\tend\r\n\t\t--]]\r\n\t\t\r\n\t\treturn unit;\r\n\tend\r\n\t\r\n\treturn false;\r\n\t\r\nend\r\n\r\n\r\n\r\nfunction ST.mminimumFast_SpellsRun_spell(unit,dbf)\r\n\r\n\t\r\n\t\r\n\tlocal spell,_,_,_,startTime,endTime,_,castID,notInterruptible  = UnitCastingInfo(unit);\r\n\t\r\n\tif not spell then\r\n\t\r\n\t\tspell,_,_,_,startTime,endTime,_,notInterruptible  = UnitChannelInfo(unit);\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif not spell then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tlocal StartTime =GetTime() - (startTime/1000);\r\n\tlocal EndTime = (endTime/1000) - GetTime() ;\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tlocal IsStart,IsEnd,IsNotInterrupt = true,true,true;\r\n\r\n\t\r\n\tif dbf[\"AllSpell\"] then\r\n\t\t\r\n\t\tif  dbf[\"NotInterrupt\"]==\"No\" and not notInterruptible then\r\n\t\t\treturn false\r\n\t\t\t\r\n\t\telseif  dbf[\"NotInterrupt\"]==\"Yes\" and notInterruptible then\r\n\t\t\treturn false\r\n\t\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif dbf[\"Cd\"][\"Start\"][\"Checked\"] then\r\n\t\t\tIsStart = StartTime >= dbf[\"Cd\"][\"Start\"][\"Value\"];\r\n\t\tend\r\n\t\t\r\n\t\tif dbf[\"Cd\"][\"End\"][\"Checked\"] then\r\n\t\t\tIsEnd = EndTime <= dbf[\"Cd\"][\"End\"][\"Value\"];\r\n\t\tend\r\n\t\t\r\n\t\treturn IsEnd and IsStart;\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tfor k,v in pairs(dbf[\"Spell\"]) do\r\n\t\r\n\t\tlocal Name = GetSpellInfo(v.SpellId) or false;\r\n\t\t\r\n\t\tif Name then\r\n\t\t\r\n\t\t\tIsStart,IsEnd,IsNotInterrupt = true,true,true;\r\n\t\t\t\r\n\t\t\tif v[\"Checked\"] and spell == Name then\r\n\t\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\tif  (v[\"NotInterrupt\"]==\"No\" and notInterruptible) or \r\n\t\t\t\t(v[\"NotInterrupt\"]==\"Yes\" and not notInterruptible) or \r\n\t\t\t\tv[\"NotInterrupt\"]==\"All\" or v[\"NotInterrupt\"]==nil then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif v[\"Random\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif v[\"Cd\"][\"Start\"][\"Checked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif castID then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (v[\"Cd\"][\"Start\"][\"Random\"][\"castID\"] or 0) ~= castID then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal Temp_StartTime = math.random((v[\"Cd\"][\"Start\"][\"Random\"][\">\"][\"Value\"] or 0) * 1000, \r\n\t\t\t\t\t\t\t\t\t(v[\"Cd\"][\"Start\"][\"Random\"][\"<\"][\"Value\"] or 0) *1000);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"Start\"][\"Random\"][\"castID\"] = castID ;\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"Start\"][\"Random\"][\"Randomval\"] = Temp_StartTime;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif GetTime() - (v[\"Cd\"][\"Start\"][\"Random\"][\"RandomTime\"] or 0) >1.3 then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal Temp_StartTime = math.random((v[\"Cd\"][\"Start\"][\"Random\"][\">\"][\"Value\"] or 0) * 1000, \r\n\t\t\t\t\t\t\t\t\t(v[\"Cd\"][\"Start\"][\"Random\"][\"<\"][\"Value\"] or 0) *1000);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"Start\"][\"Random\"][\"RandomTime\"] = GetTime() ;\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"Start\"][\"Random\"][\"Randomval\"] = Temp_StartTime;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tIsStart = StartTime >= v[\"Cd\"][\"Start\"][\"Random\"][\"Randomval\"]/1000;\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif v[\"Cd\"][\"End\"][\"Checked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif castID then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (v[\"Cd\"][\"End\"][\"Random\"][\"castID\"] or 0) ~= castID then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal Temp_EndTime = math.random((v[\"Cd\"][\"End\"][\"Random\"][\">\"][\"Value\"] or 0) * 1000, \r\n\t\t\t\t\t\t\t\t\t(v[\"Cd\"][\"End\"][\"Random\"][\"<\"][\"Value\"] or 0) *1000);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"End\"][\"Random\"][\"castID\"] = castID ;\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"End\"][\"Random\"][\"Randomval\"] = Temp_EndTime;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif GetTime() - (v[\"Cd\"][\"End\"][\"Random\"][\"RandomTime\"] or 0) >1.3 then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tlocal Temp_EndTime = math.random((v[\"Cd\"][\"End\"][\"Random\"][\">\"][\"Value\"] or 0) * 1000, \r\n\t\t\t\t\t\t\t\t\t(v[\"Cd\"][\"End\"][\"Random\"][\"<\"][\"Value\"] or 0) *1000);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"End\"][\"Random\"][\"RandomTime\"] = GetTime() ;\r\n\t\t\t\t\t\t\t\t\tv[\"Cd\"][\"End\"][\"Random\"][\"Randomval\"] = Temp_EndTime;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tIsEnd = EndTime <= v[\"Cd\"][\"End\"][\"Random\"][\"Randomval\"]/1000;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif v[\"Cd\"][\"Start\"][\"Checked\"] then\r\n\t\t\t\t\t\t\tIsStart = StartTime >= v[\"Cd\"][\"Start\"][\"Value\"];\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif v[\"Cd\"][\"End\"][\"Checked\"] then\r\n\t\t\t\t\t\t\tIsEnd = EndTime <= v[\"Cd\"][\"End\"][\"Value\"];\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif IsEnd and IsStart then\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\t\r\n\treturn false;\r\n\t\r\n\t\r\n\r\nend\r\n\r\n\r\nfunction ST.mminimumFast_SpellsRun_Class(unit,TBL)\r\n\r\n\tlocal _,Class = UnitClassBase(unit);\r\n\t\r\n\tif not TBL[Class] then\r\n\t\treturn true;\r\n\tend\r\n\t\t\r\n\treturn false;\r\n\r\nend\r\n\r\n\r\n\r\nfunction ST.Unit_SpellsRun(data,unit)\r\n\t\r\n\t\r\n\tlocal Targets = data[\"Targets\"];  \r\n\tlocal vr={};\r\n\tlocal r=false;\r\n\tlocal checkedok = false;\r\n\tlocal k = 0;\r\n\t\r\n\t\r\n\t\t\r\n\t\tif data[\"and/or\"] then\r\n\t\t\r\n\t\t\tfor i, v in pairs(Targets) do\r\n\t\t\t\r\n\t\t\t\tif v[\"checked\"] then\r\n\t\t\t\t\tcheckedok=true;\r\n\t\t\t\t\tlocal vr = ST.Unit_SpellsRun_1(v,unit);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif v[\"not\"] then\r\n\t\t\t\t\t\tvr= not vr;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif vr then\r\n\t\t\t\t\t\tr=true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\telse\r\n\t\t\r\n\t\t\tfor i, v in pairs(Targets) do\r\n\t\t\t\t\r\n\t\t\t\tif v[\"checked\"] then\r\n\t\t\t\t\tcheckedok=true;\r\n\t\t\t\t\t\r\n\t\t\t\t\tk=k+1;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvr[i] = ST.Unit_SpellsRun_1(v,unit);\r\n\t\t\t\t\r\n\t\t\t\t\tif v[\"not\"] then\r\n\t\t\t\t\t\tvr[i]= not vr[i];\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tif k ==1 then\r\n\t\t\t\t\t\tr = vr[i];\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tr = r and vr[i];\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif not r then\r\n\t\t\t\t\t\tr=false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\t\r\n\t\r\n\tif not checkedok then\r\n\t\treturn true;\r\n\tend\r\n\t\r\n\treturn r and ST ;\r\n\r\nend\r\n\r\n\r\n\r\nfunction ST.Unit_SpellsRun_1(data,unit)\r\n\t\r\n\tlocal Conditions = data[\"Conditions\"]; --条件\r\n\tlocal vr={};\r\n\tlocal r = false;\r\n\tlocal checkedok = false;\r\n\tlocal k =0;\r\n\t\r\n\tfor i, v in pairs(Conditions) do\r\n\t\t--print(\"cc\")\r\n\t\t\r\n\t\t\r\n\t\tif v[\"checked\"] then\r\n\t\t\tk=k+1;\r\n\t\t\t\r\n\t\t\tcheckedok=true;\r\n\t\t\tif v[\"TargetSubgroup\"] == -2 then\r\n\t\t\t\r\n\t\t\t\tlocal tbl = SuperTreatmentDBF[\"Unit\"][\"RaidList\"][v[\"unit\"]];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif not tbl[\"runindex\"] then\r\n\t\t\t\t\t\ttbl[\"runindex\"] =0;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif not ST.Multitasking[v[\"unit\"]] then\r\n\t\t\t\t\t\tST.Multitasking[v[\"unit\"]]={};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif tbl[\"runindex\"] ~= ST.runindex then\r\n\t\t\t\t\t\tlocal ism = ST[\"Multitasking\"][v[\"unit\"]];\r\n\t\t\t\t\t\tif ism[\"MultitaskingStart\"] then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tunit =ism[\"ReturnsUnit\"];\r\n\t\t\t\t\t\t\t--print(1,i,unit)\r\n\t\t\t\t\t\t \r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tunit = ST.AmminimumFast_SpellsRun(data,v[\"unit\"]);\r\n\t\t\t\t\t\t\t--print(2,i,unit)\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\ttbl[\"ReturnsUnit\"]=unit;\r\n\t\t\t\t\t\ttbl[\"runindex\"]=ST.runindex;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tunit = tbl[\"ReturnsUnit\"];\r\n\t\t\t\t\t--print(3,i,unit)\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\tunit = stUnitExplanation(v[\"unit\"]); --unit\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif not unit or not amGetUnitName(unit,true) then\r\n\t\t\t\treturn false;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal TargetLayer = v[\"TargetLayer\"] or 0;\r\n\t\t\tlocal TargetLayerText=\"\";\r\n\t\r\n\t\t\tfor n=1,TargetLayer do\r\n\t\t\t\tTargetLayerText = TargetLayerText .. \"-target\"\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tunit = unit .. TargetLayerText;\r\n\t\t\t\r\n\t\t\t--print(unit)\r\n\t\t\t\r\n\t\t\tvr[i] = ST.Unit_SpellsRun_2(v,unit);\r\n\t\t\t\r\n\t\t\tif v[\"not\"] then\r\n\t\t\t\tvr[i]= not vr[i];\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif data[\"and/or\"] then\r\n\t\t\t\r\n\t\t\t\tif k ==1 then\r\n\t\t\t\t\tr = vr[i];\r\n\t\t\t\telse\r\n\t\t\t\t\tr = r or vr[i];\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif r then\r\n\t\t\t\t\treturn r;\r\n\t\t\t\tend\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tif k ==1 then\r\n\t\t\t\t\tr = vr[i];\r\n\t\t\t\telse\r\n\t\t\t\t\tr = r and vr[i];\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif not r then\r\n\t\t\t\t\treturn r;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\r\n\tend\r\n\t\r\n\tif not checkedok then\r\n\t\treturn true;\r\n\tend\r\n\t\r\n\treturn r;\r\n\t\r\n\t\r\n\r\nend\r\n\r\n\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2(data,unit)  -- 函数处理\r\n\t\r\n\tlocal checkedok = false;\r\n\tlocal Relationship = data[\"and/or\"];\r\n\tlocal con ;\r\n\t\r\n\t\r\n\t---------------------------\r\n\tlocal ApiDbf\r\n\t\r\n\tApiDbf,con = ST.Unit_SpellsRun_2_ApiDbf(data,unit);\r\n\t\r\n\t\r\n\tif not con then checkedok=true;end;\r\n\t\r\n\t\r\n\t\r\n\tif checkedok then\r\n\t\r\n\t\tif Relationship then \r\n\t\t\tif ApiDbf then\r\n\t\t\t\treturn ApiDbf; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not ApiDbf then\r\n\t\t\t\treturn ApiDbf; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tApiDbf = true;\r\n\tend\r\n\t\r\n\t\r\n\t------------------------\r\n\t\r\n\tlocal Blood;\r\n\tif data[\"Blood\"][\"checked\"] then\r\n\t\r\n\t\tBlood ,con = ST.Unit_SpellsRun_2_Blood(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t--print(\"Blood\",Blood)\r\n\t\t\t\r\n\t\tif data[\"Blood\"][\"not\"] then\r\n\t\t\tBlood = not Blood;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Blood then\r\n\t\t\t\treturn Blood; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Blood then\r\n\t\t\t\treturn Blood; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tBlood = true;\r\n\tend\r\n\t-------------------------\r\n\t\r\n\tlocal Buff;\r\n\tif data[\"NewBuff\"] and data[\"NewBuff\"][\"checked\"] then\r\n\t\r\n\t\tBuff ,con = ST.Unit_SpellsRun_2_Buff(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t\r\n\t\tif data[\"NewBuff\"][\"not\"] then\r\n\t\t\tBuff = not Buff;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Buff then\r\n\t\t\t\treturn Buff; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Buff then\r\n\t\t\t\treturn Buff; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tBuff = true;\r\n\tend\r\n\t-------------------------\r\n\t\t\r\n\tlocal CastSpell;\r\n\t\r\n\tif data[\"NewSpell\"] and data[\"NewSpell\"][\"checked\"] then\r\n\t\r\n\t\tCastSpell ,con = ST.Unit_SpellsRun_2_CastSpell(data[\"NewSpell\"],unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"CastSpell\",CastSpell)\r\n\t\t\t\r\n\t\tif data[\"NewSpell\"][\"not\"] then\r\n\t\t\tCastSpell = not CastSpell;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif CastSpell then\r\n\t\t\t\treturn CastSpell; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not CastSpell then\r\n\t\t\t\treturn CastSpell; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tCastSpell = true;\r\n\tend\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal Class;\r\n\tif data[\"Class\"][\"checked\"] then\r\n\t\r\n\t\tClass ,con = ST.Unit_SpellsRun_2_Class(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"Class\",Class)\r\n\t\t\t\r\n\t\tif data[\"Class\"][\"not\"] then\r\n\t\t\tClass = not Class;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Class then\r\n\t\t\t\treturn Class; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Class then\r\n\t\t\t\treturn Class; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tClass = true;\r\n\tend\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal ComboPoints;\r\n\tif data[\"ComboPoints\"][\"checked\"] then\r\n\t\r\n\t\tComboPoints ,con = ST.Unit_SpellsRun_2_ComboPoints(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"ComboPoints\",ComboPoints)\r\n\t\t\t\r\n\t\tif data[\"ComboPoints\"][\"not\"] then\r\n\t\t\tComboPoints = not ComboPoints;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif ComboPoints then\r\n\t\t\t\treturn ComboPoints; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not ComboPoints then\r\n\t\t\t\treturn ComboPoints; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tComboPoints = true;\r\n\tend\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal Cooldown;\r\n\tif data[\"Cooldown\"][\"checked\"] then\r\n\t\r\n\t\tCooldown ,con = ST.Unit_SpellsRun_2_Cooldown(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"Cooldown\",Cooldown)\r\n\t\t\t\r\n\t\tif data[\"Cooldown\"][\"not\"] then\r\n\t\t\tCooldown = not Cooldown;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Cooldown then\r\n\t\t\t\treturn Cooldown; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Cooldown then\r\n\t\t\t\treturn Cooldown; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tCooldown = true;\r\n\tend\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal Distance;\r\n\tif data[\"Distance\"][\"checked\"] then\r\n\t\r\n\t\tDistance ,con = ST.Unit_SpellsRun_2_Distance(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"Distance\",Distance)\r\n\t\t\t\r\n\t\tif data[\"Distance\"][\"not\"] then\r\n\t\t\tDistance = not Distance;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Distance then\r\n\t\t\t\treturn Distance; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Distance then\r\n\t\t\t\treturn Distance; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tDistance = true;\r\n\tend\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal Energy;\r\n\tif data[\"Energy\"][\"checked\"] then\r\n\t\r\n\t\tEnergy ,con = ST.Unit_SpellsRun_2_Energy(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"Energy\",Energy)\r\n\t\t\t\r\n\t\tif data[\"Energy\"][\"not\"] then\r\n\t\t\tEnergy = not Energy;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Energy then\r\n\t\t\t\treturn Energy; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Energy then\r\n\t\t\t\treturn Energy; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tEnergy = true;\r\n\tend\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal SpecialEnergy;\r\n\tif data[\"SpecialEnergy\"] and data[\"SpecialEnergy\"][\"checked\"] then\r\n\t\r\n\t\tSpecialEnergy ,con = ST.Unit_SpellsRun_2_SpecialEnergy(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"SpecialEnergy\",SpecialEnergy)\r\n\t\t\t\r\n\t\tif data[\"SpecialEnergy\"][\"not\"] then\r\n\t\t\tSpecialEnergy = not SpecialEnergy;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif SpecialEnergy then\r\n\t\t\t\treturn SpecialEnergy; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not SpecialEnergy then\r\n\t\t\t\treturn SpecialEnergy; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tSpecialEnergy = true;\r\n\tend\r\n\t\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal IsTarget;\r\n\tif data[\"IsTarget\"][\"checked\"] then\r\n\t\r\n\t\tIsTarget ,con = ST.Unit_SpellsRun_2_IsTarget(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"IsTarget\",IsTarget)\r\n\t\t\t\r\n\t\tif data[\"IsTarget\"][\"not\"] then\r\n\t\t\tIsTarget = not IsTarget;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif IsTarget then\r\n\t\t\t\treturn IsTarget; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not IsTarget then\r\n\t\t\t\treturn IsTarget; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tIsTarget = true;\r\n\tend\r\n\t\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal Rune;\r\n\tif data[\"Rune\"][\"checked\"] then\r\n\t\r\n\t\tRune ,con = ST.Unit_SpellsRun_2_Rune(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"Rune\",Rune)\r\n\t\t\t\r\n\t\tif data[\"Rune\"][\"not\"] then\r\n\t\t\tRune = not Rune;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Rune then\r\n\t\t\t\treturn Rune; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Rune then\r\n\t\t\t\treturn Rune; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tRune = true;\r\n\tend\r\n\t\r\n\t\r\n\t-------------------------\r\n\t\r\n\t\r\n\tlocal Totem;\r\n\tif data[\"Totem\"][\"checked\"] then\r\n\t\r\n\t\tTotem ,con = ST.Unit_SpellsRun_2_Totem(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"Totem\",Totem)\r\n\t\t\t\r\n\t\tif data[\"Totem\"][\"not\"] then\r\n\t\t\tTotem = not Totem;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif Totem then\r\n\t\t\t\treturn Totem; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not Totem then\r\n\t\t\t\treturn Totem; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tTotem = true;\r\n\tend\r\n\t\r\n\t\r\n\tlocal RangeCheck;\r\n\tif data[\"RangeCheck\"] and data[\"RangeCheck\"][\"checked\"] then\r\n\t\r\n\t\tRangeCheck ,con = ST.Unit_SpellsRun_2_RangeCheck(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"RangeCheck\",RangeCheck)\r\n\t\t\t\r\n\t\tif data[\"RangeCheck\"][\"not\"] then\r\n\t\t\tRangeCheck = not RangeCheck;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif RangeCheck then\r\n\t\t\t\treturn RangeCheck; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not RangeCheck then\r\n\t\t\t\treturn RangeCheck; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tRangeCheck = true;\r\n\tend\r\n\t\r\n\t--print(data[\"PlayerRangeCheckAngle\"] , data[\"PlayerRangeCheckAngle\"][\"checked\"])\r\n\t\r\n\tlocal PlayerRangeCheckAngle;\r\n\tif data[\"PlayerRangeCheckAngle\"] and data[\"PlayerRangeCheckAngle\"][\"checked\"] then\r\n\t\r\n\t\tPlayerRangeCheckAngle ,con = ST.Unit_SpellsRun_2_PlayerRangeCheckAngle(data,unit);\r\n\t\tif not con then checkedok=true;end;\r\n\t\t\t--print(\"PlayerRangeCheckAngle\",PlayerRangeCheckAngle)\r\n\t\t\t\r\n\t\tif data[\"PlayerRangeCheckAngle\"][\"not\"] then\r\n\t\t\tPlayerRangeCheckAngle = not PlayerRangeCheckAngle;\r\n\t\tend\r\n\t\t\r\n\t\tif Relationship then \r\n\t\t\tif PlayerRangeCheckAngle then\r\n\t\t\t\treturn PlayerRangeCheckAngle; \r\n\t\t\tend\r\n\t\telse\r\n\t\t\tif not PlayerRangeCheckAngle then\r\n\t\t\t\treturn PlayerRangeCheckAngle; \r\n\t\t\tend\r\n\t\tend;\r\n\telse\r\n\t\tPlayerRangeCheckAngle = true;\r\n\tend\r\n\t\r\n\t\r\n\tif not checkedok then\r\n\t\treturn true;\r\n\tend\r\n\t\r\n\treturn ApiDbf and \r\n\t\t\tBlood and \r\n\t\t\tBuff and \r\n\t\t\tCastSpell and \r\n\t\t\tClass and \r\n\t\t\tComboPoints and \r\n\t\t\tplayerrange and \r\n\t\t\tCooldown and \r\n\t\t\tDistance and \r\n\t\t\tEnergy and \r\n\t\t\tSpecialEnergy and\r\n\t\t\tIsTarget and \r\n\t\t\tRune and \r\n\t\t\tTotem and \r\n\t\t\tRangeCheck and\r\n\t\t\tPlayerRangeCheckAngle;\r\n\t\t\t\r\n\t\r\n\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_ApiDbf(data,unit) ---ApiDbf 函数处理\r\n\t\r\n\tlocal ApiDbf = data[\"ApiDbf\"];\r\n\tlocal r ;\r\n\tlocal vr ={};\r\n\tlocal checkedok=false;\r\n\tlocal index=0;\r\n\t\r\n\tfor i, v in pairs(ApiDbf) do\r\n\t\t\r\n\t\tif v[\"checked\"] then\r\n\t\t\tindex= index+1;\r\n\t\t\tcheckedok = true;\r\n\t\t\t\r\n\t\t\tvr[i]=ST.Unit_SpellsRun_2_ApiDbf_1(v,unit);\r\n\t\t\t\r\n\t\t\tif v[\"not\"] then\r\n\t\t\t\tvr[i]= not vr[i];\r\n\t\t\tend\r\n\t\t\r\n\t\t\tif data[\"and/or\"] then\r\n\t\t\t\r\n\t\t\t\tif i ==1 then\r\n\t\t\t\t\tr = vr[i];\r\n\t\t\t\telse\r\n\t\t\t\t\tr = r or vr[i];\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif r then\r\n\t\t\t\t\treturn true,not checkedok;\r\n\t\t\t\tend\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tif index ==1 then\r\n\t\t\t\t\tr = vr[i];\r\n\t\t\t\telse\r\n\t\t\t\t\tr = r and vr[i];\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif not r then\r\n\t\t\t\t\treturn false,not checkedok;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\t\r\n\tend\r\n\t\r\n\tif not checkedok then\r\n\t\treturn false,not checkedok;\r\n\tend\r\n\t\r\n\treturn r , not checkedok;\r\n\t\r\n\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_Run_ApiDbf(v,unit) ---ApiDbf 执行函数处理\r\n\t\r\n\t\r\n\tlocal r ;\r\n\tlocal vr ={};\r\n\tlocal i =1;\r\n\t\t\r\n\tvr[i]=ST.Unit_SpellsRun_2_ApiDbf_1(v,unit);\r\n\t\r\n\tif v[\"not\"] then\r\n\t\tvr[i]= not vr[i];\r\n\tend\r\n\r\n\r\n\tif v[\"and/or\"] then\r\n\t\r\n\t\tif i ==1 then\r\n\t\t\tr = vr[i];\r\n\t\telse\r\n\t\t\tr = r or vr[i];\r\n\t\tend\r\n\t\t\r\n\t\tif r then\r\n\t\t\treturn true;\r\n\t\tend\r\n\telse\r\n\t\t\r\n\t\tif i ==1 then\r\n\t\t\tr = vr[i];\r\n\t\telse\r\n\t\t\tr = r and vr[i];\r\n\t\tend\r\n\t\t\r\n\t\tif not r then\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\r\n\tend\r\n\t\t\r\n\t\r\n\t\r\n\treturn r;\r\n\t\r\n\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_ApiDbf_1(ApiDbf,unit) ---自定义函数求值\r\n\t\r\n\tif ApiDbf[\"func\"] then\r\n\t\t--return ApiDbf:func(unit);\r\n\tend\r\n\t\r\n\tlocal apiinf = SuperTreatment[\"Api\"][ApiDbf[\"id\"]] ;\r\n\tlocal ACounts = apiinf[\"Arguments\"][\"Counts\"];\r\n\tlocal RCounts = apiinf[\"Returns\"][\"Counts\"];\r\n\tlocal va ={};\r\n\tlocal vr ={};\r\n\tlocal Astr ;\r\n\tlocal Rstr ;\r\n\tlocal apiname = ApiDbf[\"id\"];\r\n\t\r\n\tfor i=1 , ACounts do\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tlocal D = ApiDbf[\"Arguments\"][i];\r\n\t\t\r\n\t\tif D and D[\"value\"] then\r\n\t\t\r\n\t\t\tif  apiinf[\"Arguments\"][i][\"type\"] == \"String\"  then\r\n\t\t\t\t\r\n\t\t\t\tva[i] = '\"' .. D[\"value\"] .. '\"';\r\n\t\t\telse\r\n\t\t\t\tva[i] = tostring(D[\"value\"]);\r\n\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif Astr then\r\n\t\t\t\r\n\t\t\t\tAstr =  Astr .. ',' .. va[i];\r\n\t\t\t\r\n\t\t\telse\r\n\t\t\t\tAstr =  va[i];\r\n\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tfor i=1 , RCounts do\r\n\t\t\r\n\t\t\r\n\t\tlocal t = apiinf[\"Returns\"][i][\"type\"];\r\n\t\tlocal v = ApiDbf[\"Returns\"][i];\r\n\t\t\r\n\t\tif v and v[\"checked\"] then\r\n\t\t\r\n\t\t\tif t == \"Number\" then\r\n\t\t\t\t\r\n\t\t\t\tvr[i] = ST.Unit_SpellsRun_2_ApiDbf_1_Number(ApiDbf,unit,v,i);\r\n\t\t\t\t\t\r\n\t\t\telseif t == \"Boolean\" then\r\n\t\t\t\r\n\t\t\t\tvr[i] = ST.Unit_SpellsRun_2_ApiDbf_1_Boolean(ApiDbf,unit,v,i);\r\n\t\t\t\t\r\n\t\t\telseif t == \"String\" then\t\r\n\t\t\t\r\n\t\t\t\tvr[i] = ST.Unit_SpellsRun_2_ApiDbf_1_String(ApiDbf,unit,v,i);\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif Rstr then\r\n\t\t\t\tRstr= Rstr .. ' and ' .. vr[i];\r\n\t\t\telse\r\n\t\t\t\tRstr= vr[i];\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\tend\r\n\t\r\n\tif not Rstr then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\tRstr = 'return ' .. Rstr .. '; end;';\r\n\t\r\n\t\r\n\tif not Astr then\r\n\t\tAstr=\"\";\r\n\tend\r\n\t\r\n\tAstr = 'local v = {' .. apiname .. '(' .. Astr .. ')};';\r\n\t\r\n\tlocal funcstr = 'function SuperTreatment_temp(unit) ' .. Astr .. Rstr;\r\n\t\r\n\t\r\n\t\r\n\tRunScript(funcstr);\r\n\tApiDbf[\"func\"]=SuperTreatment_temp;\r\n\tSuperTreatment_temp=nil;\r\n\t--print(funcstr)\r\n\treturn ApiDbf.func(unit);\r\n\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_ApiDbf_1_Number(ApiDbf,unit,v,i)---数值返回值的求值表达式\r\n\t\r\n\tlocal apiinf = SuperTreatment[\"Api\"][ApiDbf[\"id\"]];\r\n\t\r\n\tlocal str;\r\n\tlocal Failure = apiinf[\"Returns\"][i][\"Failure\"];\r\n\tlocal vx;\r\n\t--print(Failure)\r\n\tif Failure == nil then\r\n\t\tvx = \"v[\" .. i .. \"]\";\r\n\telse\r\n\t\tif type(Failure) == \"string\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or '\" .. Failure .. \"')\" ;\r\n\t\telseif type(Failure) == \"number\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or \" .. tostring(Failure) .. \")\" ;\r\n\t\telseif type(Failure) == \"boolean\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or \" .. tostring(Failure)  .. \")\";\r\n\t\telse\r\n\t\t\tvx = \"v[\" .. i .. \"]\";\r\n\t\tend\r\n\tend\r\n\t\r\n\t\r\n\tif v[\"=\"][\"checked\"] then\r\n\t\t\r\n\t\tstr = vx .. '==' .. tostring(v[\"=\"][\"Value\"]);\r\n\telse\r\n\t\r\n\t\tif v[\"<\"][\"checked\"] then\r\n\t\t\t\r\n\t\t\tstr = vx .. \" <= \" .. tostring(v[\"<\"][\"Value\"]);\r\n\t\tend\r\n\t\t\r\n\t\tif v[\">\"][\"checked\"] then\r\n\t\t\t\r\n\t\t\tif str then\r\n\t\t\t\tstr = str .. \" and \" .. vx .. \" > \" .. tostring(v[\">\"][\"Value\"]);\r\n\t\t\telse\r\n\t\t\t\tstr = vx .. \" >= \" .. tostring(v[\">\"][\"Value\"]);\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\t\r\n\tend\r\n\t\r\n\tif str then\r\n\t\treturn str;\r\n\telse\r\n\t\treturn \"false\";\r\n\tend\r\n\t\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_ApiDbf_1_Boolean(ApiDbf,unit,v,i)---布尔值返回值的求值表达式\r\n\t\r\n\tlocal apiinf = SuperTreatment[\"Api\"][ApiDbf[\"id\"]];\r\n\tlocal str;\r\n\tlocal Failure = apiinf[\"Returns\"][i][\"Failure\"];\r\n\tlocal vx;\r\n\t\r\n\tif Failure == nil then\r\n\t\tvx = \"v[\" .. i .. \"]\";\r\n\telse\r\n\t\tif type(Failure) == \"string\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or '\" .. Failure .. \"')\" ;\r\n\t\telseif type(Failure) == \"number\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or \" .. tostring(Failure) .. \")\" ;\r\n\t\telseif type(Failure) == \"boolean\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or \" .. tostring(Failure)  .. \")\";\r\n\t\telse\r\n\t\t\tvx = \"v[\" .. i .. \"]\";\r\n\t\tend\r\n\tend\r\n\t\r\n\t\r\n\t--local str;\r\n\t--local vx = \"v[\" .. i .. \"]\";\r\n\t\r\n\tif v[\"checked\"] then\r\n\t\t\r\n\t\tstr = \"amtoboolean(\" ..vx ..\") == \" .. tostring(amtoboolean(v[\"value\"]));\r\n\t\t\r\n\tend\r\n\t\r\n\treturn str;\r\n\t\r\n\t\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_ApiDbf_1_String(ApiDbf,unit,v,i)---字符串返回值的求值表达式\r\n\t\r\n\t--local str;\r\n\tlocal Select = v[\"Select\"];\r\n\tlocal strlist;\r\n\tlocal isRadio = v[\"isRadio\"];\r\n\t--local vx = \"v[\" .. i .. \"]\";\r\n\t\r\n\tlocal apiinf = SuperTreatment[\"Api\"][ApiDbf[\"id\"]];\r\n\tlocal str;\r\n\tlocal Failure = apiinf[\"Returns\"][i][\"Failure\"];\r\n\tlocal vx;\r\n\t\r\n\tif Failure == nil then\r\n\t\tvx = \"v[\" .. i .. \"]\";\r\n\telse\r\n\t\tif type(Failure) == \"string\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or '\" .. Failure .. \"')\" ;\r\n\t\telseif type(Failure) == \"number\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or \" .. tostring(Failure) .. \")\" ;\r\n\t\telseif type(Failure) == \"boolean\" then\r\n\t\t\tvx = \"(v[\" .. i .. \"] or \" .. tostring(Failure)  .. \")\";\r\n\t\telse\r\n\t\t\tvx = \"v[\" .. i .. \"]\";\r\n\t\tend\r\n\tend\r\n\t\r\n\t\r\n\tfor k, d in pairs(Select) do\r\n\t\tif strlist then\r\n\t\t\tstrlist = strlist .. \",\" .. d;\r\n\t\telse\r\n\t\t\tstrlist =  d;\r\n\t\tend\r\n\tend\r\n\t\r\n\tif v[\"checked\"] and strlist then\r\n\t\t\r\n\t\tif \"Contains\" == isRadio then\r\n\t\t\t\r\n\t\t\tstr = 'amfind(' .. vx .. ',\"' .. strlist .. '\",0)';\r\n\t\t\r\n\t\telseif \"NoContains\" == isRadio then\r\n\t\t\r\n\t\t\tstr = 'not amfind(' .. vx .. ',\"' .. strlist .. '\",0)';\r\n\t\t\t\r\n\t\telseif \"FuzzyContains\" == isRadio then\r\n\t\t\r\n\t\t\tstr = 'amfind(' .. vx .. ',\"' .. strlist .. '\",-1)';\r\n\t\t\r\n\t\telseif \"FuzzyNoContains\" == isRadio then\r\n\t\t\tstr = 'not amfind(' .. vx .. ',\"' .. strlist .. '\",-1)';\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\tif not str or not strlist then\r\n\t\r\n\t\treturn \"false\";\r\n\t\t\r\n\telse\r\n\t\r\n\t\treturn str;\r\n\t\r\n\tend\r\n\t\r\n\t\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Blood(data,unit)\r\n\t\r\n\tlocal tbl = data[\"Blood\"];\r\n\t\r\n\tlocal Percentage = tbl[\"Percentage\"];\r\n\tlocal Lack = tbl[\"Lack\"];\r\n\tlocal str;\r\n\tlocal a,b;\r\n\t\r\n\tif Lack then\r\n\t\tLack =1;\r\n\telse\r\n\t\tLack=0;\r\n\tend\r\n\t\r\n\tif Percentage then\r\n\t\tPercentage =\"%\";\r\n\telse\r\n\t\tPercentage=false;\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif tbl[\"<\"][\"checked\"] then\r\n\t\ta = aml(unit,Percentage,Lack) <=  tbl[\"<\"][\"Value\"];\r\n\telse\r\n\t\ta = true;\r\n\tend\r\n\t\r\n\tif tbl[\">\"][\"checked\"] then\r\n\t\t\r\n\t\tb = aml(unit,Percentage,Lack) >=  tbl[\">\"][\"Value\"];\r\n\telse\r\n\t\tb = true;\r\n\tend\r\n\t\r\n\treturn a and b and (tbl[\">\"][\"checked\"] or tbl[\"<\"][\"checked\"]);\r\n\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Buff(data,unit) \r\n\t\r\n\t\r\n\treturn ST.mminimumFast_SpellsRun_buff(unit,data[\"NewBuff\"][\"buffs\"],nil,data[\"NewBuff\"]);\r\n\t\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_Buff_old(data,unit)\r\n\t\r\n\tlocal IsBuff = false;\r\n\tlocal Time = false;\r\n\tlocal Layer = false;\r\n\t\r\n\tlocal Buff = data[\"Buff\"];\r\n\tlocal OwnChecked = Buff[\"OwnChecked\"];\t\r\n\t\r\n\t\r\n\t\r\n\tif Buff[\"IsBuff\"][\"checked\"] then\r\n\t\r\n\t\tlocal NoBuffChecked = Buff[\"IsBuff\"][\"NoBuffChecked\"];\r\n\t\tlocal BuffName = Buff[\"IsBuff\"][\"BuffName\"];\r\n\t\tlocal strlist={};\r\n\t\t\r\n\t\tlocal v= Buff[\"IsBuff\"];\r\n\t\tlocal TextureTbl={};\r\n\t\tlocal SpellIdTbl={};\r\n\t\tlocal NameTbl={};\t\t\t\r\n\t\tlocal Name,Texture;\r\n\t\tlocal v1,v2,v3={},{},{};\r\n\t\t\r\n\t\tfor k, d in pairs(BuffName) do\r\n\t\t\r\n\t\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\r\n\t\t\tif d[\"IsTexture\"] then\r\n\t\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\t\r\n\t\t\telseif d[\"IsSpellId\"] then\r\n\t\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\t\r\n\t\t\telse\r\n\t\t\t\ttable.insert(NameTbl,Name)\r\n\t\t\tend\t\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif #NameTbl>0 or #TextureTbl>0 or #SpellIdTbl>0 then\r\n\t\t\r\n\t\t\tif OwnChecked then\r\n\t\t\t\r\n\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\t\ttable.insert(v1,\"name\")\r\n\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\ttable.insert(v3,0)\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif #TextureTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal N = #ambufflist(unit,v1,v2,v3);\r\n\t\t\t\r\n\t\t\tIsBuff = N >0;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif NoBuffChecked then\r\n\t\t\t\tIsBuff = not IsBuff;\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\telse\r\n\t\tIsBuff=true;\r\n\tend\r\n\t\r\n\t\r\n\r\n\t\r\n\tif Buff[\"Time\"][\"checked\"] then\r\n\t\r\n\t\tlocal Start = Buff[\"Time\"][\"Start\"][\"checked\"] or Buff[\"Time\"][\"Start\"][\"Maxchecked\"];\r\n\t\tlocal Remaining = Buff[\"Time\"][\"Remaining\"][\"checked\"] or Buff[\"Time\"][\"Remaining\"][\"Maxchecked\"];\r\n\t\tlocal strlist;\r\n\t\tlocal BuffName = Buff[\"Time\"][\"BuffName\"];\r\n\t\t\r\n\t\tlocal isStart= true;\r\n\t\tlocal isRemaining= true;\r\n\t\t\r\n\t\tif Remaining then\r\n\t\t\t--print(\"Remaining\")\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tisRemaining =false;\r\n\t\t\t\r\n\t\t\tlocal v= Buff[\"Time\"][\"Remaining\"];\r\n\t\t\tlocal TextureTbl={};\r\n\t\t\tlocal SpellIdTbl={};\r\n\t\t\tlocal NameTbl={};\t\t\t\r\n\t\t\tlocal Name,Texture;\r\n\t\t\tlocal v1,v2,v3={},{},{};\r\n\t\t\t\r\n\t\t\tfor k, d in pairs(BuffName) do\r\n\t\t\t\r\n\t\t\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif d[\"IsTexture\"] then\r\n\t\t\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif d[\"IsSpellId\"] then\r\n\t\t\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(NameTbl,Name)\r\n\t\t\t\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #NameTbl>0 then\r\n\t\t\t\r\n\t\t\t\tif OwnChecked then\r\n\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif #TextureTbl>0 then\r\n\t\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tlocal N = #ambufflist(unit,v1,v2,v3);\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tv1,v2,v3={},{},{};\r\n\t\t\t\t\r\n\t\t\t\tif N>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\tif #NameTbl>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif OwnChecked then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif v[\"checked\"] and not v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tv1={\"player\",\"time\"};\r\n\t\t\t\t\t\t\t\tv2={false,false};\r\n\t\t\t\t\t\t\t\tv3={false,v[\"Value\"]};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif not v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tv1={\"player\",\"time\"};\r\n\t\t\t\t\t\t\t\tv2={false,v[\"MaxValue\"]};\r\n\t\t\t\t\t\t\t\tv3={false,false};\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tv1={\"player\",\"time\"};\r\n\t\t\t\t\t\t\t\tv2={false,v[\"Value\"]};\r\n\t\t\t\t\t\t\t\tv3={false,v[\"MaxValue\"]};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif v[\"checked\"] and not v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tv1={\"time\"};\r\n\t\t\t\t\t\t\t\tv2={false};\r\n\t\t\t\t\t\t\t\tv3={v[\"Value\"]};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif not v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tv1={\"time\"};\r\n\t\t\t\t\t\t\t\tv2={v[\"MaxValue\"]};\r\n\t\t\t\t\t\t\t\tv3={false};\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\telseif v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tv1={\"time\"};\r\n\t\t\t\t\t\t\t\tv2={v[\"Value\"]};\r\n\t\t\t\t\t\t\t\tv3={v[\"MaxValue\"]};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif v1 and #v1>0 then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif #TextureTbl>0 then\r\n\t\t\t\t\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\t\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\t\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\t\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif #ambufflist(unit,v1,v2,v3)>0 then\r\n\t\t\t\t\t\t\t\tisRemaining = true;\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t--[[\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tamv={}\r\n\t\t\t\t\t\t\tamv[1]=v1\r\n\t\t\t\t\t\t\tamv[2]=v2\r\n\t\t\t\t\t\t\tamv[3]=v3\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t--]]\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\t\r\n\t\t\t\t\tif v[\"checked\"] and not v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tisRemaining =  0 <= v[\"Value\"] \r\n\t\t\t\t\t\t\r\n\t\t\t\t\telseif not v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tisRemaining = 0 >= v[\"MaxValue\"]\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telseif v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tisRemaining =  0 <= v[\"Value\"] and 0 >= v[\"MaxValue\"];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif Start then\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tisStart =false;\r\n\t\t\tlocal v= Buff[\"Time\"][\"Start\"];\r\n\t\t\tlocal TextureTbl={};\r\n\t\t\tlocal SpellIdTbl={};\r\n\t\t\tlocal NameTbl={};\t\t\t\r\n\t\t\tlocal Name,Texture;\r\n\t\t\tlocal v1,v2,v3;\r\n\t\t\t\r\n\t\t\tfor k, d in pairs(BuffName) do\r\n\t\t\t\r\n\t\t\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif d[\"IsTexture\"] then\r\n\t\t\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif d[\"IsSpellId\"] then\r\n\t\t\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(NameTbl,Name)\r\n\t\t\t\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #NameTbl>0 then\r\n\t\t\t\r\n\t\t\t\tif OwnChecked then\r\n\t\t\t\t\r\n\t\t\t\t\tif v[\"checked\"] and not v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tv1={\"player\",\"passingtime\"};\r\n\t\t\t\t\t\tv2={false,v[\"Value\"]};\r\n\t\t\t\t\t\tv3={false,false};\r\n\t\t\t\t\t\r\n\t\t\t\t\telseif not v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tv1={\"player\",\"passingtime\"};\r\n\t\t\t\t\t\tv2={false,false};\r\n\t\t\t\t\t\tv3={false,v[\"MaxValue\"]};\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\telseif v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tv1={\"player\",\"passingtime\"};\r\n\t\t\t\t\t\tv2={false,v[\"Value\"]};\r\n\t\t\t\t\t\tv3={false,v[\"MaxValue\"]};\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\t\r\n\t\t\t\t\tif v[\"checked\"] and not v[\"Maxchecked\"] then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tv1={\"passingtime\"};\r\n\t\t\t\t\t\tv2={v[\"Value\"]};\r\n\t\t\t\t\t\tv3={false};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\telseif not v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tv1={\"passingtime\"};\r\n\t\t\t\t\t\tv2={false};\r\n\t\t\t\t\t\tv3={v[\"MaxValue\"]};\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\telseif v[\"checked\"] and v[\"Maxchecked\"] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tv1={\"passingtime\"};\r\n\t\t\t\t\t\tv2={v[\"Value\"]};\r\n\t\t\t\t\t\tv3={v[\"MaxValue\"]};\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif v1 and #v1>0 then\r\n\t\t\t\t\r\n\t\t\t\t\tif #TextureTbl>0 then\r\n\t\t\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\t\r\n\t\t\t\t\tif #ambufflist(unit,v1,v2,v3)>0 then\r\n\t\t\t\t\t\tisStart = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t--[[\r\n\t\t\t\t\tamv={}\r\n\t\t\t\t\tamv[1]=v1\r\n\t\t\t\t\tamv[2]=v2\r\n\t\t\t\t\tamv[3]=v3\r\n\t\t\t\t\t--]]\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\t\tif Start or Remaining then\r\n\t\t\tTime = isStart and isRemaining;\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t--[[\t\r\n\t\tif Start or Remaining then\r\n\t\t\r\n\t\t\tfor k, d in pairs(BuffName) do\r\n\t\t\t\t\r\n\t\t\t\tlocal v = d[\"Name\"];\r\n\t\t\t\tlocal name,duration,expirationTime,TOTime;\r\n\t\t\t\tlocal unitCaster,tn;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif OwnChecked then\r\n\t\t\t\t\t\r\n\t\t\t\t\ttn,_,_,_,_,unitCaster,duration,expirationTime = amaura(v,unit,0,0);\r\n\t\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\t\ttn,_,_,_,_,unitCaster,duration,expirationTime = amaura(v,unit,2,0);\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif tn > 0 then\r\n\t\t\t\t\t\tname = v;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tname = false;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tlocal n;\r\n\t\t\t\t\tif name then\r\n\t\t\t\t\t\tn = expirationTime - GetTime();\r\n\t\t\t\t\t\tTOTime = duration - (expirationTime - GetTime());\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tn = 0 ;\r\n\t\t\t\t\t\tTOTime = 0;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif Remaining then\r\n\t\t\t\t\t\tTime = n <= Buff[\"Time\"][\"Remaining\"][\"Value\"] ;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif Start then\r\n\t\t\t\t\t\tif Remaining then\r\n\t\t\t\t\t\t\tTime = Time and TOTime >= Buff[\"Time\"][\"Start\"][\"Value\"] ;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tTime = TOTime >= Buff[\"Time\"][\"Start\"][\"Value\"] ;\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif Time then\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\tend\t\t\r\n\t\t\r\n\t--]]\t\r\n\t\t\t\r\n\t\tif not Time then\r\n\t\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\r\n\telse\t\r\n\t\tTime=true;\r\n\tend\r\n\t\r\n\t\r\n\tif Buff[\"Layer\"][\"checked\"] then\r\n\t\r\n\t\tlocal MaxChecked = Buff[\"Layer\"][\"<\"][\"checked\"];\r\n\t\tlocal MinChecked = Buff[\"Layer\"][\">\"][\"checked\"];\r\n\t\tlocal strlist;\r\n\t\tlocal BuffName = Buff[\"Layer\"][\"BuffName\"];\r\n\t\tlocal i=0;\r\n\t\t\r\n\t\tlocal v= Buff[\"Layer\"];\r\n\t\tlocal TextureTbl={};\r\n\t\tlocal SpellIdTbl={};\r\n\t\tlocal NameTbl={};\t\t\t\r\n\t\tlocal Name,Texture;\r\n\t\tlocal v1,v2,v3={},{},{};\r\n\t\t\r\n\t\tfor k, d in pairs(BuffName) do\r\n\t\t\r\n\t\t\tName,_,Texture=GetSpellInfo(d.SpellId);\r\n\t\t\t\t\t\t\t\r\n\t\t\tif d[\"IsTexture\"] then\r\n\t\t\t\ttable.insert(TextureTbl,Texture)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif d[\"IsSpellId\"] then\r\n\t\t\t\ttable.insert(SpellIdTbl,d.SpellId)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\ttable.insert(NameTbl,Name)\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\tif #NameTbl>0 then\r\n\t\t\tif OwnChecked then\r\n\t\t\t\r\n\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #TextureTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\ttable.insert(v3,false)\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tlocal N = #ambufflist(unit,v1,v2,v3);\r\n\t\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\tv1,v2,v3={},{},{};\r\n\t\t\t\r\n\t\t\tif N>0 then\r\n\t\t\t\t\r\n\t\t\t\tif OwnChecked then\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"player\")\r\n\t\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\tif MinChecked and not MaxChecked then\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"count\")\r\n\t\t\t\t\ttable.insert(v2,v[\">\"][\"Value\"])\r\n\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\telseif not MinChecked and MaxChecked then\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"count\")\r\n\t\t\t\t\ttable.insert(v2,false)\r\n\t\t\t\t\ttable.insert(v3,v[\"<\"][\"Value\"])\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\telseif MinChecked and MaxChecked then\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"count\")\r\n\t\t\t\t\ttable.insert(v2,v[\">\"][\"Value\"])\r\n\t\t\t\t\ttable.insert(v3,v[\"<\"][\"Value\"])\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif v1 and #v1>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tif #TextureTbl>0 then\r\n\t\t\t\t\t\ttable.insert(v1,\"icon\")\r\n\t\t\t\t\t\ttable.insert(v2,TextureTbl)\r\n\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tif #SpellIdTbl>0 then\r\n\t\t\t\t\t\ttable.insert(v1,\"id\")\r\n\t\t\t\t\t\ttable.insert(v2,SpellIdTbl)\r\n\t\t\t\t\t\ttable.insert(v3,false)\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\ttable.insert(v1,\"name\")\r\n\t\t\t\t\ttable.insert(v2,NameTbl)\r\n\t\t\t\t\ttable.insert(v3,0)\r\n\t\t\t\t\t\r\n\t\t\t\t\tif #ambufflist(unit,v1,v2,v3)>0 then\r\n\t\t\t\t\t\tLayer = true;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t--[[\r\n\t\t\t\t\tamv={}\r\n\t\t\t\t\tamv[1]=v1\r\n\t\t\t\t\tamv[2]=v2\r\n\t\t\t\t\tamv[3]=v3\r\n\t\t\t\t\t--]]\r\n\t\t\t\tend\r\n\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\telse\r\n\t\t\t\r\n\t\t\t\tif MinChecked and not MaxChecked then\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tLayer =  0 >= v[\">\"][\"Value\"]\r\n\t\t\t\t\t\r\n\t\t\t\telseif not MinChecked and MaxChecked then\r\n\t\t\t\t\r\n\t\t\t\t\tLayer = 0 <= v[\"<\"][\"Value\"]\r\n\t\t\t\t\t\r\n\t\t\t\telseif MinChecked and MaxChecked then\r\n\t\t\t\t\r\n\t\t\t\t\tLayer =  0 <= v[\"<\"][\"Value\"] and 0 >= v[\">\"][\"Value\"];\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\telse\r\n\t\tLayer=true;\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\treturn IsBuff and Time and Layer and \r\n\t(Buff[\"IsBuff\"][\"checked\"] or Buff[\"Time\"][\"checked\"] or Buff[\"Layer\"][\"checked\"]);\r\n\t\r\n\t\r\n\t\r\n\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_CastSpell(data,unit) ---读条技能 函数处理\r\n\r\n\treturn ST.mminimumFast_SpellsRun_spell(unit,data);\r\n\t\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_CastSpell_old(data,unit) ---读条技能 函数处理\r\n\r\n\tlocal tbl = data[\"CastSpell\"];\r\n\t\r\n\tlocal spell, _, _, _, startTime, endTime,_,_,Interrupt = UnitCastingInfo(unit)\r\n\tif not spell then\r\n\t\tspell, _, _, _, startTime, endTime,_,Interrupt = UnitChannelInfo(unit)\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif not spell then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\tif tbl[\"InterruptChecked\"] and Interrupt then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\tlocal AllInterruptChecked = tbl[\"AllInterruptChecked\"];\r\n\tlocal Spells = tbl[\"Spells\"];\r\n\tlocal name;\r\n\tlocal Isvalue,IsPoorvalue;\r\n\tlocal GTime =GetTime() - (startTime/1000);\r\n\tlocal LTime = (endTime/1000) - GetTime() ;\r\n\t\r\n\t\r\n\tif AllInterruptChecked then\r\n\t\t\r\n\t\tif tbl[\"Remaining\"][\"checked\"] then\r\n\t\t\tIsPoorvalue =  LTime <= tbl[\"Remaining\"][\"Value\"] ;\r\n\t\telse\r\n\t\t\tIsPoorvalue = true;\r\n\t\tend\r\n\t\t\r\n\t\tif tbl[\"Start\"][\"checked\"] then\r\n\t\t\tIsvalue =  GTime >= tbl[\"Start\"][\"Value\"] ;\r\n\t\telse\r\n\t\t\tIsvalue = true;\r\n\t\tend\r\n\t\r\n\t\treturn IsPoorvalue and Isvalue ;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tfor k, d in pairs(Spells) do\r\n\t\t\tif d[\"Name\"] == spell then\r\n\t\t\t\tname = spell;\r\n\t\t\t\tbreak;\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\t\tif not name then return false; end;\r\n\t\t\r\n\t\tif tbl[\"Remaining\"][\"checked\"] then\r\n\t\t\tIsPoorvalue =  LTime <= tbl[\"Remaining\"][\"Value\"] ;\r\n\t\telse\r\n\t\t\tIsPoorvalue = true;\r\n\t\tend\r\n\t\t\r\n\t\tif tbl[\"Start\"][\"checked\"] then\r\n\t\t\tIsvalue =  GTime >= tbl[\"Start\"][\"Value\"] ;\r\n\t\telse\r\n\t\t\tIsvalue = true;\r\n\t\tend\r\n\t\r\n\t\treturn IsPoorvalue and Isvalue ;\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\treturn false;\r\n\t\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Class(data,unit) ---职业 函数处理\r\n\r\n\tlocal tbl = data[\"Class\"][\"Excluded\"];\r\n\tlocal localizedClass, englishClass = UnitClass(unit);\r\n\t\r\n\treturn not tbl[englishClass];\r\n\t\r\n\r\nend\r\n\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_ComboPoints(data,unit) ---职业 函数处理\r\n\r\n\tlocal tbl = data[\"ComboPoints\"];\r\n\tlocal v = GetComboPoints(unit);\r\n\tlocal a,b;\r\n\t\r\n\tif tbl[\"<\"][\"checked\"] then\r\n\t\ta = v <= tbl[\"<\"][\"Value\"];\r\n\telse\r\n\t\ta = true;\r\n\tend\r\n\t\r\n\tif tbl[\">\"][\"checked\"] then\r\n\t\t\r\n\t\tb = v >= tbl[\">\"][\"Value\"] ;\r\n\telse\r\n\t\tb = true;\r\n\tend\r\n\t\r\n\t\r\n\treturn a and b and (tbl[\">\"][\"checked\"] or tbl[\"<\"][\"checked\"]);\r\n\t\r\n\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_RangeCheck(data,unit) ---职业 函数处理\r\n\r\n\t\r\n\tlocal tblR = data[\"RangeCheck\"][\"Range\"];\r\n\tlocal tblC = data[\"RangeCheck\"][\"Count\"];\r\n\tlocal dots;\r\n\t\r\n\tif ST.RangeCheck.dots and GetTime() - ST.RangeCheck.UpTime <0.01 then\r\n\t\tdots = ST.RangeCheck.dots;\r\n\telse\r\n\t\tdots = ST.RangeCheck.Radar(unit,1000);\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\tif not dots then\r\n\t\treturn false;\r\n\tend\r\n\r\n\tlocal Count = 0;\r\n\tlocal A,B;\r\n\t\r\n\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\r\n\t\tif not UnitIsUnit(v.uId, unit) then\r\n\t\t\r\n\t\t\tlocal x = v.x\r\n\t\t\tlocal y = v.y\r\n\t\t\tlocal range = (x*x + y*y) ^ 0.5\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif tblR[\"<\"][\"checked\"] then\r\n\t\t\t\tA = range <= 1.10 * tblR[\"<\"][\"Value\"];\r\n\t\t\telse\r\n\t\t\t\tA = true;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif tblR[\">\"][\"checked\"] then\r\n\t\t\t\tB = range >= tblR[\">\"][\"Value\"];\r\n\t\t\telse\r\n\t\t\t\tB = true;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif A and B and (tblR[\">\"][\"checked\"] or tblR[\"<\"][\"checked\"]) then\r\n\t\t\t\t\r\n\t\t\t\tCount = Count +1;\r\n\t\t\t\r\n\t\t\tend\r\n\t\tend\t\r\n\t\t\t\t\t\r\n\tend\r\n\t--print(\"Count\",Count)\r\n\tlocal a,b;\r\n\t\r\n\tif tblC[\"<\"][\"checked\"] then\r\n\t\ta = Count <= tblC[\"<\"][\"Value\"];\r\n\telse\r\n\t\ta = true;\r\n\tend\r\n\t\r\n\tif tblC[\">\"][\"checked\"] then\r\n\t\tb = Count >= tblC[\">\"][\"Value\"];\r\n\telse\r\n\t\tb = true;\r\n\tend\r\n\t--print(\"c\",tblC[\"<\"][\"checked\"],tblC[\">\"][\"checked\"])\r\n\t--print(a,b)\r\n\t\r\n\treturn a and b and (tblC[\">\"][\"checked\"] or tblC[\"<\"][\"checked\"]);\r\n\t\r\n\t\r\n\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_PlayerRangeCheckAngle(data,unit) ---职业 函数处理\r\n\t\t\r\n\tlocal tbl = data[\"PlayerRangeCheckAngle\"];\r\n\t\r\n\tif not (tbl[\"Range\"][\">\"][\"checked\"] or tbl[\"Range\"][\"<\"][\"checked\"]) or not(UnitInRaid(unit) or UnitInParty(unit))  then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\tif tbl[\"AngleChecked\"] and not UnitIsUnit(unit, \"player\") and tbl[\"AngleValue\"] <=0 and not tbl[\"ContainChecked\"] then\r\n\t\treturn false;\r\n\tend\r\n\r\n\tlocal IsRange = false;\r\n\tlocal IsCount = true;\r\n\tlocal IsBuff = true;\r\n\tlocal IsHealth = true;\r\n\tlocal IsAngle = true;\r\n\t\r\n\tlocal tblR = tbl[\"Range\"];\r\n\tlocal tblC = tbl[\"Count\"];\r\n\tlocal dots;\r\n\tlocal ContainChecked = tbl[\"ContainChecked\"];\r\n\tlocal AngleChecked = tbl[\"AngleChecked\"]\r\n\t\r\n\t\r\n\t\r\n\tdots = ST.RangeCheck.Radar(unit,1000);\r\n\t\r\n\t\r\n\tif not dots then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\t\t\r\n\tif true then\r\n\t\r\n\t\tlocal Count = 0;\r\n\t\tlocal A,B;\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\t\r\n\t\t\tv.IsRange = false;\r\n\t\t\tv.ok = false;\r\n\t\t\t\r\n\t\t\tif ContainChecked or (not ContainChecked and not UnitIsUnit(v.uId, unit)) then\r\n\t\t\t\r\n\t\t\t\tlocal x = v.x\r\n\t\t\t\tlocal y = v.y\r\n\t\t\t\tlocal range = (x*x + y*y) ^ 0.5\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif tblR[\"<\"][\"checked\"] then\r\n\t\t\t\t\tA = range <= 1.10 * tblR[\"<\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tA = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif tblR[\">\"][\"checked\"] then\r\n\t\t\t\t\tB = range >= tblR[\">\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tB = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif A and B and (tblR[\">\"][\"checked\"] or tblR[\"<\"][\"checked\"]) then\r\n\t\t\t\t\t\r\n\t\t\t\t\tCount = Count +1;\r\n\t\t\t\t\tv.IsRange = true;\r\n\t\t\t\t\tv.ok = true;\r\n\t\t\t\tend\r\n\t\t\tend\t\r\n\t\t\t\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif Count<=0 then\r\n\t\t\treturn false;\r\n\t\telse\r\n\t\t\tIsRange=true;\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\tif AngleChecked then\r\n\t\t\r\n\t\tIsAngle = false;\r\n\t\tlocal Count = 0;\r\n\t\t\r\n\t\tlocal AngleMin = tbl[\"AngleValue\"]/2 * -1;\r\n\t\tlocal AngleMax = tbl[\"AngleValue\"]/2;\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tv.IsAngle = false;\r\n\t\t\t\r\n\t\t\tif v.ok then\r\n\t\t\t\t\r\n\t\t\t\tif v.Angle >= AngleMin and v.Angle <= AngleMax then\r\n\t\t\t\t\r\n\t\t\t\t\tv.IsAngle = true;\r\n\t\t\t\t\tCount = Count +1 ;\r\n\t\t\t\t\tv.ok = true;\r\n\t\t\t\t\t\r\n\t\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\t\tv.ok = false;\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tIsAngle = Count > 0;\r\n\t\r\n\tend\r\n\t\r\n\tfor k, v in pairs(dots) do\r\n\t\r\n\t\tif v.ok then\r\n\t\t\r\n\t\t\tlocal Group = ST[\"UnitId\"][v.uId][\"subgroup\"];\r\n\t\t\tlocal name = ST[\"UnitId\"][v.uId][\"name\"];\r\n\t\t\t\t\r\n\t\t\tif tbl[\"ExcludedTarget\"][\"checked\"] then\t\r\n\t\t\t\r\n\t\t\r\n\t\t\t\tlocal IsExcludedTarget = true;\r\n\t\t\t\tlocal IsExcludedGroup = true;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"ExcludedTarget\"][\"TargetCount\"]>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tIsExcludedTarget = not tbl[\"ExcludedTarget\"][\"Target\"][name];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"ExcludedTarget\"][\"GroupCount\"]>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tIsExcludedGroup = not tbl[\"ExcludedTarget\"][\"Group\"][Group];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif IsExcludedGroup and IsExcludedTarget then\r\n\t\t\t\t\tv.ok = true;\r\n\t\t\t\telse\r\n\t\t\t\t\tv.ok = false;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\r\n\t\t\t\t--v.ok =  ExcludedTargetGroup(name);\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif tbl[\"ExcludedClass\"][\"checked\"] and v.ok then\r\n\t\r\n\t\t\t\tif tbl[\"ExcludedClass\"][\"ClassCount\"]>0 then\r\n\t\t\t\t\t\r\n\t\t\t\t\tlocal Class = ST[\"UnitId\"][v.uId][\"englishClass\"];\r\n\t\t\t\t\t\r\n\t\t\t\t\tv.ok = not tbl[\"ExcludedClass\"][\"Class\"][Class];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tif tbl[\"Health\"][\">\"][\"checked\"] or tbl[\"Health\"][\"<\"][\"checked\"] then\t\r\n\t\r\n\t\tIsHealth = false;\r\n\t\tlocal Percentage,Lack\r\n\t\tlocal Count = 0;\r\n\t\t\t\r\n\t\tif tbl.HealthPercentageChecked then\r\n\t\t\tPercentage = \"%\";\r\n\t\telse\r\n\t\t\tPercentage = \"1\";\r\n\t\tend\r\n\t\t\r\n\t\tif tbl.LackHealthChecked then\r\n\t\t\tLack = 1;\r\n\t\telse\r\n\t\t\tLack = 0;\r\n\t\tend\r\n\t\r\n\t\r\n\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tv.IsHealth = false;\r\n\t\t\t\r\n\t\t\tif v.ok then\r\n\t\t\t\r\n\t\t\t\tlocal A,B;\r\n\t\t\t\tlocal Health = aml(v.uId,Percentage,Lack);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\tif tbl[\"Health\"][\"<\"][\"checked\"] then\r\n\t\t\t\t\tA = Health <= tbl[\"Health\"][\"<\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tA = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif tbl[\"Health\"][\">\"][\"checked\"] then\r\n\t\t\t\t\tB = Health >= tbl[\"Health\"][\">\"][\"Value\"];\r\n\t\t\t\telse\r\n\t\t\t\t\tB = true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif A and B then\r\n\t\t\t\t\t\r\n\t\t\t\t\tCount = Count +1;\r\n\t\t\t\t\tv.IsHealth = true;\r\n\t\t\t\t\tv.ok = true;\r\n\t\t\t\telse\r\n\t\t\t\t\tv.ok = false;\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tIsHealth = Count >0;\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tif tbl[\"NewBuff\"][\"checked\"] then\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\tif v.ok then\r\n\t\t\r\n\t\t\t\tv.ok= ST.mminimumFast_SpellsRun_buff(unit,tbl[\"NewBuff\"][\"buffs\"],nil,tbl[\"NewBuff\"]);\r\n\t\t\t\tv.IsBuff=v.ok;\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\t\r\n\tend\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tif tbl[\"Count\"][\">\"][\"checked\"] or tbl[\"Count\"][\"<\"][\"checked\"] then\r\n\t\r\n\t\tlocal a,b;\r\n\t\tlocal Count = 0;\r\n\t\t\r\n\t\tIsCount = false\r\n\t\t\r\n\t\tfor k, v in pairs(dots) do\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tv.IsCount = false;\r\n\t\t\t\t\t\t\r\n\t\t\tif v.ok then\r\n\t\t\t\tCount = Count +1;\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif tblC[\"<\"][\"checked\"] then\r\n\t\t\ta = Count <= tblC[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\ta = true;\r\n\t\tend\r\n\t\t\r\n\t\tif tblC[\">\"][\"checked\"] then\r\n\t\t\tb = Count >= tblC[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tb = true;\r\n\t\tend\r\n\t\t\r\n\t\tif not tblC[\">\"][\"checked\"] and not tblC[\"<\"][\"checked\"] then\r\n\t\t\tIsCount = true;\r\n\t\telse\r\n\t\t\tIsCount = a and b;\r\n\t\tend\r\n\t\t\r\n\tend\r\n\t\r\n\t\r\n\t--print(IsRange , IsCount , IsBuff , IsHealth , IsAngle)\r\n\t\r\n\treturn IsCount;\r\n\t\r\nend\r\n\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Cooldown(data,unit) ---技能冷却 函数处理\r\n\r\n\tlocal tbl = data[\"Cooldown\"];\r\n\t\r\n\tif not (tbl[\">\"][\"checked\"] or tbl[\"<\"][\"checked\"]) then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\tlocal Spells = tbl[\"name\"];\r\n\t\r\n\t\r\n\t\r\n\tfor k, d in pairs(Spells) do\r\n\t\tlocal v = amcd(d[\"Name\"]);\r\n\t\t\r\n\t\tif v ~= -1 then\r\n\t\t\t\r\n\t\t\tlocal a,b;\r\n\t\r\n\t\t\tif tbl[\"<\"][\"checked\"] then\r\n\t\t\t\ta = v <= tbl[\"<\"][\"Value\"];\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\ta = true;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif tbl[\">\"][\"checked\"] then\r\n\t\t\t\t\r\n\t\t\t\tb = v >= tbl[\">\"][\"Value\"] ;\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\tb = true;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\treturn a and b;\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\tend\r\n\t\r\n\treturn false;\r\n\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_SpecialEnergy(data,unit) ---特殊能量\r\n\r\n\tlocal tbl = data[\"SpecialEnergy\"];\r\n\tlocal v = amrs();\r\n\tlocal a,b;\r\n\t\r\n\tif tbl[\"<\"][\"checked\"] then\r\n\t\ta = v <= tbl[\"<\"][\"Value\"];\r\n\telse\r\n\t\ta = true;\r\n\tend\r\n\t\r\n\tif tbl[\">\"][\"checked\"] then\r\n\t\t\r\n\t\tb = v >= tbl[\">\"][\"Value\"] ;\r\n\telse\r\n\t\tb = true;\r\n\tend\r\n\t\r\n\t\r\n\treturn a and b and (tbl[\">\"][\"checked\"] or tbl[\"<\"][\"checked\"]);\r\n\t\r\n\r\nend\r\n\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Distance(data,unit) ---距离 函数处理\r\n\r\n\tlocal tbl = data[\"Distance\"];\r\n\tlocal v = amjl(unit);\r\n\tlocal a,b;\r\n\t\r\n\tif tbl[\"<\"][\"checked\"] then\r\n\t\ta = v <= tbl[\"<\"][\"Value\"];\r\n\telse\r\n\t\ta = true;\r\n\tend\r\n\t\r\n\tif tbl[\">\"][\"checked\"] then\r\n\t\t\r\n\t\tb = v >= tbl[\">\"][\"Value\"] ;\r\n\telse\r\n\t\tb = true;\r\n\tend\r\n\t\r\n\t\r\n\treturn a and b and (tbl[\">\"][\"checked\"] or tbl[\"<\"][\"checked\"]);\r\n\t\r\n\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Energy(data,unit) ---能量 函数处理\r\n\t\r\n\tlocal tbl = data[\"Energy\"];\r\n\t\r\n\t\r\n\tlocal Percentage = tbl[\"Percentage\"];\r\n\tlocal Lack = tbl[\"Lack\"];\r\n\tlocal str;\r\n\tlocal a,b;\r\n\t\r\n\tif Lack then\r\n\t\tLack =1;\r\n\telse\r\n\t\tLack=0;\r\n\tend\r\n\t\r\n\tif Percentage then\r\n\t\tPercentage =\"%\";\r\n\telse\r\n\t\tPercentage=false;\r\n\tend\r\n\t\t\r\n\tif tbl[\"<\"][\"checked\"] then\r\n\t\ta = amr(unit,Percentage,Lack) <=  tbl[\"<\"][\"Value\"];\r\n\telse\r\n\t\ta = true;\r\n\tend\r\n\t\r\n\tif tbl[\">\"][\"checked\"] then\r\n\t\t\r\n\t\tb = amr(unit,Percentage,Lack) >=  tbl[\">\"][\"Value\"];\r\n\telse\r\n\t\tb = true;\r\n\tend\r\n\t\r\n\treturn a and b and (tbl[\">\"][\"checked\"] or tbl[\"<\"][\"checked\"]);\r\n\r\nend\r\n\r\nfunction ST.Unit_SpellsRun_2_IsTarget(data,unit) ---目标函数处理\r\n\t\r\n\tlocal checkedOK =false;\r\n\tlocal tbl = data[\"IsTarget\"][\"IsCustomizeTargetToPlayer\"];\r\n\tlocal Targets = tbl[\"Targets\"];\r\n\tlocal playerGuid = UnitGUID(\"player\");\r\n\tlocal IsCustomizeTargetToPlayer;\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\tcheckedOK=true;\r\n\t\tfor k, d in pairs(Targets) do\r\n\t\t\t\r\n\t\t\tlocal id = UnitGUID(k .. \"-target\");\r\n\t\t\t\r\n\t\t\tif id then\r\n\t\t\t\r\n\t\t\t\tif id == playerGuid then\r\n\t\t\t\t\r\n\t\t\t\t\tIsCustomizeTargetToPlayer = k;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif tbl[\"not\"] then\r\n\t\t\t\t\t\tIsCustomizeTargetToPlayer = not IsCustomizeTargetToPlayer;\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif not IsCustomizeTargetToPlayer then\r\n\t\t\treturn false;\r\n\t\tend\r\n\telse\r\n\t\tIsCustomizeTargetToPlayer = true;\r\n\tend\r\n\t\r\n\t\r\n\t--------------------------------------\r\n\t\r\n\tlocal tbl = data[\"IsTarget\"][\"IsDefaultTargetToPlayer\"];\r\n\t\r\n\tlocal playerGuid = UnitGUID(\"player\");\r\n\tlocal IsDefaultTargetToPlayer;\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\tcheckedOK=true;\r\n\t\tlocal id = UnitGUID(unit .. \"-target\");\r\n\t\t\r\n\t\tif id then\r\n\t\t\r\n\t\t\tif id == playerGuid then\r\n\t\t\t\r\n\t\t\t\tIsDefaultTargetToPlayer = true;\r\n\t\t\t\tif tbl[\"not\"] then\r\n\t\t\t\t\tIsDefaultTargetToPlayer = not IsDefaultTargetToPlayer;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\t\t\r\n\t\tif not IsDefaultTargetToPlayer then\r\n\t\t\treturn false;\r\n\t\tend\r\n\telse\r\n\t\tIsDefaultTargetToPlayer = true;\r\n\tend\r\n\t\r\n\t--------------------------------------\r\n\t\r\n\tlocal tbl = data[\"IsTarget\"][\"IsFocusTargetToPlayer\"];\r\n\t\r\n\tlocal playerGuid = UnitGUID(\"player\");\r\n\tlocal IsFocusTargetToPlayer;\r\n\t\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\tcheckedOK=true;\r\n\t\tlocal id = UnitGUID(\"focustarget\");\r\n\t\t\r\n\t\tif id then\r\n\t\t\r\n\t\t\tif id == playerGuid then\r\n\t\t\t\r\n\t\t\t\tIsFocusTargetToPlayer = true;\r\n\t\t\t\tif tbl[\"not\"] then\r\n\t\t\t\t\tIsFocusTargetToPlayer = not IsFocusTargetToPlayer;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\t\t\r\n\t\tif not IsFocusTargetToPlayer then\r\n\t\t\treturn false;\r\n\t\tend\r\n\telse\r\n\t\tIsFocusTargetToPlayer = true;\r\n\tend\r\n\t\r\n\t--------------------------------------\r\n\t\r\n\tlocal tbl = data[\"IsTarget\"][\"IsMouseoverTargetToPlayer\"];\r\n\t\r\n\tlocal playerGuid = UnitGUID(\"player\");\r\n\tlocal IsMouseoverTargetToPlayer;\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\tcheckedOK=true;\r\n\t\tlocal id = UnitGUID(\"mouseovertarget\");\r\n\t\t\r\n\t\tif id then\r\n\t\t\r\n\t\t\tif id == playerGuid then\r\n\t\t\t\r\n\t\t\t\tIsMouseoverTargetToPlayer = true;\r\n\t\t\t\tif tbl[\"not\"] then\r\n\t\t\t\t\tIsMouseoverTargetToPlayer = not IsMouseoverTargetToPlayer;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\t\t\r\n\t\tif not IsMouseoverTargetToPlayer then\r\n\t\t\treturn false;\r\n\t\tend\r\n\telse\r\n\t\tIsMouseoverTargetToPlayer = true;\r\n\tend\r\n\t\r\n\t----------------------------\r\n\t\r\n\tlocal tbl = data[\"IsTarget\"][\"IsTarget\"];\r\n\tlocal Targets = tbl[\"Targets\"];\r\n\tlocal unitname = amGetUnitName(unit,true);\r\n\tlocal IsTarget;\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\tcheckedOK=true;\r\n\t\tif not playerGuid then return false;end;\r\n\t\t\r\n\t\tfor k, d in pairs(Targets) do\r\n\t\t\r\n\t\t\tif tbl[\"Contains\"] then\r\n\t\t\t\t\t\r\n\t\t\t\tif k == unitname then\r\n\t\t\t\t\tIsTarget = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\r\n\t\t\t\tif k == unitname then\r\n\t\t\t\t\tIsTarget = k;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif IsTarget == nil then\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\t\r\n\t\tif tbl[\"not\"] then\r\n\t\t\tIsTarget = not IsTarget;\r\n\t\tend\r\n\t\tif not IsTarget then\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\t\r\n\telse\r\n\t\tIsTarget = true;\r\n\tend\r\n\t\r\n\t\r\n\t--------------------------------------\r\n\t\r\n\tlocal tbl = data[\"IsTarget\"][\"IsTargetTargetToPlayer\"];\r\n\t\r\n\tlocal playerGuid = UnitGUID(\"player\");\r\n\tlocal IsTargetTargetToPlayer;\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\tcheckedOK=true;\r\n\t\tlocal id = UnitGUID(\"targettarget\");\r\n\t\t\r\n\t\tif id then\r\n\t\t\r\n\t\t\tif id == playerGuid then\r\n\t\t\t\r\n\t\t\t\tIsTargetTargetToPlayer = true;\r\n\t\t\t\tif tbl[\"not\"] then\r\n\t\t\t\t\tIsTargetTargetToPlayer = not IsTargetTargetToPlayer;\r\n\t\t\t\tend\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\t\t\r\n\t\tif not IsTargetTargetToPlayer then\r\n\t\t\treturn false;\r\n\t\tend\r\n\telse\r\n\t\tIsTargetTargetToPlayer = true;\r\n\tend\r\n\t\r\n\treturn IsCustomizeTargetToPlayer and\r\n\t\t\tIsDefaultTargetToPlayer and \r\n\t\t\tIsFocusTargetToPlayer and \r\n\t\t\tIsMouseoverTargetToPlayer and \r\n\t\t\tIsTarget and \r\n\t\t\tIsTargetTargetToPlayer and checkedOK;\r\n\t\t\t\r\n\t\t\t\r\n\t\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Rune(data,unit) ---符文函数处理\r\n\t\r\n\tlocal checkedok = false;\r\n\t\r\n\tlocal tbl = data[\"Rune\"][\"RuneCooldown\"];\r\n\tlocal RuneCooldown;\r\n\t\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\t\r\n\t\tcheckedok = true;\r\n\t\tlocal checked = false;\r\n\t\tlocal rune={};\r\n\t\t\r\n\t\tlocal rs = tbl[1];\r\n\t\tlocal cd = amecd(1);\r\n\t\tlocal v1,v2,v3;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[1] = v1 and v2 and v3;\r\n\t\t\r\n\t\t---------------------------------------\r\n\t\t\r\n\t\tlocal rs = tbl[2];\r\n\t\tlocal cd = amecd(2);\r\n\t\tlocal v1,v2,v3;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[2] = v1 and v2 and v3;\r\n\t\t\r\n\t\t-----------------------------------------\r\n\t\t\r\n\t\tlocal rs = tbl[3];\r\n\t\tlocal cd = amecd(3);\r\n\t\tlocal v1,v2,v3;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[3] = v1 and v2 and v3;\r\n\t\t\r\n\t\t\r\n\t\t----------------------------------\r\n\t\t\r\n\t\tlocal rs = tbl[4];\r\n\t\tlocal cd = amecd(4);\r\n\t\tlocal v1,v2,v3;\r\n\t\tif cd < 0 then cd=0;end;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[4] = v1 and v2 and v3;\r\n\t\t\r\n\t\tRuneCooldown = rune[1] and rune[2] and rune[3] and rune[4] and checked;\r\n\t\t\r\n\t\t\r\n\telse\r\n\t\tRuneCooldown = true;\r\n\tend\r\n\t\r\n\tif checkedok and not RuneCooldown then return false;end;\r\n\t\t\r\n\t----------------------------------------------------------\r\n\r\n\tlocal tbl = data[\"Rune\"][\"RuneCount\"];\r\n\tlocal RuneCount;\r\n\t\r\n\t\r\n\tif tbl[\"checked\"] then\r\n\t\t\r\n\t\tcheckedok = true;\r\n\t\tlocal checked = false;\r\n\t\tlocal rune={};\r\n\t\t\r\n\t\tlocal rs = tbl[1];\r\n\t\tlocal cd = amen(1);\r\n\t\tlocal v1,v2,v3;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[1] = v1 and v2 and v3;\r\n\t\t\r\n\t\t---------------------------------------\r\n\t\t\r\n\t\tlocal rs = tbl[2];\r\n\t\tlocal cd = amen(2);\r\n\t\tlocal v1,v2,v3;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[2] = v1 and v2 and v3;\r\n\t\t\r\n\t\t-----------------------------------------\r\n\t\t\r\n\t\tlocal rs = tbl[3];\r\n\t\tlocal cd = amen(3);\r\n\t\tlocal v1,v2,v3;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[3] = v1 and v2 and v3;\r\n\t\t\r\n\t\t\r\n\t\t----------------------------------\r\n\t\t\r\n\t\tlocal rs = tbl[4];\r\n\t\tlocal cd = amen(4);\r\n\t\t\r\n\t\tlocal v1,v2,v3;\r\n\t\tif cd < 0 then cd=0;end;\r\n\t\t\r\n\t\tif rs[\"<\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv1 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\">\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv2 = true;\r\n\t\tend\r\n\t\t\r\n\t\tif rs[\"=\"][\"checked\"] then\r\n\t\t\tchecked = true;\r\n\t\t\tv3 = cd == rs[\"=\"][\"Value\"];\r\n\t\telse\r\n\t\t\tv3 = true;\r\n\t\tend\r\n\t\t\r\n\t\trune[4] = v1 and v2 and v3;\r\n\t\t\r\n\t\tRuneCount = rune[1] and rune[2] and rune[3] and rune[4] and checked;\r\n\t\t\r\n\t\t\r\n\telse\r\n\t\tRuneCount = true;\r\n\tend\r\n\t\r\n\treturn checkedok and RuneCooldown and RuneCount ;\r\n\t\t\r\n\r\n\r\nend\r\n\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_Totem(data,unit) ---图腾函数处理\r\n\r\n\tlocal rs = data[\"Totem\"];\r\n\tlocal v1,v2;\r\n\tlocal checked = false;\r\n\tlocal cd = amtotem(rs[\"name\"]);\r\n\t\r\n\tif rs[\"<\"][\"checked\"] then\r\n\t\tchecked = true;\r\n\t\tv1 = cd <= rs[\"<\"][\"Value\"];\r\n\telse\r\n\t\tv1 = true;\r\n\tend\r\n\t\r\n\tif rs[\">\"][\"checked\"] then\r\n\t\tchecked = true;\r\n\t\tv2 = cd >= rs[\">\"][\"Value\"];\r\n\telse\r\n\t\tv2 = true;\r\n\tend\r\n\r\n\treturn v1 and v2 and checked;\r\n\r\nend\r\n\r\n\r\nfunction amClassToColor(unit) ---图腾函数处理\r\nlocal color,tc;\r\n\t\t\t\t\t\r\n\tlocal playerClass, englishClass = UnitClass(unit)\r\n\tif englishClass then\r\n\t\tcolor = RAID_CLASS_COLORS[englishClass]\r\n\t\ttc = CLASS_BUTTONS[englishClass]\r\n\t\t\r\n\t\treturn color,tc;\r\n\tend\r\n\treturn color,tc;\r\nend\r\n\r\nfunction ST.showruninf(text,unit)\r\n\r\n\t\r\n\tif text and unit then\r\n\t\t\r\n\t\tlocal name = amGetUnitName(unit,true);\r\n\t\tif not name then\r\n\t\t\tname =unit;\r\n\t\tend\r\n\t\t\r\n\t\tST.gospellname=text;\r\n\t\tST.GospellnameButtontext:SetText(ST.gospellname .. \"\\n|cffff0000(|cffffff00\".. amsubgroup(name) .. \"|cffff0000)|r\" .. name .. \" |cffff0000\"..format(\"%.0f\",aml(unit,\"%\"))..\"%\");\r\n\t\t\r\n\t\tif WowStHelperFrame then\r\n\t\t\tWowStHelperFrame.ProjectTitle.Labe2:SetText(ST.gospellname .. \"\\n|cffff0000(|cffffff00\".. amsubgroup(name) .. \"|cffff0000)|r\" .. name .. \" |cffff0000\"..format(\"%.0f\",aml(unit,\"%\"))..\"%\");\r\n\t\tend\r\n\t\t\r\n\t\tlocal Color = amClassToColor(unit);\r\n\t\tif Color then\r\n\t\t\tST.GospellnameButtontext:SetTextColor(Color.r, Color.g, Color.b);\r\n\t\t\tif WowStHelperFrame then\r\n\t\t\t\tWowStHelperFrame.ProjectTitle.Labe2:SetTextColor(Color.r, Color.g, Color.b);\r\n\t\t\tend\r\n\t\tend\r\n\t\tST.gospellnameTime = GetTime();\r\n\tend\r\n\r\nend\r\n\r\nfunction ST.mminimumFast_SpellsRun_ApiDbf(data,unit)\r\n\t\r\n\tlocal ApiDbf,con = ST.Unit_SpellsRun_2_ApiDbf(data,unit);\r\n\t\t\r\n\tif con then\r\n\t\treturn false;\r\n\tend\r\n\t\r\n\tif not ApiDbf then\r\n\t\treturn ApiDbf; \r\n\tend\r\n\t\r\n\t\r\n\t\r\n\t\r\n\treturn ApiDbf ;\r\n\t\r\nend\r\n\r\n\r\nfunction ST.Unit_SpellsRun_2_ApiDbf_Count(data)\r\n\t\r\n\tlocal index=0;\r\n\t\r\n\tfor i, v in pairs(data[\"ApiDbf\"]) do\r\n\t\t\r\n\t\tif v[\"checked\"] then\r\n\t\t\tindex= index+1;\r\n\t\t\t\r\n\t\tend\r\n\tend\r\n\t\r\n\treturn index;\r\nend\r\n\r\nIsLoad_runspell=true;\r\nprint(\"上帝指令加載完畢！\");\r\n\r\n")
RunScript("print('|cffff0000[上帝指令]|r - 連接中...');unitfr=1; function amerr() return 1; end;amUpSpellTbl = am0st;amSpellEmpowerment=amseo;isSuperTreatmentload=true;v_ApiDbfEx=true;v_isok=true;v_nobuff=true;playerrange=true;am_index[3]=100;amIsConnection=true")
RunScript("if IsLoad_runspell then print('|cffff0000[上帝指令]|r - 連接成功！'); else print('|cffff0000[魔獸助手]|r - 插件不正常連接失敗！'); end;")
RunScript("--if GetLocale() ~= \"zhCN\" then return; end\nif amIsClassLoad then  return; end;\nAM_CLASS_NAME[\"WARLOCK\"] = \"术士\" ;\t\nAM_CLASS_NAME[\"WARRIOR\"] = \"战士\" ;\t\nAM_CLASS_NAME[\"HUNTER\"] = \"猎人\" ;\t\nAM_CLASS_NAME[\"MAGE\"] = \"法师\" ;\t\nAM_CLASS_NAME[\"PRIEST\"] = \"牧师\" ;\t\nAM_CLASS_NAME[\"DRUID\"] = \"德鲁伊\" ;\t\nAM_CLASS_NAME[\"PALADIN\"] = \"圣骑士\" ;\t\nAM_CLASS_NAME[\"SHAMAN\"] = \"萨满祭司\" ;\t\nAM_CLASS_NAME[\"ROGUE\"] = \"盗贼\" ;\t\nAM_CLASS_NAME[\"DEATHKNIGHT\"] = \"死亡骑士\" ;\t\nAM_CLASS_NAME[\"MONK\"] = \"武僧\" ;\n\nlocal CLASS_ID={};\nCLASS_ID[\"WARLOCK\"] = 9 ;\t\nCLASS_ID[\"WARRIOR\"] =1;\t\nCLASS_ID[\"HUNTER\"] = 3 ;\t\nCLASS_ID[\"MAGE\"] = 8 ;\t\nCLASS_ID[\"PRIEST\"] = 5 ;\t\nCLASS_ID[\"DRUID\"] = 11 ;\t\nCLASS_ID[\"PALADIN\"] = 2 ;\t\nCLASS_ID[\"SHAMAN\"] = 7;\t\nCLASS_ID[\"ROGUE\"] = 4 ;\t\nCLASS_ID[\"DEATHKNIGHT\"] = 6 ;\t\nCLASS_ID[\"MONK\"] = 10 ;\n\nfunction AMGETCLASSID()\n\tlocal _, englishClass = UnitClass(\"player\")\n\treturn CLASS_ID[englishClass];\nend\n\nam_index[305] = AMGETCLASSID() or -1;\n\namSpellInf={};\n\nfunction amAllClassInf(SpellIds,NoSpellTarget,BuffNames)\n\n\tSpellIds[\"急救\"]=45542;\n\tSpellIds[\"炼金术\"]=80731;\n\tSpellIds[\"药水大师\"]=28675;\n\tSpellIds[\"烹饪\"]=2550;\n\tSpellIds[\"烹饪用火\"]=818;\n\tSpellIds[\"裁缝\"]=75156;\n\t--SpellIds[\"钓鱼\"]=7620\n\tSpellIds[\"珠宝加工\"]=28894;  \n\tSpellIds[\"选矿\"]=31252;  \n\tSpellIds[\"锻造\"]=51300;\n\tSpellIds[\"附魔\"]=7411;\n\tSpellIds[\"分解\"]=13262;\n\tSpellIds[\"地精工程师\"]=20222;  \n\tSpellIds[\"工程学\"]=51306\n\tSpellIds[\"侏儒工程学\"]=20219; \n\tSpellIds[\"剥皮\"]=74522; \n\tSpellIds[\"转化大师\"]=28672\n\tSpellIds[\"考古学\"]=88961;  \n\tSpellIds[\"勘测\"]=80451;\n\t\n\tSpellIds[\"转化大师\"]=28672;  \n\tSpellIds[\"生命之血(等级8)\"]=74497;  \n\tSpellIds[\"采集草药\"]=74519;\n\n\tSpellIds[\"制皮\"]=51302;\n\tSpellIds[\"药剂大师\"]=28677;\n\tSpellIds[\"移动银行(公会福利)\"]=83958;\n\tSpellIds[\"熔炼\"]=2656;\n\t\n\t\n\t--无目标(种族特殊技能内码对应表)\n\tSpellIds[\"石像形态(种族特长)\"] = 20594;\n\tSpellIds[\"狂暴(种族特长)\"] = 26297;\n\tSpellIds[\"奥术洪流(种族特长)\"] = 28730;\n\tSpellIds[\"影遁(种族特长)\"]=58984;\n\tSpellIds[\"纳鲁的赐福(种族特长)\"] = 59545;\n\tSpellIds[\"血性狂怒(种族特长)\"] = \t20572;\n\tSpellIds[\"自利(种族特长)\"]=59752;\n\tSpellIds[\"战争践踏(种族特长)\"]=20549;  \n\t\n\tSpellIds[\"双形态(种族特长)\"]=68996;  \n\tSpellIds[\"狂野奔跑(种族特长)\"]=87840;  \n\tSpellIds[\"疾步夜行(种族特长)\"]=68992;\n\t\n\tSpellIds[\"呼叫大胖(种族特长)\"]=69046;  \n\tSpellIds[\"火箭弹幕(种族特长)\"]=69041;  \n\tSpellIds[\"火箭跳(种族特长)\"]=69070;\n\tSpellIds[\"被遗忘者的意志(种族特长)\"]=7744;\n\tSpellIds[\"食尸(种族特长)\"]=20577; \n\t--SpellIds[\"组团出发\"]=83967;\n\tSpellIds[\"群体复活(公会福利)\"]=83968;\n\t\n\tSpellIds[\"生命之血(等级 5)\"]=55501;\n\t\n\tNoSpellTarget[SpellIds[\"生命之血(等级 5)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"食尸(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"被遗忘者的意志(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"石像形态(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"狂暴(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"奥术洪流(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"影遁(种族特长)\"]]= true;\n\tNoSpellTarget[SpellIds[\"纳鲁的赐福(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"血性狂怒(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"自利(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"战争践踏(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"双形态(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"狂野奔跑(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"疾步夜行(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"呼叫大胖(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"火箭弹幕(种族特长)\"]] =  true;\n\tNoSpellTarget[SpellIds[\"火箭跳(种族特长)\"]] =  true;\n\t\n\t\n\tNoSpellTarget[SpellIds[\"急救\"]] = true;\n\tNoSpellTarget[SpellIds[\"炼金术\"]] = true;\n\tNoSpellTarget[SpellIds[\"药水大师\"]] = true;\n\tNoSpellTarget[SpellIds[\"烹饪\"]] = true;\n\tNoSpellTarget[SpellIds[\"烹饪用火\"]] = true;\n\tNoSpellTarget[SpellIds[\"裁缝\"]] = true;\n\t--NoSpellTarget[SpellIds[\"钓鱼\"]] = true;\n\tNoSpellTarget[SpellIds[\"附魔\"]] = true;\n\tNoSpellTarget[SpellIds[\"分解\"]] = true;\n\t\n\tNoSpellTarget[SpellIds[\"地精工程师\"]] = true;\n\tNoSpellTarget[SpellIds[\"工程学\"]] = true;\n\tNoSpellTarget[SpellIds[\"侏儒工程学\"]] = true;\n\t\n\tNoSpellTarget[SpellIds[\"剥皮\"]] = true;\n\tNoSpellTarget[SpellIds[\"转化大师\"]] = true;\n\t\n\tNoSpellTarget[SpellIds[\"考古学\"]] = true;\n\tNoSpellTarget[SpellIds[\"勘测\"]] = true;\n\t\n\tNoSpellTarget[SpellIds[\"转化大师\"]] = true;\n\tNoSpellTarget[SpellIds[\"生命之血(等级8)\"]] = true;\n\tNoSpellTarget[SpellIds[\"采集草药\"]] = true;\n\tNoSpellTarget[SpellIds[\"制皮\"]] = true;\n\t\n\tNoSpellTarget[SpellIds[\"药剂大师\"]] = true;\n\tNoSpellTarget[SpellIds[\"移动银行(公会福利)\"]] = true;\n\tNoSpellTarget[SpellIds[\"熔炼\"]] = true;\n\t--NoSpellTarget[SpellIds[\"组团出发\"]] = true;\n\tNoSpellTarget[SpellIds[\"群体复活(公会福利)\"]] = true;\n\tamSpellIds,amNoSpellTarget,amBuffNames = SpellIds,NoSpellTarget,BuffNames;\n\t\n\t\t\nend\n\n\nlocal IgnoreSpellIds = {};\nIgnoreSpellIds[\"急救\"]=45542;\nIgnoreSpellIds[\"炼金术\"]=80731;\nIgnoreSpellIds[\"药水大师\"]=28675;\nIgnoreSpellIds[\"烹饪\"]=2550;\nIgnoreSpellIds[\"烹饪用火\"]=818;\nIgnoreSpellIds[\"裁缝\"]=75156;\n--IgnoreSpellIds[\"钓鱼\"]=7620\nIgnoreSpellIds[\"珠宝加工\"]=28894;  \nIgnoreSpellIds[\"选矿\"]=31252;  \nIgnoreSpellIds[\"锻造\"]=51300;\nIgnoreSpellIds[\"附魔\"]=7411;\nIgnoreSpellIds[\"分解\"]=13262;\n\nIgnoreSpellIds[\"地精工程师\"]=20222;  \nIgnoreSpellIds[\"工程学\"]=51306\nIgnoreSpellIds[\"侏儒工程学\"]=20219; \n\nIgnoreSpellIds[\"石像形态(种族特长)\"] = 20594;\nIgnoreSpellIds[\"狂暴(种族特长)\"] = 26297;\nIgnoreSpellIds[\"奥术洪流(种族特长)\"] = 28730;\nIgnoreSpellIds[\"影遁(种族特长)\"]=58984;\nIgnoreSpellIds[\"纳鲁的赐福(种族特长)\"] = 59545;\nIgnoreSpellIds[\"血性狂怒(种族特长)\"] = \t20572;\nIgnoreSpellIds[\"自利(种族特长)\"]=59752;\nIgnoreSpellIds[\"战争践踏(种族特长)\"]=20549;  \n\nIgnoreSpellIds[\"双形态(种族特长)\"]=68996;  \nIgnoreSpellIds[\"狂野奔跑(种族特长)\"]=87840;  \nIgnoreSpellIds[\"疾步夜行(种族特长)\"]=68992;\n\t\nIgnoreSpellIds[\"剥皮\"]=74522;  \nIgnoreSpellIds[\"转化大师\"]=28672\n\nIgnoreSpellIds[\"呼叫大胖(种族特长)\"]=69046;  \nIgnoreSpellIds[\"火箭弹幕(种族特长)\"]=69041;  \nIgnoreSpellIds[\"火箭跳(种族特长)\"]=69070; \n  \nIgnoreSpellIds[\"考古学\"]=88961;  \nIgnoreSpellIds[\"勘测\"]=80451;\n\nIgnoreSpellIds[\"转化大师\"]=28672;  \nIgnoreSpellIds[\"生命之血(等级8)\"]=74497;  \nIgnoreSpellIds[\"采集草药\"]=74519;\nIgnoreSpellIds[\"制皮\"]=51302;\n\nIgnoreSpellIds[\"药剂大师\"]=28677;\nIgnoreSpellIds[\"移动银行(公会福利)\"]=83958;\nIgnoreSpellIds[\"熔炼\"]=2656;\n--IgnoreSpellIds[\"组团出发\"]=83967;\nIgnoreSpellIds[\"群体复活(公会福利)\"]=83968;\n\n\n\n\nfunction amAllClassIgnoreInf(name,inf)\n\t\n\t\n\t\n\tif IgnoreSpellIds[name] and inf == \"ID错误\"  or IgnoreSpellIds[name] and not inf then\n\t\n\t\treturn false;\n\telse\n\t\n\t\treturn true;\n\tend\n\t\t\n\nend\n\nfunction amTestSpellBook(SpellIds)\n\t\n\tlocal i = 1;\n\tlocal tbl={};\n\t\n\twhile true do\n\t\n\t\t--skillType, spellId = GetSpellBookItemInfo(i, \"player\")\n\t\t\n\t\tlocal func = assert(loadstring(\"GetSpellBookItemInfo(\" .. i ..\", 'player')\"));\n\t\tskillType, spellId= func();\n\t\t\n\t\t--print(skillType, spellId,i)\n\t\t\n\n\t\tif not spellId or not skillType then\n\t\t  do break end\n\t\tend\n\t\t\n\t\tlocal spellName, spellSubName =GetSpellInfo(spellId);\n\t\t\n\t\tif spellName then\n\t\t\n\t\t\tif not spellSubName then\n\t\t\t\tspellSubName=\"\";\n\t\t\tend\n\t\t\t\n\t\t\tlocal s ;\n\t\t\t\n\t\t\tif spellSubName == \"\" then\n\t\t\t\ts=spellName;\n\t\t\telse\n\t\t\t\ts = spellName .. \"(\" .. spellSubName ..\")\";\n\t\t\tend\n\t\t\t\n\t\t\t\n\t\t\tif not IsPassiveSpell(i,BOOKTYPE_SPELL) and not SpellIds[s] then\n\t\t\t\t\n\t\t\t\tif amAllClassIgnoreInf(spellName) then\n\t\t\t\t\n\t\t\t\t\ttable.insert(tbl, spellId);\n\t\t\t\tend\n\t\t\tend\n\t\tend\n\t\t\n\t\ti = i + 1\n   end\n   \n   return tbl;\n\nend\n\n\n\nlocal N_97128 = GetSpellInfo(97128); --熔火之羽\nfunction amIsMoveSpellAll(Id,unit,name) --处理移动中能施放的技能\n\n\n\tif UnitAura(\"player\", N_97128) then \n\t\t\n\t\treturn true;\n\t\t\n\t\n\tend\n\t\nend\n\n\n\n")

end

local function LoadClassSpecifitScript()
RunScript("--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"DEATHKNIGHT\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\nlocal Shapeshift={}; --姿态名称ID对照\r\nlocal spellSubNameErrText={}; -- 错误技能信息\r\nlocal ShapeshiftName = nil; --姿态本地名称\r\n\r\n\r\n\r\n\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\n\r\n--冰天赋\r\n\r\nSpellIds[\"冰封之韧\"] =     48792;\r\nSpellIds[\"冰霜之路\"] =     3714;\r\nSpellIds[\"冰霜之柱\"] =     51271;\r\nSpellIds[\"冰霜灵气\"] =     48266;\r\nSpellIds[\"寒冬号角\"] =     57330;\r\n--SpellIds[\"饥饿之寒\"] =     49203;\r\nSpellIds[\"巫妖之躯\"] =     49039;\r\nSpellIds[\"符文武器增效\"] =     47568;\r\n\r\n--血天赋\r\nSpellIds[\"天灾契约\"] =     48743;\r\nSpellIds[\"血液沸腾\"] =     48721;\r\nSpellIds[\"符文刃舞\"] =     49028;\r\nSpellIds[\"符文分流\"] =     48982;\r\nSpellIds[\"凛风冲击\"] =     55233;\r\nSpellIds[\"鲜血灵气\"] =     48263;\r\nSpellIds[\"白骨之盾\"] =     49222;\r\nSpellIds[\"活力分流\"] =     45529;\r\nSpellIds[\"吸血鬼之血\"]=55233;\r\n\r\n--邪天赋\r\nSpellIds[\"亡者大军\"] =     42650;\r\nSpellIds[\"反魔法领域\"] =     51052;\r\nSpellIds[\"反魔法护罩\"] =     48707;\r\nSpellIds[\"召唤石像鬼\"] =     49206;\r\nSpellIds[\"黑锋之门\"] =     50977;\r\nSpellIds[\"枯萎凋零\"] =     43265;\r\nSpellIds[\"亡者复生\"] =     46584;\r\nSpellIds[\"复活盟友\"] =     61999;\r\nSpellIds[\"邪恶灵气\"] =     48265;\r\nSpellIds[\"黑暗突变\"] =     63560;\r\n\r\nSpellIds[\"符文熔铸\"]=53428;  \r\nSpellIds[\"自动攻击\"]=6603;  \r\nSpellIds[\"爆发\"]=77575;  \r\nSpellIds[\"黑暗模拟\"]=77606;  \r\n\r\n\r\nAM_GCD_SPELLID=SpellIds[\"冰霜灵气\"];\r\n\r\n\r\n--需激活技能\r\nSpellIds[\"符文打击\"] =     56815;\r\n--当自身闪躲招架后技能条图标变亮 需目标\r\n\r\nSpellIds[\"暗影灌注\"] =     45772;\r\nBuffName[\"暗影灌注\"]= GetSpellInfo(SpellIds[\"暗影灌注\"]);\r\nBuffName[\"鲜血灵气\"]= GetSpellInfo(SpellIds[\"鲜血灵气\"]);\r\n--需玩家宠物身上buff 层数 \"暗影灌注\" =5 后技能条图标变亮 无需目标\r\n\r\n\r\n--需要目标的技能\r\nSpellIds[\"灵界打击\"] =         49998; \r\nSpellIds[\"传染\"] =         50842;\r\nSpellIds[\"心脏打击\"] =         55050;  \r\nSpellIds[\"符文刃舞\"] =         49028;\r\nSpellIds[\"绞袭\"] =         47476;\r\nSpellIds[\"鲜血打击\"] =         45902;\r\nSpellIds[\"黑暗命令\"] =         56222;\r\nSpellIds[\"冰冷触摸\"] =         45477;         \r\nSpellIds[\"寒冰锁链\"] =         45524;\r\nSpellIds[\"心灵冰冻\"] =         47528;\r\nSpellIds[\"湮没\"] =         49020;\r\nSpellIds[\"符文打击\"] =         56815;\r\nSpellIds[\"脓疮打击\"] =         85948;\r\nSpellIds[\"死亡之握\"] =         49576;\r\nSpellIds[\"凋零缠绕\"] =         47541;\r\nSpellIds[\"暗影打击\"] =         45462;\r\nSpellIds[\"天灾打击\"] = 55090;\r\nSpellIds[\"死疽打击\"] = 73975;\r\nSpellIds[\"冰霜打击\"] =         49143;\r\nSpellIds[\"凛风冲击\"] =         49184;\r\n\r\n\r\n\r\nNoSpellTarget[SpellIds[\"黑暗突变\"]] =     true;\r\n\r\nNoSpellTarget[SpellIds[\"冰封之韧\"]] =     true;\r\nNoSpellTarget[SpellIds[\"冰霜之路\"]] =     true;\r\nNoSpellTarget[SpellIds[\"冰霜之柱\"]] =     true;\r\nNoSpellTarget[SpellIds[\"冰霜灵气\"]] =     true;\r\nNoSpellTarget[SpellIds[\"寒冬号角\"]] =     true;\r\n--NoSpellTarget[SpellIds[\"饥饿之寒\"]] =     true;\r\nNoSpellTarget[SpellIds[\"巫妖之躯\"]] =     true;\r\nNoSpellTarget[SpellIds[\"符文武器增效\"]] =     true;\r\n\r\n--血天赋\r\nNoSpellTarget[SpellIds[\"天灾契约\"]] =     true;\r\nNoSpellTarget[SpellIds[\"血液沸腾\"]] =     true;\r\nNoSpellTarget[SpellIds[\"符文分流\"]] =     true;\r\nNoSpellTarget[SpellIds[\"凛风冲击\"]] =     true;\r\nNoSpellTarget[SpellIds[\"鲜血灵气\"]] =     true;\r\nNoSpellTarget[SpellIds[\"白骨之盾\"]] =     true;\r\nNoSpellTarget[SpellIds[\"活力分流\"]] =     true;\r\nNoSpellTarget[SpellIds[\"吸血鬼之血\"]] =     true;\r\n\r\n--邪天赋\r\nNoSpellTarget[SpellIds[\"亡者大军\"]] =     true;\r\nNoSpellTarget[SpellIds[\"反魔法领域\"]] =     true;\r\nNoSpellTarget[SpellIds[\"反魔法护罩\"]] =     true;\r\nNoSpellTarget[SpellIds[\"召唤石像鬼\"]] =     true;\r\nNoSpellTarget[SpellIds[\"黑锋之门\"]] =     true;\r\nNoSpellTarget[SpellIds[\"枯萎凋零\"]] =     true;\r\nNoSpellTarget[SpellIds[\"亡者复生\"]] =     true;\r\nNoSpellTarget[SpellIds[\"复活盟友\"]] =     true;\r\nNoSpellTarget[SpellIds[\"邪恶灵气\"]] =     true;\r\nNoSpellTarget[SpellIds[\"黑暗突变\"]] =     true;\r\n\r\nNoSpellTarget[SpellIds[\"黑暗模拟\"]] =     true;\r\nNoSpellTarget[SpellIds[\"符文熔铸\"]] =     true;\r\n\r\n\r\n\r\namAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n\r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\t\r\n\t\tif menu then\r\n\t\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\t\"text5\", E,\r\n\t\t\t\t\"tooltipText\",str\r\n\t\t\t)\r\n\t\t\t\r\n\t\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\t\r\n\t\telse\r\n\t\t\r\n\t\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\tif tostring(B) ~= tostring(D) then\r\n\t\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\tend\r\n\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\t\r\n\t\tend\r\n\t\r\n\t\r\nend\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\t\r\n\treturn NoSpellTarget[SpellId] and true;\r\nend\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId];\r\n\t\r\nend\r\n\r\n\r\n\r\nfunction amGetDkInfectionTargetInf()\r\n\t\r\n\tlocal v =0;\r\n\tlocal n = 0;\r\n\tlocal SWING = 0;\r\n\tlocal SWING1 = 0;\r\n\tlocal PeriodicTime;\r\n\t\r\n\tfor i, data in pairs(wowam.DkInfectionTbl[\"buff\"]) do\r\n\t\t\r\n\t\tif data[\"time\"] then\r\n\t\t\t\t\t\r\n\t\t\tv = v +1;\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif data[\"Attack\"] and (data[\"Attack\"]==\"SWING\" or data[\"Attack\"]==\"<=15\") then\r\n\t\t\tSWING= SWING +1;\r\n\t\tend\r\n\t\t\r\n\t\tif data[\"time\"] and (data[\"Attack\"]==\"SWING\" or data[\"Attack\"]==\"<=15\") then\r\n\t\t\tSWING1= SWING1 +1;\r\n\t\tend\r\n\t\t\r\n\t\tif data[\"PeriodicTime\"] then\r\n\t\t\t\r\n\t\t\tlocal a = 21 - (GetTime() - data[\"PeriodicTime\"])\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif not PeriodicTime then\r\n\t\t\t\r\n\t\t\t\tPeriodicTime = a;\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\r\n\t\t\t\tif a < PeriodicTime then\r\n\t\t\t\t\r\n\t\t\t\t\tPeriodicTime = a;\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tn= n +1;\r\n\tend\r\n\t\r\n\tif not PeriodicTime then\r\n\t\tPeriodicTime=0;\r\n\tend\r\n\t\t\r\n\t\tPeriodicTime = tonumber(format(\"%.2f\", PeriodicTime));\r\n\t\r\n\treturn n,v,n-v,SWING,SWING1,SWING-SWING1,PeriodicTime;\r\n\t\r\n\r\nend\r\n\r\nwowam.DkInfectionTbl={};\r\nwowam.DkInfectionTbl[\"buff\"]={};\r\nwowam.DkInfectionTbl[\"血之疫病\"]=55078;\r\nwowam.DkInfectionTbl[\"血红热疫\"]=81130;\r\nwowam.DkInfectionTbl[\"冰霜疫病\"]=55095;\r\nwowam.DkInfectionTbl[\"血液沸腾\"]=48721;\r\nwowam.DkInfectionTbl[\"枯萎凋零\"]=52212;\r\n\r\nwowam.DkInfectionTbl[\"time\"]=GetTime();\r\n\r\nam_DK_UNIT_COMBAT_Frame = CreateFrame(\"Frame\");\r\nam_DK_UNIT_COMBAT_Frame:RegisterEvent(\"COMBAT_LOG_EVENT_UNFILTERED\");\r\nam_DK_UNIT_COMBAT_Frame:RegisterEvent(\"PARTY_MEMBERS_CHANGED\");\r\nam_DK_UNIT_COMBAT_Frame:RegisterEvent(\"RAID_ROSTER_UPDATE\");\r\n\r\nlocal DK_UnitGuids={};\r\n\r\n \r\nlocal AffectingCombat = 0;\r\n\r\nlocal function DecompositionEvent(v)\r\n\r\n\treturn {strsplit(\"_\",v)};\r\n\t\r\nend\r\n\r\nlocal function am_DK_UNIT_COMBAT_Frame_OnUpdate()\r\n\t\r\n\tif not DK_UnitGuids[UnitGUID(\"player\")] then\r\n\t\t\r\n\t\t DK_UnitGuids[UnitGUID(\"player\")]=\"player\";\r\n\tend\r\n\t \r\n\tif GetTime() - wowam.DkInfectionTbl[\"time\"] > 0.1 then\r\n\t\t\r\n\t\t\r\n\t\t \r\n\t\twowam.DkInfectionTbl[\"time\"]=GetTime();\r\n\t\t\r\n\t\tif UnitAffectingCombat(\"player\") and AffectingCombat == 0 then\r\n\t\t\tAffectingCombat=1;\r\n\t\tend\r\n\t\t\r\n\t\tif AffectingCombat == 1 and (not UnitAffectingCombat(\"player\") or  UnitIsCorpse(\"player\") or UnitIsDeadOrGhost(\"player\")) then\r\n\t\t\t\r\n\t\t\tif not UnitAffectingCombat(\"player\") then\r\n\t\t\t\tAffectingCombat =0;\r\n\t\t\tend\r\n\t\t\twowam.DkInfectionTbl[\"buff\"]={};\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\tfor i, v in pairs(wowam.DkInfectionTbl[\"buff\"]) do\r\n\t\t\r\n\t\t\tif (v[\"time\"] and GetTime() - v[\"time\"] > 4) or (v[\"AttackTime\"] and GetTime() - v[\"AttackTime\"] > 4) then\r\n\t\t\t\t\r\n\t\t\t\twowam.DkInfectionTbl[\"buff\"][i]=nil;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\r\n\tend\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\nlocal function am_DK_UNIT_COMBAT_Frame_OnEvent(self, event, ...)\r\n\t\r\n\tlocal arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10,arg11,arg12,arg13,arg14,arg15,arg16;\r\n\r\n\t\r\n\t\t\r\n\targ1,arg2 = select(1, ...);\r\n\targ3,arg4,arg5,_,arg6,arg7,arg8,_,arg9,arg10,arg11,arg12,arg13,arg14,arg15,arg16 = select(4, ...);\r\n\t\t\r\n\t\r\n\t\r\n\t\r\n\tlocal PlayGuid = UnitGUID(\"player\");\t\r\n\t\r\n\r\n\tif ( event == \"PARTY_MEMBERS_CHANGED\" or event == \"RAID_ROSTER_UPDATE\" )  then\r\n\t\r\n\t\tlocal r = GetNumGroupMembers();\r\n\t\tlocal p = GetNumSubgroupMembers();\r\n\t\t\r\n\t\tDK_UnitGuids={};\r\n\t\t\r\n\t\tif r>0 then\r\n\t\t\r\n\t\t\tfor i=1 , r do\r\n\t\t\t\t\r\n\t\t\t\tlocal u =\"raid\" .. tostring(i);\r\n\t\t\t\tlocal Guid = UnitGUID(u);\r\n\t\t\t\t\r\n\t\t\t\tif Guid then\r\n\t\t\t\t\t\r\n\t\t\t\t\tDK_UnitGuids[Guid]=u;\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\telseif p > 0 then\r\n\t\t\r\n\t\t\t\r\n\t\t\tfor i=1 , p do\r\n\t\t\t\t\r\n\t\t\t\tlocal u =\"party\" .. tostring(i);\r\n\t\t\t\tlocal Guid = UnitGUID(u);\r\n\t\t\t\t\r\n\t\t\t\tif Guid then\r\n\t\t\t\t\t\r\n\t\t\t\t\tDK_UnitGuids[Guid]=u;\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\t\r\n\t\telse\r\n\t\t\r\n\t\t\tDK_UnitGuids[PlayGuid]=\"player\";\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\telseif ( event == \"COMBAT_LOG_EVENT_UNFILTERED\" and arg2 )  then\r\n\t\t\r\n\t\t\r\n\t\tlocal V = DecompositionEvent(arg2);\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif PlayGuid == arg6 and (V[2] == \"DAMAGE\" or V[2] == \"MISSED\" or V[3] == \"DAMAGE\" or V[3] == \"MISSED\") then\r\n\t\t\r\n\t\t\tif not wowam.DkInfectionTbl[\"buff\"][arg3] then\r\n\t\t\t\r\n\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg3]={};\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\twowam.DkInfectionTbl[\"buff\"][arg3][\"Attack\"]=V[1];\r\n\t\t\twowam.DkInfectionTbl[\"buff\"][arg3][\"AttackTime\"] = GetTime();\r\n\t\t\t\r\n\t\t\r\n\t\telseif arg3 and arg6 and (V[2] == \"DAMAGE\" or V[2] == \"MISSED\" or V[3] == \"DAMAGE\" or V[3] == \"MISSED\") then\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif DK_UnitGuids[arg3] or DK_UnitGuids[arg6] then\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tlocal u,id;\r\n\t\t\t\t\r\n\t\t\t\tif DK_UnitGuids[arg3] then\r\n\t\t\t\t\r\n\t\t\t\t\tu = DK_UnitGuids[arg3];\r\n\t\t\t\t\tid = arg6;\r\n\t\t\t\t\t\r\n\t\t\t\telseif DK_UnitGuids[arg6] then\r\n\t\t\t\t\r\n\t\t\t\t\tu = DK_UnitGuids[arg6];\r\n\t\t\t\t\tid = arg3;\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif V[1] == \"SWING\" and amjl(u)<=15 then\r\n\t\t\t\t\r\n\t\t\t\t\tif not wowam.DkInfectionTbl[\"buff\"][id] then\r\n\t\t\t\t\r\n\t\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][id]={};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][id][\"Attack\"]=V[1];\r\n\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][id][\"AttackTime\"] = GetTime();\r\n\t\t\t\t\t\r\n\t\t\t\t\t--print(\"<<\",arg2,arg4,arg7,GetSpellInfo(arg9),arg9)\r\n\t\t\t\t\t\r\n\t\t\t\t\t--print(amGetDkInfectionTargetInf())\r\n\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\tif PlayGuid == arg3 and arg6 and arg9 then\r\n\t\t\t\r\n\t\t\t\t\tif wowam.DkInfectionTbl[\"血液沸腾\"] == arg9 or \r\n\t\t\t\t\twowam.DkInfectionTbl[\"枯萎凋零\"] == arg9 then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif not wowam.DkInfectionTbl[\"buff\"][arg6] then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6]={};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6][\"Attack\"]=\"<=15\";\r\n\t\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6][\"AttackTime\"] = GetTime();\r\n\t\t\t\t\t\t--print(\">>\",arg2,arg4,arg7,GetSpellInfo(arg9),arg9)\r\n\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\tif arg2 == \"SPELL_PERIODIC_DAMAGE\" or arg2 == \"SPELL_AURA_APPLIED\" \r\n\t\t or arg2 == \"SPELL_AURA_APPLIED_DOSE\"  or arg2 == \"SPELL_AURA_REMOVED_DOSE\" \r\n\t\t or arg2 == \"SPELL_AURA_REFRESH\" then\r\n\t\t\t\r\n\t\t\t\t\t\r\n\t\t\tif PlayGuid == arg3 and arg6 and arg9 then\r\n\t\t\t\r\n\t\t\t\tif wowam.DkInfectionTbl[\"血之疫病\"] == arg9 or \r\n\t\t\t\twowam.DkInfectionTbl[\"血红热疫\"] == arg9 or \r\n\t\t\t\twowam.DkInfectionTbl[\"冰霜疫病\"] == arg9 then\r\n\t\t\t\t\r\n\t\t\t\t\tif not wowam.DkInfectionTbl[\"buff\"][arg6] then\r\n\t\t\t\r\n\t\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6]={};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6][\"time\"] = GetTime();\r\n\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6][\"AttackTime\"] = GetTime();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif arg2 == \"SPELL_AURA_APPLIED\" or arg2 == \"SPELL_AURA_REFRESH\" then\r\n\t\t\t\t\t\r\n\t\t\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6][\"PeriodicTime\"] = GetTime();\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tend\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t--print(\"<<\",arg2,arg4,arg7,GetSpellInfo(arg9))\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\r\n\t\telseif (PlayGuid == arg3 and arg2 == \"SPELL_AURA_REMOVED\") then\r\n\t\t\t\r\n\t\t\tif wowam.DkInfectionTbl[\"血之疫病\"] == arg9 or \r\n\t\t\t\twowam.DkInfectionTbl[\"血红热疫\"] == arg9 or \r\n\t\t\t\twowam.DkInfectionTbl[\"冰霜疫病\"] == arg9 then\r\n\t\t\t\r\n\t\t\t\twowam.DkInfectionTbl[\"buff\"][arg6]=nil;\r\n\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif arg2 == \"PARTY_KILL\" or arg2 == \"UNIT_DIED\" then\r\n\t\t\r\n\t\t\t\r\n\t\t\twowam.DkInfectionTbl[\"buff\"][arg6]=nil;\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\t--print(\"1>>\",event,arg1,arg2,arg3,arg4)\r\n\t\t\r\n\t\t\r\n\tend\r\n\t\r\nend\r\n\r\n\r\nam_DK_UNIT_COMBAT_Frame:SetScript(\"OnEvent\", am_DK_UNIT_COMBAT_Frame_OnEvent);\r\nam_DK_UNIT_COMBAT_Frame:SetScript(\"OnUpdate\",am_DK_UNIT_COMBAT_Frame_OnUpdate)\r\n\r\namIsClassLoad = true;\r\n\r\n--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"DRUID\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\n\r\n\r\n\r\nlocal spellinf = wowam.spell.Info;\t--技能信息\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\n\r\n\r\n--SpellIds[\"强化野性冲锋(等级 1)\"]=81017;\r\n\r\nSpellIds[\"迅捷治愈\"] = 18562;\r\nSpellIds[\"愈合\"] = 8936;\r\nSpellIds[\"回春术\"] = 774;\r\n\r\n\r\nSpellIds[\"化身：生命之树(变形)\"] = \t33891;\r\nSpellIds[\"星辰坠落\"] =      48505;\r\nSpellIds[\"枭兽形态\"] =    24858;\r\nSpellIds[\"树皮术\"] =   22812;\r\n--SpellIds[\"台风\"] =        50516;\r\nSpellIds[\"自然之握\"] =       16689;\r\nSpellIds[\"激怒\"] =        5229;\r\nSpellIds[\"狂暴回复\"] =        22842;\r\n--SpellIds[\"挑战咆哮\"] =        5209;\r\nSpellIds[\"惊魂咆哮\"] =   99;\r\nSpellIds[\"旅行形态(变形)\"] =        783;\r\nSpellIds[\"水栖形态(变形)\"] =        1066;\r\nSpellIds[\"熊形态(变形)\"] =   5487;\r\nSpellIds[\"猎豹形态(变形)\"] =      768;\r\nSpellIds[\"潜行\"] =     5215;\r\nSpellIds[\"猛虎之怒\"] =      5217;\r\nSpellIds[\"急奔\"] =      1850;\r\nSpellIds[\"飞行形态(变形)\"] = 33943;\r\nSpellIds[\"野蛮咆哮\"] =       52610;  --(无需目标但需要连击点数)\r\n--SpellIds[\"狂暴\"] =       50334;\r\nSpellIds[\"狂暴\"] =       106952;\r\nSpellIds[\"生存本能\"] =    61336;\r\n--SpellIds[\"自然迅捷\"] =  17116; \r\n \r\n\r\n--SpellIds[\"横扫\"] = \t779;\r\n--SpellIds[\"横扫\"] = \t62078;\r\nSpellIds[\"横扫\"] = \t106785;\r\n--SpellIds[\"野性冲锋\"] = \t49376;\r\n--SpellIds[\"野性冲锋\"] = \t16979;\r\n--SpellIds[\"野性冲锋\"] = \t106952;\r\nSpellIds[\"野性冲锋\"] = \t102401;\r\n--SpellIds[\"痛击\"] = \t77758;\r\nSpellIds[\"痛击\"] = \t106832;\r\nSpellIds[\"狂奔怒吼\"] = \t106898;\r\n--SpellIds[\"狂奔怒吼\"] = \t77761;\r\n\r\nSpellIds[\"野性蘑菇\"] =  88747;\r\nSpellIds[\"野性蘑菇：引爆\"] =  88751;\r\n\r\nSpellIds[\"野性成长\"] = \t48438;\r\n--SpellIds[\"自然迅捷\"] = \t17116;\r\nSpellIds[\"宁静\"] = \t740;\r\nSpellIds[\"迅捷飞行形态(变形)\"] = \t40120;\r\nSpellIds[\"飓风\"] = \t16914;\r\nSpellIds[\"日光术\"] = \t78675;\r\nSpellIds[\"自然之力\"] = \t33831;\r\n\r\nSpellIds[\"毁灭\"] = 6785;\r\n\r\n--SpellIds[\"裂伤\"]=33876;  \r\n--SpellIds[\"裂伤\"]=33878;  \r\nSpellIds[\"裂伤\"]=33917; \r\n\r\n-------------CTM-------\r\n\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"愤怒\"]=5176;\r\nSpellIds[\"月火术\"]=8921;\r\n--SpellIds[\"荆棘术\"]=467;\r\nSpellIds[\"纠缠根须\"]=339;\r\nSpellIds[\"星火术\"]=2912;\r\nSpellIds[\"传送：月光林地\"]=18960;\r\nSpellIds[\"虫群\"]=5570;\r\nSpellIds[\"精灵之火\"]=770;\r\nSpellIds[\"安抚\"]=2908;\r\nSpellIds[\"激活\"]=29166;\r\nSpellIds[\"休眠\"]=2637;\r\nSpellIds[\"旋风\"]=33786;\r\nSpellIds[\"滋养\"]=50464;\r\nSpellIds[\"起死回生\"]=50769;\r\nSpellIds[\"复生\"]=20484;\r\nSpellIds[\"净化腐蚀\"]=2782;\r\nSpellIds[\"野性印记\"]=1126;\r\nSpellIds[\"生命绽放\"]=33763;\r\nSpellIds[\"治疗之触\"]=5185;\r\nSpellIds[\"凶猛撕咬\"]=22568;\r\nSpellIds[\"斜掠\"]=1822;\r\n--SpellIds[\"爪击\"]=1082;\r\nSpellIds[\"低吼\"]=6795;\r\nSpellIds[\"重殴\"]=6807;\r\nSpellIds[\"迎头痛击\"]=106839;\r\n--SpellIds[\"迎头痛击\"]=80965;\r\n--SpellIds[\"精灵之火（野性）(野性)\"]=16857;\r\n--SpellIds[\"畏缩\"]=8998;\r\nSpellIds[\"蛮力猛击\"]=5211;\r\nSpellIds[\"突袭\"]=9005;\r\nSpellIds[\"撕碎\"]=5221;\r\nSpellIds[\"割裂\"]=1079;\r\nSpellIds[\"割碎\"]=22570;\r\nSpellIds[\"割伤\"]=33745;\r\n--SpellIds[\"粉碎\"]=80313;\r\n\r\nSpellIds[\"化身\"]=106731;\r\nSpellIds[\"化身：丛林之王\"]=102543;\r\n\r\n-----------\r\nAM_GCD_SPELLID=SpellIds[\"愤怒\"];\r\n\r\nNoSpellTarget[SpellIds[\"星辰坠落\"]] =      true;\r\nNoSpellTarget[SpellIds[\"枭兽形态\"]] =    true;\r\nNoSpellTarget[SpellIds[\"树皮术\"]] =   true;\r\n--NoSpellTarget[SpellIds[\"台风\"]] =        true;\r\nNoSpellTarget[SpellIds[\"自然之握\"]] =       true;\r\nNoSpellTarget[SpellIds[\"激怒\"]] =        true;\r\nNoSpellTarget[SpellIds[\"狂暴回复\"]] =        true;\r\n--NoSpellTarget[SpellIds[\"挑战咆哮\"]] =        true;\r\nNoSpellTarget[SpellIds[\"惊魂咆哮\"]] =   true;\r\nNoSpellTarget[SpellIds[\"旅行形态(变形)\"]] =        true;\r\nNoSpellTarget[SpellIds[\"水栖形态(变形)\"]] =        true;\r\nNoSpellTarget[SpellIds[\"熊形态(变形)\"]] =   true;\r\nNoSpellTarget[SpellIds[\"猎豹形态(变形)\"]] =      true;\r\nNoSpellTarget[SpellIds[\"潜行\"]] =     true;\r\nNoSpellTarget[SpellIds[\"猛虎之怒\"]] =      true;\r\nNoSpellTarget[SpellIds[\"急奔\"]] =      true;\r\nNoSpellTarget[SpellIds[\"飞行形态(变形)\"]] = true;\r\nNoSpellTarget[SpellIds[\"野蛮咆哮\"]] =       true;  --(无需目标但需要连击点数)\r\nNoSpellTarget[SpellIds[\"狂暴\"]] =       true;\r\nNoSpellTarget[SpellIds[\"生存本能\"]] =    true;\r\n--NoSpellTarget[SpellIds[\"自然迅捷\"]] =  true; \r\n\r\n\r\nNoSpellTarget[SpellIds[\"横扫\"]] =         true;\r\nNoSpellTarget[SpellIds[\"横扫\"]] =         true;\r\n\r\nNoSpellTarget[SpellIds[\"痛击\"]] =         true;\r\n--NoSpellTarget[SpellIds[\"狂奔怒吼\"]] =         true;\r\n--NoSpellTarget[SpellIds[\"狂奔怒吼\"]] =         true;\r\n\r\nNoSpellTarget[SpellIds[\"野性蘑菇\"]] =  true;\r\nNoSpellTarget[SpellIds[\"野性蘑菇：引爆\"]] =  true;\r\nNoSpellTarget[SpellIds[\"化身：生命之树(变形)\"]] =  true;\r\n\r\n\r\nNoSpellTarget[SpellIds[\"野性成长\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"自然迅捷\"]] =  true;\r\nNoSpellTarget[SpellIds[\"宁静\"]] =  true;\r\nNoSpellTarget[SpellIds[\"迅捷飞行形态(变形)\"]] =  true;\r\nNoSpellTarget[SpellIds[\"飓风\"]] =  true;\r\n\r\nNoSpellTarget[SpellIds[\"日光术\"]] =  true;\r\nNoSpellTarget[SpellIds[\"自然之力\"]] =  true;\r\n\r\n----------CTM---\r\n\r\nNoSpellTarget[SpellIds[\"传送：月光林地\"]] =  true;\r\n\r\n\r\nNoSpellTarget[SpellIds[\"化身：丛林之王\"]] =  true;\r\nNoSpellTarget[SpellIds[\"化身\"]] =  true;\r\n----------\r\n\r\n\r\n--BuffName[\"强化野性冲锋(等级 1)\"]=GetSpellInfo(SpellIds[\"强化野性冲锋(等级 1)\"]);\r\n\r\namAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\tif tostring(B) ~= tostring(D) then\r\n\t\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\tend\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\nfunction amIsActivation(Id,unit,name) --处理被激活技能\r\n\r\n\tif Id == SpellIds[\"迅捷治愈\"] then \r\n\t\t\r\n\t\treturn amIsActivation_18562(Id,unit,name);\r\n\t\r\n\telseif Id == SpellIds[\"野蛮咆哮\"] then\r\n\t\r\n\t\t\r\n\t\treturn amIsActivation_52610(Id,unit,name);\r\n\t\r\n\t--elseif Id == SpellIds[\"毁灭\"] then\t\r\n\r\n\t\t--return amIsActivation_81017(Id,unit,name);\r\n\t\r\n\telse\r\n\t\treturn true;\r\n\tend\r\n\r\nend\r\n\r\n--[[\r\n---毁灭之奔窜:技能处理\r\nfunction amIsActivation_81017(Id,unit,name)\r\n\r\n\tif UnitAura(\"player\", BuffName[\"强化野性冲锋(等级 1)\"]) then\r\n\t\t\r\n\t\t\r\n\t\treturn true,true,false;\r\n\t\t\r\n\t\t\r\n\telse\r\n\t\treturn false,\"\",true; -- 第3返回标记判断继续\r\n\tend\r\n\r\nend\r\n--]]\r\n\r\n---野蛮咆哮:技能处理\r\n\r\nfunction amIsActivation_52610(Id,unit,name)\r\n\t\r\n\t--if amIsSpellShapeshift(Id) then\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\t\tlocal isUsable, notEnoughMana = IsUsableSpell(name);\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\tif isUsable == 1  then\r\n\t\t\t\treturn true,true;\r\n\t\t\telseif notEnoughMana==1 then\r\n\t\t\t\treturn false,\"能量不足\";\r\n\t\t\tend\r\n\t\t\r\n\t--end\r\n\r\nend\r\n\r\n\r\n---迅捷治愈:技能处理\r\n\r\nfunction amIsActivation_18562(Id,unit,name)\r\n\r\n\r\n\tif (amaura(amGetSpellName(SpellIds[\"回春术\"]),unit)>0 or amaura(amGetSpellName(SpellIds[\"愈合\"]),unit)>0) then\r\n\t\r\n\t\t\r\n\t\tlocal powerCost = wowam.spell.Property[name][\"powerCost\"] ;\r\n\t\t\r\n\t\t\tif amr(\"player\") >= powerCost  then\r\n\t\t\t  return name,true,false;\r\n\t\t\t \r\n\t\t\tend\r\n\t\r\n\tend\r\n\r\n\treturn false;\r\nend\r\n\r\n\r\nfunction amSpellConversion(spell) \r\n\t\t\r\n\t\t\r\n\t\tif spell == GetSpellInfo(SpellIds[\"化身：丛林之王\"]) then\r\n\t\t\tGetSpellInfo(SpellIds[\"化身：丛林之王\"])\r\n\t\t\treturn SpellIds[\"化身\"],amGetSpellName(SpellIds[\"化身\"]);\r\n\t\tend\r\n\t\t\t\r\n\t\t\r\nend\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true\r\nend\r\n\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId];\r\n\t\r\nend\r\n\r\n\r\n\r\namIsClassLoad = true;\r\n--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"HUNTER\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\nSpellIds[\"准备就绪\"] = \t 23989;\r\n\r\nSpellIds[\"集中火力\"] = \t 82692;\r\nSpellIds[\"热情\"] = \t 82726;\r\nSpellIds[\"狂野怒火\"] = \t 19574;\r\n\r\nSpellIds[\"陷阱发射器\"] = \t 77769;\r\nSpellIds[\"伪装\"] = \t 51753;\r\nSpellIds[\"灵狐守护\"] = \t 82661;\r\n\r\n\r\nSpellIds[\"照明弹\"] = \t1543;\r\nSpellIds[\"假死\"] = \t5384;\r\nSpellIds[\"冰冻陷阱(冰霜)\"] = \t1499;\r\nSpellIds[\"威慑\"] = \t19263;\r\nSpellIds[\"冰霜陷阱(冰霜)\"] = \t13809;\r\nSpellIds[\"毒蛇陷阱(自然)\"] = \t34600;\r\nSpellIds[\"爆炸陷阱(火焰)\"] = \t13813;\r\nSpellIds[\"献祭陷阱(火焰)\"] = \t13795;\r\nSpellIds[\"逃脱\"] = \t781;\r\nSpellIds[\"主人的召唤\"] = \t53271;\r\nSpellIds[\"复活宠物\"] = \t982;\r\nSpellIds[\"杀戮命令\"] = \t34026;\r\nSpellIds[\"治疗宠物\"] = \t136;\r\nSpellIds[\"猎豹守护\"] = \t5118;\r\nSpellIds[\"解散宠物\"] = \t2641;\r\nSpellIds[\"豹群守护\"] = \t13159;\r\n--SpellIds[\"野性守护\"] = \t20043;\r\nSpellIds[\"野兽知识\"] = \t1462;\r\nSpellIds[\"雄鹰守护\"] = \t13165;\r\nSpellIds[\"喂养宠物\"] = \t6991;\r\nSpellIds[\"鹰眼术\"] = \t6197;  \r\n\r\nSpellIds[\"眼镜蛇射击\"] = \t77767;  \r\nSpellIds[\"稳固射击\"] = \t56641;  \r\n\r\n----CTM---------------\r\n\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"奥术射击\"]=3044;\r\nSpellIds[\"自动射击\"]=75;\r\nSpellIds[\"震荡射击\"]=5116;\r\nSpellIds[\"猎人印记\"]=1130;\r\nSpellIds[\"多重射击\"]=2643;\r\nSpellIds[\"宁神射击\"]=19801;\r\nSpellIds[\"杀戮射击\"]=53351;\r\nSpellIds[\"扰乱射击\"]=20736;\r\nSpellIds[\"急速射击\"]=3045;\r\n--SpellIds[\"猛禽一击\"]=2973;\r\nSpellIds[\"毒蛇钉刺\"]=1978;\r\n--SpellIds[\"摔绊\"]=2974;\r\nSpellIds[\"驱散射击\"]=19503;\r\nSpellIds[\"误导\"]=34477;\r\nSpellIds[\"驯服野兽\"]=1515;\r\nSpellIds[\"召唤宠物 2\"]=83242;\r\nSpellIds[\"恐吓野兽\"]=1513;\r\nSpellIds[\"蜘蛛毒刺\"]=82654;\r\nSpellIds[\"召唤宠物 3\"]=83243;\r\nSpellIds[\"召唤宠物 4\"]=83244;\r\nSpellIds[\"召唤宠物 5\"]=83245;\r\nSpellIds[\"召唤宠物 1\"]=883\r\nSpellIds[\"奇美拉射击\"]=53209;  \r\nSpellIds[\"沉默射击\"]=34490;  \r\nSpellIds[\"瞄准射击\"]=19434;\r\n\r\n-----5.0--\r\nSpellIds[\"弹幕射击\"]=120360;\r\n\r\n\r\n\r\nAM_GCD_SPELLID=SpellIds[\"雄鹰守护\"];\r\n\r\nBuffName[\"灵狐守护\"]=GetSpellInfo(SpellIds[\"灵狐守护\"]);\r\n\r\nBuffName[\"开火！\"]=GetSpellInfo(82926);\r\n\r\n\r\n\r\nNoSpellTarget[SpellIds[\"准备就绪\"]] =  true; --\t 23989;\r\n\r\nNoSpellTarget[SpellIds[\"集中火力\"]] =  true; --\t 32300;\r\nNoSpellTarget[SpellIds[\"热情\"]] =  true; --\t 805;\r\nNoSpellTarget[SpellIds[\"狂野怒火\"]] =  true; --\t 19574;\r\n\r\nNoSpellTarget[SpellIds[\"陷阱发射器\"]] =  true; --\t 56871;\r\nNoSpellTarget[SpellIds[\"伪装\"]] =  true; --\t 51753;\r\nNoSpellTarget[SpellIds[\"灵狐守护\"]] =  true; --\t 82661;\r\n\r\n\r\nNoSpellTarget[SpellIds[\"照明弹\"]] =  true; --\t1543;\r\nNoSpellTarget[SpellIds[\"假死\"]] =  true; --\t5384;\r\nNoSpellTarget[SpellIds[\"冰冻陷阱(冰霜)\"]] =  true; --\t1499;\r\nNoSpellTarget[SpellIds[\"威慑\"]] =  true; --\t19263;\r\nNoSpellTarget[SpellIds[\"冰霜陷阱(冰霜)\"]] =  true; --\t13809;\r\nNoSpellTarget[SpellIds[\"毒蛇陷阱(自然)\"]] =  true; --\t34600;\r\nNoSpellTarget[SpellIds[\"爆炸陷阱(火焰)\"]] =  true; --\t13813;\r\nNoSpellTarget[SpellIds[\"献祭陷阱(火焰)\"]] =  true; --\t13795;\r\nNoSpellTarget[SpellIds[\"逃脱\"]] =  true; --\t781;\r\nNoSpellTarget[SpellIds[\"主人的召唤\"]] =  true; --\t53271;\r\nNoSpellTarget[SpellIds[\"复活宠物\"]] =  true; --\t982;\r\nNoSpellTarget[SpellIds[\"杀戮命令\"]] =  true; --\t34026;\r\nNoSpellTarget[SpellIds[\"治疗宠物\"]] =  true; --\t136;\r\nNoSpellTarget[SpellIds[\"猎豹守护\"]] =  true; --\t5118;\r\nNoSpellTarget[SpellIds[\"解散宠物\"]] =  true; --\t2641;\r\nNoSpellTarget[SpellIds[\"豹群守护\"]] =  true; --\t13159;\r\n--NoSpellTarget[SpellIds[\"野性守护\"]] =  true; --\t20043;\r\nNoSpellTarget[SpellIds[\"野兽知识\"]] =  true; --\t1462;\r\nNoSpellTarget[SpellIds[\"雄鹰守护\"]] =  true; --\t13165;\r\nNoSpellTarget[SpellIds[\"喂养宠物\"]] =  true; --\t6991;\r\nNoSpellTarget[SpellIds[\"鹰眼术\"]] =  true; --\t6197;  \r\n\r\n\r\n-------CTM-----------\r\n\r\nNoSpellTarget[SpellIds[\"召唤宠物 1\"]] =  true; --\t6197; \r\nNoSpellTarget[SpellIds[\"召唤宠物 2\"]] =  true; --\t6197; \r\nNoSpellTarget[SpellIds[\"召唤宠物 3\"]] =  true; --\t6197; \r\nNoSpellTarget[SpellIds[\"召唤宠物 4\"]] =  true; --\t6197; \r\nNoSpellTarget[SpellIds[\"召唤宠物 5\"]] =  true; --\t6197; \r\n \r\n\r\n\r\n------------------\r\n \r\n amAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n \r\n \r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\tif tostring(B) ~= tostring(D) then\r\n\t\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\tend\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一洋。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解抉\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解抉\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tif SpellLink then\r\n\t\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\t\r\n\t\t\t\tprint(i..\".\",SpellLink,v);\r\n\t\t\t\t\r\n\t\t\t\tif menu then\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction amIsMoveSpell(Id,unit,name) --处理移动中能施放的技能\r\n\r\n\t--if (Id == SpellIds[\"眼镜蛇射击\"] or Id == SpellIds[\"稳固射击\"] or Id == SpellIds[\"弹幕射击\"]) and UnitAura(\"player\", BuffName[\"灵狐守护\"]) then \r\n\tif Id == SpellIds[\"眼镜蛇射击\"] or Id == SpellIds[\"稳固射击\"] or Id == SpellIds[\"弹幕射击\"]  then \r\n\t\t\r\n\t\treturn true;\r\n\r\n\t\r\n\t\r\n\telseif SpellIds[\"瞄准射击\"] == Id then\r\n\t\t\r\n\t\tif UnitAura(\"player\", BuffName[\"开火！\"]) then \r\n\t\t\t\t\r\n\t\t\treturn true;\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\r\n\tend\r\n\t\r\nend\r\n\r\nfunction amIsActivation(Id,unit,name) --处理被激活技能\r\n\r\n\t--if Id == SpellIds[\"愤怒之锤\"] then \r\n\t\t\r\n\t\t\r\n\t\r\n\r\n\t--end\r\n\treturn true;\r\nend\r\n\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true;\r\nend\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId] and true;\r\n\t\r\nend\r\n\r\n\r\n--技能能量判断\r\nfunction amSpellIsPowerNumber(spellId)\r\n\r\n\tif SpellIds[\"瞄准射击\"] == spellId then\r\n\t\t\r\n\t\tif UnitAura(\"player\", BuffName[\"开火！\"]) then \r\n\t\t\t\t\r\n\t\t\treturn 0;\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\r\n\tend\r\n\t\r\nend\r\namIsClassLoad = true;--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"MAGE\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\n\r\nBuffName[\"法术连击\"]=GetSpellInfo(48108);\r\n\r\n\r\nSpellIds[\"射击\"]=5019;\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"寒冰箭\"]=116;\r\nSpellIds[\"冰霜新星\"]=122;\r\nSpellIds[\"冰锥术\"]=120;\r\nSpellIds[\"冰枪术\"]=30455;\r\nSpellIds[\"寒冰屏障\"]=45438;\r\nSpellIds[\"暴风雪\"]=10;\r\nSpellIds[\"霜甲术\"]=7302;\r\n--SpellIds[\"冰霜之环\"]=82676;\r\nSpellIds[\"奥术飞弹\"]=5143;\r\nSpellIds[\"法术反制\"]=2139;\r\nSpellIds[\"唤醒\"]=12051;\r\nSpellIds[\"变形术\"]=118;\r\nSpellIds[\"闪现术\"]=1953;\r\nSpellIds[\"奥术冲击\"]=30451;\r\nSpellIds[\"魔爆术\"]=1449;\r\nSpellIds[\"解除诅咒\"]=475;\r\nSpellIds[\"缓落术\"]=130;\r\n--SpellIds[\"法师结界\"]=543;\r\nSpellIds[\"造餐术\"]=42955;\r\nSpellIds[\"咒术护盾\"]=1463;\r\nSpellIds[\"制造法力宝石\"]=759;\r\nSpellIds[\"镜像\"]=55342;\r\nSpellIds[\"奥术光辉\"]=1459;\r\nSpellIds[\"法师护甲\"]=6117;\r\nSpellIds[\"法术吸取\"]=30449;\r\nSpellIds[\"召唤餐桌\"]=43987;\r\nSpellIds[\"隐形术\"]=66;\r\nSpellIds[\"时间扭曲\"]=80353;\r\nSpellIds[\"火球术\"]=133;\r\nSpellIds[\"火焰冲击\"]=2136;\r\nSpellIds[\"灼烧\"]=2948;\r\nSpellIds[\"熔岩护甲\"]=30482;\r\nSpellIds[\"烈焰风暴\"]=2120;\r\nSpellIds[\"霜火之箭\"]=44614;\r\n--SpellIds[\"烈焰宝珠\"]=82731\r\n\r\nSpellIds[\"减速\"]=31589;  \r\nSpellIds[\"奥术弹幕\"]=44425;  \r\nSpellIds[\"气定神闲\"]=12043;  \r\nSpellIds[\"传送门：埃索达\"]=32266;  \r\nSpellIds[\"传送门：塞拉摩\"]=49360;  \r\nSpellIds[\"传送门：暴风城\"]=10059;  \r\nSpellIds[\"传送门：达纳苏斯\"]=11419;  \r\nSpellIds[\"传送门：铁炉堡\"]=11416;  \r\nSpellIds[\"传送：埃索达\"]=32271;  \r\nSpellIds[\"传送：塞拉摩\"]=49359;  \r\nSpellIds[\"传送：暴风城\"]=3561;  \r\nSpellIds[\"传送：达纳苏斯\"]=3565;  \r\nSpellIds[\"传送：铁炉堡\"]=3562;  \r\nSpellIds[\"生命之血(等级1)\"]=81708;\r\n\r\n\r\nSpellIds[\"冰冷血脉\"]=12472; \r\nSpellIds[\"召唤水元素\"]=31687;  \r\nSpellIds[\"寒冰护体\"]=11426;  \r\nSpellIds[\"急速冷却\"]=11958;  \r\nSpellIds[\"深度冻结\"]=44572;  \r\n--SpellIds[\"上古寒冰箭\"]=11;  \r\nSpellIds[\"变形术(龟)\"]=28271;  \r\nSpellIds[\"变形术(兔子)\"]=61721;  \r\nSpellIds[\"达拉然光辉\"]=61316;  \r\nSpellIds[\"传送门：奥格瑞玛\"]=11417;  \r\nSpellIds[\"传送门：幽暗城\"]=11418;  \r\nSpellIds[\"传送门：托尔巴拉德\"]=88345;  \r\nSpellIds[\"传送门：斯通纳德\"]=49361;  \r\nSpellIds[\"传送门：沙塔斯\"]=33691;  \r\nSpellIds[\"传送门：达拉然\"]=53142;  \r\nSpellIds[\"传送门：银月城\"]=32267;  \r\nSpellIds[\"传送门：雷霆崖\"]=11420;  \r\nSpellIds[\"传送：奥格瑞玛\"]=3567;  \r\nSpellIds[\"传送：幽暗城\"]=3563;  \r\nSpellIds[\"传送：斯通纳德\"]=49358;  \r\nSpellIds[\"传送：沙塔斯\"]=33690;  \r\nSpellIds[\"传送：达拉然\"]=53140;  \r\nSpellIds[\"传送：银月城\"]=32272;  \r\nSpellIds[\"传送：雷霆崖\"]=3566; \r\n\r\n--SpellIds[\"专注魔法\"]=54646;  \r\nSpellIds[\"奥术强化\"]=12042;\r\n\r\n--SpellIds[\"Hot Foot (TEST)\"]=12;  \r\nSpellIds[\"冲击波\"]=11113; \r\n \r\nSpellIds[\"活动炸弹\"]=44457;\r\n  \r\nSpellIds[\"炎爆术\"]=11366;  \r\nSpellIds[\"燃烧\"]=11129;  \r\nSpellIds[\"龙息术\"]=31661;\r\nSpellIds[\"秘法炸弹\"]=125430;\r\n\r\n\r\n\r\nAM_GCD_SPELLID=SpellIds[\"霜甲术\"];\r\n \r\nNoSpellTarget[SpellIds[\"冰霜新星\"]] =  true; \r\nNoSpellTarget[SpellIds[\"冰锥术\"]] =  true; \r\nNoSpellTarget[SpellIds[\"寒冰屏障\"]] =  true; \r\nNoSpellTarget[SpellIds[\"暴风雪\"]] =  true; \r\n--NoSpellTarget[SpellIds[\"冰霜之环\"]] =  true; \r\nNoSpellTarget[SpellIds[\"唤醒\"]] =  true; \r\nNoSpellTarget[SpellIds[\"闪现术\"]] =  true; \r\nNoSpellTarget[SpellIds[\"魔爆术\"]] =  true; \r\n--NoSpellTarget[SpellIds[\"法师结界\"]] =  true; \r\nNoSpellTarget[SpellIds[\"造餐术\"]] =  true; \r\nNoSpellTarget[SpellIds[\"咒术护盾\"]] =  true; \r\nNoSpellTarget[SpellIds[\"制造法力宝石\"]] =  true; \r\nNoSpellTarget[SpellIds[\"镜像\"]] =  true; \r\nNoSpellTarget[SpellIds[\"奥术光辉\"]] =  true; \r\n\r\nNoSpellTarget[SpellIds[\"法师护甲\"]] =  true; \r\nNoSpellTarget[SpellIds[\"召唤餐桌\"]] =  true; \r\nNoSpellTarget[SpellIds[\"隐形术\"]] =  true; \r\nNoSpellTarget[SpellIds[\"时间扭曲\"]] =  true; \r\nNoSpellTarget[SpellIds[\"熔岩护甲\"]] =  true; \r\nNoSpellTarget[SpellIds[\"烈焰风暴\"]] =  true; \r\n\r\n--NoSpellTarget[SpellIds[\"烈焰宝珠\"]] =  true;\r\n\r\nNoSpellTarget[SpellIds[\"传送门：埃索达\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送门：塞拉摩\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送门：暴风城\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送门：达纳苏斯\"]] =  true;  \r\nNoSpellTarget[SpellIds[\"传送门：铁炉堡\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送：埃索达\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送：塞拉摩\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送：暴风城\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送：达纳苏斯\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送：铁炉堡\"]] =  true;\r\nNoSpellTarget[SpellIds[\"生命之血(等级1)\"]] =  true;\r\n\r\nNoSpellTarget[SpellIds[\"冰冷血脉\"]] =  true;\r\nNoSpellTarget[SpellIds[\"召唤水元素\"]] =  true; \r\nNoSpellTarget[SpellIds[\"寒冰护体\"]] =  true;\r\nNoSpellTarget[SpellIds[\"急速冷却\"]] =  true; \r\n\r\nNoSpellTarget[SpellIds[\"达拉然光辉\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送门：奥格瑞玛\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送门：幽暗城\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送门：托尔巴拉德\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送门：斯通纳德\"]] =  true;  \r\nNoSpellTarget[SpellIds[\"传送门：沙塔斯\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送门：达拉然\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送门：银月城\"]] =  true;  \r\nNoSpellTarget[SpellIds[\"传送门：雷霆崖\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送：奥格瑞玛\"]] =  true;  \r\nNoSpellTarget[SpellIds[\"传送：幽暗城\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送：斯通纳德\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送：沙塔斯\"]] =  true;\r\nNoSpellTarget[SpellIds[\"传送：达拉然\"]] =  true; \r\nNoSpellTarget[SpellIds[\"传送：银月城\"]] =  true;  \r\nNoSpellTarget[SpellIds[\"传送：雷霆崖\"]] =  true;  \r\nNoSpellTarget[SpellIds[\"奥术强化\"]] =  true; \r\n\r\nNoSpellTarget[SpellIds[\"冲击波\"]] =  true;  \r\nNoSpellTarget[SpellIds[\"龙息术\"]] =  true;\r\nNoSpellTarget[SpellIds[\"霜甲术\"]] =  true;\r\n\r\n\r\n amAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n \r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\tif tostring(B) ~= tostring(D) then\r\n\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\tend\t\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true;\r\nend\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId] and true;\r\n\t\r\nend\r\n\r\n\r\n\r\n--local N_86914 = GetSpellInfo(SpellIds[\"灼烧\"]); --灼烧\r\nfunction amIsMoveSpell(Id,unit,name) --处理移动中能施放的技能\r\n\r\n\r\n\tif UnitAura(\"player\", BuffName[\"法术连击\"])  and SpellIds[\"炎爆术\"] == Id then \r\n\t\t\r\n\t\treturn true;\r\n\t\t\r\n\t--elseif amTalentInfo(N_86914) and SpellIds[\"灼烧\"] == Id then\r\n\telseif SpellIds[\"灼烧\"] == Id then\r\n\t\t\r\n\t\treturn true;\r\n\r\n\tend\r\n\t\r\nend\r\n\r\n\r\n--技能能量判断\r\n--[[\r\nfunction amSpellIsPowerNumber(spellId)\r\n\r\n\tif SpellIds[\"秘法炸弹\"] == spellId then\r\n\t\tlocal p =select(4,GetSpellInfo(SpellIds[\"活动炸弹\"]));\r\n\t\treturn p;\r\n\t\r\n\t\r\n\tend\r\n\t\r\nend\r\n--]]\r\namIsClassLoad = true; --if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"PALADIN\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\n\r\n\r\nlocal spellinf = wowam.spell.Info;\t--技能信息\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\n\r\n\r\nSpellIds[\"公正圣印\"] = 20164;\r\nSpellIds[\"正义圣印\"] = 20154;\r\nSpellIds[\"洞察圣印\"] = 20165;\r\nSpellIds[\"真理圣印\"] = 31801;\r\nSpellIds[\"炽热防御者\"] = 31850;\r\n--SpellIds[\"抗性光环\"] = 19891;\r\n--SpellIds[\"专注光环\"] = 19746;\r\nSpellIds[\"正义之怒\"] = 25780;\r\nSpellIds[\"王者祝福\"] = 20217;\r\nSpellIds[\"力量祝福\"] = 19740;\r\n--SpellIds[\"神圣守卫\"] = 70940;\r\nSpellIds[\"圣洁护盾\"] = 20925;\r\nSpellIds[\"圣佑术\"] = 498;\r\nSpellIds[\"圣盾术\"] = 642;\r\n--SpellIds[\"虔诚光环\"] = 465;\r\n--SpellIds[\"十字军光环\"] = 32223;\r\n--SpellIds[\"惩戒光环\"] = 7294;\r\n--SpellIds[\"远古列王守卫\"] =86150 ;\r\nSpellIds[\"奉献\"] = 26573;\r\nSpellIds[\"神圣恳求\"] = 54428;\r\nSpellIds[\"谴责\"] = 2812;\r\nSpellIds[\"复仇之怒\"] = 31884;\r\nSpellIds[\"神恩术\"] = 31842;\r\nSpellIds[\"异端裁决\"] = 84963;\r\nSpellIds[\"虔诚光环\"] = 31821;\r\nSpellIds[\"黎明圣光\"] = 85222;\r\nSpellIds[\"保护之手\"] = 1022;\r\nSpellIds[\"圣光普照\"] = 82327;\r\nSpellIds[\"神圣之光\"] = 82326;\r\nSpellIds[\"愤怒之锤\"] = 24275;\r\nSpellIds[\"神圣风暴\"] = 53385;\r\n--SpellIds[\"圣洁怒火(等级 1)\"] = 53375;\r\n\r\nSpellIds[\"战争艺术\"] = 87138;\r\n--SpellIds[\"谴责\"] = 85509;\r\nSpellIds[\"驱邪术\"] = 879;\r\n\r\n\r\n-----CTM---------\r\n\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"十字军打击\"]=35395;\r\nSpellIds[\"审判\"]=20271;\r\nSpellIds[\"责难\"]=96231;\r\nSpellIds[\"圣光术\"]=635;\r\nSpellIds[\"荣耀圣令\"]=85673;\r\nSpellIds[\"救赎\"]=7328;\r\nSpellIds[\"圣光闪现\"]=19750;\r\nSpellIds[\"圣疗术\"]=633;\r\nSpellIds[\"清洁术\"]=4987;\r\nSpellIds[\"超度邪恶\"]=10326;\r\nSpellIds[\"制裁之锤\"]=853;\r\nSpellIds[\"清算\"]=62124;\r\nSpellIds[\"正义防御\"]=31789;\r\nSpellIds[\"自由之手\"]=1044;\r\nSpellIds[\"拯救之手\"]=1038;\r\nSpellIds[\"牺牲之手\"]=6940\r\n\r\n\r\nSpellIds[\"复仇者之盾\"]=31935;  \r\nSpellIds[\"正义之锤\"]=53595;  \r\nSpellIds[\"正义盾击\"]=53600;  \r\n\r\nSpellIds[\"圣光道标\"]=53563;  \r\nSpellIds[\"神圣震击\"]=20473;  \r\n\r\nSpellIds[\"圣殿骑士的裁决\"]=85256;  \r\nSpellIds[\"忏悔\"]=20066;  \r\n--SpellIds[\"狂热\"]=85696;\r\n\r\nAM_GCD_SPELLID=SpellIds[\"正义圣印\"];\r\n----------------\r\n\r\nBuffName[\"战争艺术\"]=GetSpellInfo(SpellIds[\"战争艺术\"]);\r\n--BuffName[\"谴责\"]=GetSpellInfo(SpellIds[\"谴责\"]) or \"\";\r\n\r\n\r\n\r\n\r\nRaidSpell[SpellIds[\"保护之手\"]]=3;\r\n\r\n\r\n\r\n\r\nNoSpellTarget[SpellIds[\"公正圣印\"]] = true;\r\nNoSpellTarget[SpellIds[\"正义圣印\"]] = true;\r\nNoSpellTarget[SpellIds[\"洞察圣印\"]] = true;\r\nNoSpellTarget[SpellIds[\"真理圣印\"]] = true;\r\nNoSpellTarget[SpellIds[\"炽热防御者\"]] = true;\r\n--NoSpellTarget[SpellIds[\"抗性光环\"]] = true;\r\n--NoSpellTarget[SpellIds[\"专注光环\"]] = true;\r\nNoSpellTarget[SpellIds[\"正义之怒\"]] = true;\r\nNoSpellTarget[SpellIds[\"王者祝福\"]] = true;\r\nNoSpellTarget[SpellIds[\"力量祝福\"]] = true;\r\n--NoSpellTarget[SpellIds[\"神圣守卫\"]] = true;\r\n--NoSpellTarget[SpellIds[\"圣洁护盾\"]] = true;\r\nNoSpellTarget[SpellIds[\"圣佑术\"]] = true;\r\nNoSpellTarget[SpellIds[\"圣盾术\"]] = true;\r\n--NoSpellTarget[SpellIds[\"虔诚光环\"]] = true;\r\n--NoSpellTarget[SpellIds[\"十字军光环\"]] = true;\r\n--NoSpellTarget[SpellIds[\"惩戒光环\"]] = true;\r\n--NoSpellTarget[SpellIds[\"远古列王守卫\"]] = true ;\r\nNoSpellTarget[SpellIds[\"奉献\"]] = true;\r\nNoSpellTarget[SpellIds[\"神圣恳求\"]] = true;\r\n--NoSpellTarget[SpellIds[\"谴责\"]] = true;\r\nNoSpellTarget[SpellIds[\"复仇之怒\"]] = true;\r\nNoSpellTarget[SpellIds[\"神恩术\"]] = true;\r\nNoSpellTarget[SpellIds[\"异端裁决\"]] = true;\r\nNoSpellTarget[SpellIds[\"虔诚光环\"]] = true;\r\nNoSpellTarget[SpellIds[\"黎明圣光\"]] = true;\r\nNoSpellTarget[SpellIds[\"圣光普照\"]] = true;\r\nNoSpellTarget[SpellIds[\"神圣风暴\"]] = true;\r\n\r\n\r\namAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n\r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\t\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\tif tostring(B) ~= tostring(D) then\r\n\t\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\tend\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\nfunction amIsMoveSpell(Id,unit,name) --处理移动中能施放的技能\r\n\r\n--[[\r\n\tif Id == SpellIds[\"驱邪术\"]  and (UnitAura(\"player\", BuffName[\"战争艺术\"]) or UnitAura(\"player\", BuffName[\"谴责\"])) then \r\n\t\t\r\n\t\treturn true;\r\n\r\n\tend\r\n--]]\t\r\nend\r\n\r\n\r\nfunction amIsActivation(Id,unit,name) --处理被激活技能\r\n\r\n\t\r\n\treturn true;\r\n\t\r\n\r\nend\r\n\r\n--[[\r\nfunction amIsActivation_24275(Id,unit,name)\r\n\r\n\r\n\tif aml(unit,\"%\")<=20 or (ampb(GetSpellInfo(SpellIds[\"复仇之怒\"]))>0 and amTalentInfo(GetSpellInfo(SpellIds[\"圣洁怒火(等级 1)\"]))) then\r\n\t\treturn true;\r\n\telse\r\n\t\treturn false;\r\n\tend\r\nend\r\n--]]\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true;\r\nend\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId] and true;\r\n\t\r\nend\r\n\r\nlocal ItemName_41107 = GetItemInfo(41107);\r\nfunction amIsSpellCastTarget(id,tunit)\r\n\t\t\t\r\n\tif SpellIds[\"荣耀圣令\"] == id then\r\n\t\t\r\n\t\tif UnitCanAssist(\"player\", tunit) and amjl(tunit) <= select(9,GetSpellInfo(SpellIds[\"荣耀圣令\"])) then\r\n\t\t\treturn true;\r\n\t\telseif UnitCanAttack(\"player\", tunit) and amjl(tunit) <= select(9,GetSpellInfo(SpellIds[\"荣耀圣令\"])) then\r\n\t\t\t\r\n\t\t\tif amIsGlyphSocketInfo(ItemName_41107) then\r\n\t\t\t\treturn true;\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\treturn false;\r\n\t\t\r\n\t\t\r\n\tend\r\n\t\r\n\treturn false;\r\n\t\r\nend\r\n\r\namIsClassLoad = true;\r\n--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"PRIEST\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\n\r\nlocal BuffNames = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\n\r\nSpellIds[\"心灵之火\"] = 588;\r\nSpellIds[\"真言术：韧\"] = 21562;\r\nSpellIds[\"光明之泉\"] = 724;\r\n--SpellIds[\"脉轮\"] = 14751;\r\nSpellIds[\"心灵尖啸\"] = 8122;\r\nSpellIds[\"心灵视界\"] = 2096;\r\n--SpellIds[\"暗影防护\"] = 27683;\r\nSpellIds[\"渐隐术\"] = 586;\r\nSpellIds[\"群体驱散\"] = 32375;\r\nSpellIds[\"心灵意志\"]=73413;\r\nSpellIds[\"神圣新星\"] = 15237;\r\nSpellIds[\"希望圣歌\"] = 64901; \r\nSpellIds[\"神圣赞美诗\"] = 64843;\r\nSpellIds[\"暗影形态\"] = 15473;\r\n\r\nSpellIds[\"圣言术：罚\"] = 88625;\r\nSpellIds[\"圣言术：佑\"] = 88685;\r\nSpellIds[\"圣言术：静\"] = 88684;\r\n\r\nSpellIds[\"真言术：盾\"] = 17;\r\n\r\nSpellIds[\"吸血鬼的拥抱\"]=15286;\r\n\r\n\r\n\r\n\r\n\r\n------已验证-------------\r\n\r\nSpellIds[\"射击\"]=5019;\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"束缚亡灵\"]=9484;\r\nSpellIds[\"法力燃烧\"]=8129;\r\nSpellIds[\"漂浮术\"]=1706;\r\nSpellIds[\"防护恐惧结界\"]=6346;\r\nSpellIds[\"纯净术\"]=527;\r\nSpellIds[\"吸血鬼之触\"]=34914;\r\nSpellIds[\"噬灵疫病\"]=2944;\r\n--SpellIds[\"安抚心灵\"]=453;\r\nSpellIds[\"心灵震爆\"]=8092;\r\nSpellIds[\"暗影魔\"]=34433;\r\nSpellIds[\"暗言术：灭\"]=32379;\r\nSpellIds[\"暗言术：痛\"]=589;\r\nSpellIds[\"消散\"]=47585;\r\nSpellIds[\"统御意志\"]=605;\r\nSpellIds[\"精神灼烧\"]=48045;\r\nSpellIds[\"精神鞭笞\"]=15407;\r\nSpellIds[\"心灵尖刺\"]=73510;\r\nSpellIds[\"复活术\"]=2006;\r\nSpellIds[\"强效治疗术\"]=2060;\r\nSpellIds[\"快速治疗\"]=2061;\r\nSpellIds[\"恢复\"]=139;\r\nSpellIds[\"惩击\"]=585;\r\nSpellIds[\"愈合祷言\"]=33076;\r\nSpellIds[\"治疗术\"]=2050;\r\nSpellIds[\"治疗祷言\"]=596;\r\nSpellIds[\"驱散魔法\"]=528;\r\nSpellIds[\"神圣之火\"]=14914;\r\nSpellIds[\"联结治疗\"]=32546;\r\nSpellIds[\"信仰飞跃\"]=73325;\r\n\r\n\r\nSpellIds[\"心灵专注\"]=89485;  \r\nSpellIds[\"痛苦压制\"]=33206;  \r\nSpellIds[\"真言术：障\"]=62618;  \r\nSpellIds[\"能量灌注\"]=10060;  \r\nSpellIds[\"苦修\"]=47540;\r\n\r\nSpellIds[\"守护之魂\"]=47788;  \r\nSpellIds[\"治疗之环\"]=34861;  \r\nSpellIds[\"绝望祷言\"]=19236\r\n--SpellIds[\"天使长\"]=87151;\r\n----------------\r\n\r\n\r\n\r\nNoSpellTarget[SpellIds[\"心灵之火\"]] = true;\r\n--NoSpellTarget[SpellIds[\"真言术：韧\"]] = true;\r\nNoSpellTarget[SpellIds[\"光明之泉\"]] = true;\r\n--NoSpellTarget[SpellIds[\"脉轮\"]] = true;\r\nNoSpellTarget[SpellIds[\"心灵尖啸\"]] = true;\r\nNoSpellTarget[SpellIds[\"心灵视界\"]] = true;\r\n--NoSpellTarget[SpellIds[\"暗影防护\"]] = true;\r\nNoSpellTarget[SpellIds[\"渐隐术\"]] = true;\r\nNoSpellTarget[SpellIds[\"群体驱散\"]] = true;\r\nNoSpellTarget[SpellIds[\"心灵意志\"]] = true;\r\nNoSpellTarget[SpellIds[\"神圣新星\"]] = true;\r\nNoSpellTarget[SpellIds[\"希望圣歌\"]] = true; \r\nNoSpellTarget[SpellIds[\"神圣赞美诗\"]] = true;\r\nNoSpellTarget[SpellIds[\"暗影形态\"]] = true;\r\nNoSpellTarget[SpellIds[\"吸血鬼的拥抱\"]] = true;\r\n\r\n-------CTM------------------\r\n\r\n\r\n\r\nNoSpellTarget[SpellIds[\"消散\"]] = true;\r\nNoSpellTarget[SpellIds[\"心灵专注\"]] = true;\r\nNoSpellTarget[SpellIds[\"真言术：障\"]] = true;\r\nNoSpellTarget[SpellIds[\"绝望祷言\"]] = true;\r\n\r\n--NoSpellTarget[SpellIds[\"天使长\"]] = true;\r\n\r\n---------\r\n\r\n\r\n--BuffNames[\"脉轮：佑\"] = GetSpellInfo(81207);\r\nBuffNames[\"脉轮：佑\"] = GetSpellInfo(81206);\r\nBuffNames[\"脉轮：静\"] = GetSpellInfo(81208);\r\nBuffNames[\"脉轮：罚\"] = GetSpellInfo(81209);\r\n\r\nBuffNames[\"虚弱灵魂\"] = GetSpellInfo(6788);\r\n\r\n\r\nAM_GCD_SPELLID=SpellIds[\"恢复\"];\r\n\r\namAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n\r\n\r\n--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\n--RaidSpell[SpellIds[\"真言术：盾\"]]=3;\r\n\r\n--技能需要能量判断\r\nlocal IsPowerCost={};\r\n\r\nIsPowerCost[GetSpellInfo(SpellIds[\"真言术：盾\"])]=true;\r\n\r\n\r\n--技能需要能量判断\r\nfunction amSpellIsPowerCost(spell)\r\n\treturn IsPowerCost[spell];\r\nend\r\n\r\n\r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\tif tostring(B) ~= tostring(D) then\r\n\t\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\tend\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\nlocal T6788={};\r\n\r\nfunction amIsActivation(Id,unit) --处理被激活技能\r\n\r\n\tif GetSpellInfo(SpellIds[\"真言术：盾\"]) == GetSpellInfo(Id) then\r\n\t\t\r\n\t\tlocal name, _, _, _, _, _, expirationTime  = UnitDebuff(unit,BuffNames[\"虚弱灵魂\"])\r\n\t\tlocal id = UnitGUID(unit);\r\n\t\t\r\n\t\tif ((expirationTime or 0) - GetTime()) <=0 then\r\n\t\t\r\n\t\t\t\r\n\t\t\tif not T6788[id] then\r\n\t\t\t\tT6788[id]=GetTime();\r\n\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tif GetTime() - T6788[id]>0.1 then\r\n\t\t\t\t\tT6788={};\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\treturn false,false,false,true;\r\n\t\t\t\r\n\t\telse\r\n\t\t\tT6788[id]=GetTime();\r\n\t\t\treturn false,false,false,true;\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\r\n\tend\r\n\r\n\treturn true;\r\nend\r\n\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellIds) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellIds] and true\r\nend\r\n\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId];\r\n\t\r\nend\r\n\r\n--技能转换\r\n--[[\r\nfunction amSpellConversion(spell) -- 圣言术：罚\r\n\r\n\t\tif amGetSpellName(SpellIds[\"圣言术：罚\"]) ~= spell then\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\t\r\n\t\tlocal spellId = false;\r\n\t\t\r\n\t\t\t\t\r\n\t\tif ampb(BuffNames[\"脉轮：罚\"])>0 then\r\n\t\t\r\n\t\t\tspellId=SpellIds[\"圣言术：罚\"];\r\n\t\t\r\n\t\telseif ampb(BuffNames[\"脉轮：佑\"])>0 then\r\n\t\t\r\n\t\t\tspellId=SpellIds[\"圣言术：佑\"];\r\n\t\t\t\r\n\t\telseif ampb(BuffNames[\"脉轮：静\"])>0 then\r\n\t\t\r\n\t\t\tspellId=SpellIds[\"圣言术：静\"];\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tif spellId then\r\n\t\t\treturn spellId,amGetSpellName(spellId);\r\n\t\telse\r\n\t\t\treturn false;\r\n\t\tend\r\n\t\t\r\n\t\t\r\nend\r\n\r\n-\r\n\r\nfunction amSetSpellinf_Ex(spell)\r\n\r\n\tif amGetSpellName(SpellIds[\"圣言术：佑\"])==spell or amGetSpellName(SpellIds[\"圣言术：罚\"])==spell or amGetSpellName(SpellIds[\"圣言术：静\"])==spell then\r\n\t\r\n\t\treturn amSetSpellinf_Ex_88625(spell);\r\n\t\r\n\tend\r\n\t\r\nend\r\n\r\n\r\nfunction amSetSpellinf_Ex_88625(spell) -- 圣言术：罚\r\n\r\n\t\tlocal spellId,slotID,typenumber,Cooldown;\r\n\t\tlocal spellname,level,powerCost,castTime , minRange, maxRange;\r\n\t\t\r\n\t\t\r\n\t\tspellId = SpellIds[spell];\r\n\t\t\r\n\t\t\r\n\t\ttypenumber=1;\r\n\t\tspellname,level, _, powerCost,_,_,castTime, minRange, maxRange = GetSpellInfo(spellId);\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\twowam.spell.Property[spell]={};\r\n\t\twowam.spell.Property[spell][\"type\"]=1;\r\n\t\twowam.spell.Property[spell][\"typename\"]=\"spell\";\r\n\t\t\r\n\t\twowam.spell.Property[spell][\"spellId\"]=spellId;\r\n\t\twowam.spell.Property[spell][\"slotID\"]=false;\r\n\t\t\r\n\t\twowam.spell.Property[spell][\"time\"]= GetTime();\r\n\t\t\r\n\t\twowam.spell.Property[spell][\"powerCost\"]= powerCost;\r\n\t\twowam.spell.Property[spell][\"castTime\"]= castTime;\r\n\t\twowam.spell.Property[spell][\"spellname\"]= spellname;\r\n\t\twowam.spell.Property[spell][\"level\"]= level;\r\n\t\t\r\n\t\twowam.spell.Property[spell][\"Spell\"]= spell;\r\n\t\twowam.spell.Property[spell][\"RaidSpell\"]= false;\r\n\t\t\r\n\t\tif spellId==SpellIds[\"圣言术：罚\"] then\r\n\t\t\twowam.spell.Property[spell][\"HasRange\"]=1;\r\n\t\telseif spellId==SpellIds[\"圣言术：佑\"] then\r\n\t\t\twowam.spell.Property[spell][\"HasRange\"]=false;\r\n\t\telseif spellId==SpellIds[\"圣言术：静\"] then\r\n\t\t\twowam.spell.Property[spell][\"HasRange\"]=1;\r\n\t\tend\r\n\t\t\r\n\t\treturn \ttrue,1,spell;\r\nend\r\n\t\t\r\nfunction amisspell_SpellConversion(name,tunit,gcd,Special,isname,typenumber,SpellLevel,temp_UnitGUID,unitguid)\r\n\r\n\t\r\n\tif not(amGetSpellName(SpellIds[\"圣言术：佑\"])==name or amGetSpellName(SpellIds[\"圣言术：罚\"])==name or amGetSpellName(SpellIds[\"圣言术：静\"])==name) then\r\n\t\r\n\t\treturn false,-100;\r\n\t\r\n\tend\r\n\r\n\t\tif wowam_config.SetGCD and not gcd then\r\n\t\t\r\n\t\t\tif amGCD()> wowam_config.SetGCD_Time then\r\n\t\t\t\t\r\n\t\t\t\treturn false,typenumber,\"公共CD没好\",Cooldown;\r\n\t\t\tend\r\n\t\t\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\tlocal spellId = wowam.spell.Property[name][\"spellId\"];\r\n\tlocal slotID = wowam.spell.Property[name][\"slotID\"];\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tlocal T_temp1 = GetUnitSpeed(\"player\");\r\n\t\tlocal T_temp2 = wowam.spell.Property[name][\"castTime\"] ;\r\n\t\t\t\r\n\t\tif T_temp2 >0 and T_temp1>0 then\r\n\t\t\t\r\n\t\t\treturn false,typenumber,\"你移动中\",Cooldown;\r\n\t\tend\r\n\t\t\r\n\t\tlocal UnitCan_a;\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif  wowam.spell.Property[name][\"HasRange\"] and tunit ~= \"nogoal\" then\r\n\t\t\r\n\t\t\tUnitCan_a = UnitCanAssist(\"player\", tunit);\r\n\t\t\t\r\n\t\t\tif  not UnitCan_a then\r\n\t\t\t\t\r\n\t\t\t\treturn false,typenumber,\"技能对目标无效\",Cooldown;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tif amjl(tunit)>40 then\r\n\t\t\t\r\n\t\t\t\treturn false,typenumber,\"技能距离太远\",Cooldown;\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\tend\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tlocal start, duration, enabled  = GetSpellCooldown(spellId)\r\n\t\t\r\n\t\tCooldown = start + duration - GetTime();\r\n\t\t\r\n\t\tif Cooldown < 0 then\r\n\t\t\tCooldown = 0;\r\n\t\tend\r\n\t\t\r\n\t\tif Cooldown >0 then\r\n\t\t\r\n\t\t\treturn false,typenumber,\"技能冷却中\",Cooldown;\r\n\t\tend\r\n\t\t\r\n\t\tif amr(\"player\") < wowam.spell.Property[name][\"powerCost\"]  then\r\n\t\t\t\t\r\n\t\t\t  return false,typenumber,\"能量不足\",Cooldown;\r\n\t\t\t\r\n\t\tend\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t\t\r\n\t\treturn \ttrue,1,name;\r\n\t\t\r\n\t\t\r\n\t\t\r\nend\r\n\r\n-]]\r\namIsClassLoad = true;\r\n\r\n\r\n--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"ROGUE\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\n\r\nSpellIds[\"射击\"]=3018;\r\n--SpellIds[\"投掷\"]=2764;\r\nSpellIds[\"投掷\"]=121733;\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"刺骨\"]=2098;\r\nSpellIds[\"伏击\"]=8676;\r\nSpellIds[\"切割\"]=5171;\r\nSpellIds[\"偷袭\"]=1833;\r\nSpellIds[\"肾击\"]=408;\r\nSpellIds[\"破甲\"]=8647;\r\nSpellIds[\"拆卸\"]=51722;\r\nSpellIds[\"锁喉\"]=703;\r\nSpellIds[\"割裂\"]=1943;\r\nSpellIds[\"毒伤\"]=32645;\r\nSpellIds[\"致命投掷(天赋)\"]=26679;\r\nSpellIds[\"影袭\"]=1752;\r\nSpellIds[\"闪避\"]=5277;\r\nSpellIds[\"恢复\"]=73651;\r\nSpellIds[\"脚踢\"]=1766;\r\nSpellIds[\"凿击\"]=1776;\r\nSpellIds[\"疾跑\"]=2983;\r\nSpellIds[\"背刺\"]=53;\r\nSpellIds[\"佯攻\"]=1966;\r\nSpellIds[\"毒刃\"]=5938;\r\nSpellIds[\"刀扇\"]=51723;\r\nSpellIds[\"备战就绪\"]=74001;\r\nSpellIds[\"潜行\"]=1784;\r\nSpellIds[\"搜索\"]=921;\r\nSpellIds[\"闷棍\"]=6770;\r\nSpellIds[\"开锁\"]=1804;\r\nSpellIds[\"消失\"]=1856;\r\nSpellIds[\"扰乱\"]=1725;\r\nSpellIds[\"致盲\"]=2094;\r\nSpellIds[\"解除陷阱\"]=1842;\r\nSpellIds[\"暗影斗篷\"]=31224;\r\nSpellIds[\"嫁祸诀窍\"]=57934;\r\nSpellIds[\"转嫁\"]=73981;\r\nSpellIds[\"烟雾弹\"]=76577\r\n\r\nAM_GCD_SPELLID=SpellIds[\"影袭\"];\r\n\r\nNoSpellTarget[SpellIds[\"疾跑\"]] =  true; \r\nNoSpellTarget[SpellIds[\"闪避\"]] =  true; \r\nNoSpellTarget[SpellIds[\"恢复\"]] =  true; \r\nNoSpellTarget[SpellIds[\"刀扇\"]] =  true;  --TT\r\nNoSpellTarget[SpellIds[\"备战就绪\"]] =  true; \r\nNoSpellTarget[SpellIds[\"潜行\"]] =  true; \r\nNoSpellTarget[SpellIds[\"搜索\"]] =  true; \r\nNoSpellTarget[SpellIds[\"消失\"]] =  true; \r\n\r\nNoSpellTarget[SpellIds[\"暗影斗篷\"]] =  true; \r\nNoSpellTarget[SpellIds[\"烟雾弹\"]] =  true; \r\nNoSpellTarget[SpellIds[\"切割\"]] =  true;\r\n\r\n \r\n\r\n amAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n \r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true;\r\nend\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId] and true;\r\n\t\r\nend\r\namIsClassLoad = true;\r\n\r\n--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"SHAMAN\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n--[[\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n--]]\r\n\r\namSpellInf[englishClass]={};\r\namSpellInf[englishClass][\"BuffName\"]={};\r\namSpellInf[englishClass][\"RaidSpell\"]={};\r\namSpellInf[englishClass][\"SpellIds\"]={};\r\namSpellInf[englishClass][\"NoSpellTarget\"]={};\r\n\r\nlocal BuffName = amSpellInf[englishClass][\"BuffName\"];\t\t\t\r\nlocal RaidSpell=amSpellInf[englishClass][\"RaidSpell\"];\t\t\t\t\t\r\nlocal SpellIds=amSpellInf[englishClass][\"SpellIds\"];\t\t\t\t\t\r\nlocal NoSpellTarget=amSpellInf[englishClass][\"NoSpellTarget\"];\r\n\r\nSpellIds[\"元素的召唤\"] =  66842;\r\nSpellIds[\"先祖的召唤\"] =  66843;\r\nSpellIds[\"火焰新星\"] =  1535;\r\nSpellIds[\"地缚图腾\"] =  2484;\r\nSpellIds[\"灼热图腾\"] =  3599;\r\nSpellIds[\"火元素图腾\"] =  2894;\r\nSpellIds[\"熔岩图腾\"] =  8190;\r\n--SpellIds[\"石爪图腾\"] =  5730;\r\nSpellIds[\"灵魂的召唤\"] =  66844;\r\n--SpellIds[\"元素抗性图腾\"] =  8184;\r\nSpellIds[\"根基图腾\"] =  8177;\r\nSpellIds[\"土元素图腾\"] =  2062;\r\n--SpellIds[\"火舌图腾\"] =  8227;\r\n--SpellIds[\"大地之力图腾\"] =  8075;\r\n--SpellIds[\"石肤图腾\"] =  8071;\r\n--SpellIds[\"空气之怒图腾\"] =  3738;\r\nSpellIds[\"英勇\"] =  32182;\r\nSpellIds[\"幽魂之狼\"] =  2645;\r\nSpellIds[\"闪电之盾\"] =  324;\r\n--SpellIds[\"风怒图腾\"] =  8512;\r\nSpellIds[\"图腾召回\"] =  36936;\r\nSpellIds[\"战栗图腾\"] =  8143;\r\nSpellIds[\"水之护盾\"] =  52127;\r\nSpellIds[\"治疗之泉图腾\"] =  5394;\r\n--SpellIds[\"宁静心智图腾\"] =  87718;\r\n--SpellIds[\"自然迅捷\"] =  16188;\r\nSpellIds[\"法力之潮图腾\"] =  16190;\r\n--SpellIds[\"法力之泉图腾\"] =  5675;\r\nSpellIds[\"大地生命武器\"] =  51730;\r\nSpellIds[\"石化武器\"] =  8017;\r\nSpellIds[\"火舌武器\"] =  8024;\r\nSpellIds[\"冰封武器\"] =  8033;\r\nSpellIds[\"雷霆风暴\"] =  51490;\r\nSpellIds[\"元素掌握\"] =  16166;\r\nSpellIds[\"野性狼魂\"] =  51533;\r\nSpellIds[\"萨满之怒\"] =  30823; \r\n\r\n------------------CTM---------\r\n\r\n\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"闪电箭\"]=403;\r\nSpellIds[\"大地震击\"]=8042;\r\nSpellIds[\"净化术\"]=370;\r\nSpellIds[\"烈焰震击\"]=8050;\r\nSpellIds[\"风剪\"]=57994;\r\nSpellIds[\"冰霜震击\"]=8056;\r\nSpellIds[\"闪电链\"]=421;\r\nSpellIds[\"熔岩爆裂\"]=51505;\r\nSpellIds[\"束缚元素\"]=76780;\r\nSpellIds[\"妖术\"]=51514;\r\nSpellIds[\"灵魂行者的恩赐\"]=79206;\r\nSpellIds[\"根源打击\"]=73899;\r\nSpellIds[\"水上行走\"]=546;\r\nSpellIds[\"星界传送\"]=556;\r\nSpellIds[\"风怒武器\"]=8232;\r\nSpellIds[\"视界术\"]=6196;\r\n--SpellIds[\"水下呼吸\"]=131;\r\nSpellIds[\"元素释放\"]=73680;\r\nSpellIds[\"治疗波\"]=331;\r\nSpellIds[\"先祖之魂\"]=2008;\r\nSpellIds[\"净化灵魂\"]=51886;\r\nSpellIds[\"治疗之涌\"]=8004;\r\nSpellIds[\"治疗链\"]=1064;\r\nSpellIds[\"强效治疗波\"]=77472;\r\nSpellIds[\"治疗之雨\"]=73920\r\n\r\nSpellIds[\"大地之盾\"]=974;  \r\nSpellIds[\"激流\"]=61295;  \r\nSpellIds[\"灵魂链接图腾\"]=98008;  \r\n\r\nSpellIds[\"熔岩猛击\"]=60103;  \r\nSpellIds[\"风暴打击\"]=17364;  \r\n\r\nAM_GCD_SPELLID=SpellIds[\"闪电箭\"];\r\n------------------\r\n\r\nNoSpellTarget[SpellIds[\"元素的召唤\"]] =  true;\r\nNoSpellTarget[SpellIds[\"先祖的召唤\"]] =  true;\r\nNoSpellTarget[SpellIds[\"火焰新星\"]] =  true;\r\nNoSpellTarget[SpellIds[\"地缚图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"灼热图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"火元素图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"熔岩图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"石爪图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"灵魂的召唤\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"元素抗性图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"根基图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"土元素图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"火舌图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"大地之力图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"石肤图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"空气之怒图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"英勇\"]] =  true;\r\nNoSpellTarget[SpellIds[\"幽魂之狼\"]] =  true;\r\nNoSpellTarget[SpellIds[\"闪电之盾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"风怒图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"图腾召回\"]] =  true;\r\nNoSpellTarget[SpellIds[\"战栗图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"水之护盾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"治疗之泉图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"宁静心智图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"自然迅捷\"]] =  true;\r\nNoSpellTarget[SpellIds[\"法力之潮图腾\"]] =  true;\r\n--NoSpellTarget[SpellIds[\"法力之泉图腾\"]] =  true;\r\nNoSpellTarget[SpellIds[\"大地生命武器\"]] =  true;\r\nNoSpellTarget[SpellIds[\"石化武器\"]] =  true;\r\nNoSpellTarget[SpellIds[\"火舌武器\"]] =  true;\r\nNoSpellTarget[SpellIds[\"冰封武器\"]] =  true;\r\nNoSpellTarget[SpellIds[\"雷霆风暴\"]] =  true;\r\nNoSpellTarget[SpellIds[\"元素掌握\"]] =  true;\r\nNoSpellTarget[SpellIds[\"野性狼魂\"]] =  true;\r\nNoSpellTarget[SpellIds[\"萨满之怒\"]] =  true; \r\n\r\n\r\n----------CTM----\r\n\r\nNoSpellTarget[SpellIds[\"灵魂行者的恩赐\"]] =  true; \r\nNoSpellTarget[SpellIds[\"星界传送\"]] =  true; \r\nNoSpellTarget[SpellIds[\"风怒武器\"]] =  true; \r\nNoSpellTarget[SpellIds[\"视界术\"]] =  true; \r\nNoSpellTarget[SpellIds[\"治疗之雨\"]] =  true; \r\n\r\nNoSpellTarget[SpellIds[\"灵魂链接图腾\"]] =  true; \r\n\r\n\r\n\r\nBuffName[\"灵魂行者的恩赐\"]=GetSpellInfo(SpellIds[\"灵魂行者的恩赐\"]);\r\n\r\n------\r\namAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n\r\n\r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\nlocal N_71155 = GetSpellInfo(101052); --脱缰雷霆\r\nfunction amIsMoveSpell(Id,unit,name) --处理移动中能施放的技能\r\n\r\n\r\n\tif UnitAura(\"player\", BuffName[\"灵魂行者的恩赐\"]) then \r\n\t\t\r\n\t\treturn true;\r\n\t\t\r\n\telseif amIsGlyphSocketInfo(N_71155) and SpellIds[\"闪电箭\"] == Id then\r\n\t\r\n\t\t\r\n\t\treturn true;\r\n\r\n\tend\r\n\t\r\nend\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true;\r\nend\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId] and true;\r\n\t\r\nend\r\namIsClassLoad = true;\r\n\r\n--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"WARLOCK\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\nSpellIds[\"召唤仪式\"] = \t698;\r\nSpellIds[\"召唤小鬼(召唤)\"] = \t688;\r\nSpellIds[\"召唤虚空行者(召唤)\"] = \t697;\r\nSpellIds[\"召唤地狱猎犬(召唤)\"] = \t691;\r\nSpellIds[\"召唤魅魔(召唤)\"] = \t712;\r\nSpellIds[\"召唤末日守卫(守卫)\"] = \t18540;\r\nSpellIds[\"召唤地狱火(守卫)\"] = \t1122;\r\nSpellIds[\"基尔罗格之眼(召唤)\"] = \t126;\r\nSpellIds[\"恶魔法阵：传送\"] = \t48020;\r\nSpellIds[\"恶魔法阵：召唤\"] = \t48018;\r\n--SpellIds[\"魔甲术\"] = \t687;\r\nSpellIds[\"生命通道\"] = \t755;\r\nSpellIds[\"制造治疗石\"] = \t6201;\r\n--SpellIds[\"制造灵魂石\"] = \t693;\r\nSpellIds[\"暮光结界\"] = \t6229;\r\nSpellIds[\"制造灵魂之井\"] = \t29893;\r\n--SpellIds[\"灵魂收割\"] = \t79268;\r\nSpellIds[\"灵魂燃烧\"] = \t74434;\r\nSpellIds[\"灵魂碎裂\"] = \t29858;\r\n--SpellIds[\"灵魂链接\"] = \t19028;\r\n--SpellIds[\"邪甲术\"] = \t28176;\r\nSpellIds[\"无尽呼吸\"] = \t5697;\r\nSpellIds[\"黑暗灵魂\"] = \t77801;\r\nSpellIds[\"地狱烈焰\"] = \t1949;\r\nSpellIds[\"暗影之怒\"] = \t30283;\r\nSpellIds[\"古尔丹之息\"] = \t47897;\r\nSpellIds[\"浩劫\"] = \t80240;\r\nSpellIds[\"火焰之雨\"] = \t5740;\r\nSpellIds[\"恐惧嚎叫\"] = \t5484;\r\nSpellIds[\"生命分流\"] = \t1454;\r\n--SpellIds[\"恶魔增效\"] = \t47193;\r\nSpellIds[\"恶魔变形\"] = \t36298;\r\n\r\n-------CTM----\r\nSpellIds[\"射击\"]=5019;\r\nSpellIds[\"自动攻击\"]=6603;\r\nSpellIds[\"暴风雪\"]=10;\r\nSpellIds[\"奴役恶魔\"]=1098;\r\nSpellIds[\"放逐术\"]=710;\r\nSpellIds[\"暗影箭\"]=686;\r\nSpellIds[\"灵魂之火\"]=6353;\r\n--SpellIds[\"灼热之痛\"]=5676;\r\nSpellIds[\"烧尽\"]=29722;\r\nSpellIds[\"献祭\"]=348;\r\nSpellIds[\"邪焰\"]=77799;\r\nSpellIds[\"元素诅咒\"]=1490;\r\nSpellIds[\"吸取灵魂\"]=1120;\r\nSpellIds[\"吸取生命\"]=689;\r\nSpellIds[\"恐惧\"]=5782;\r\nSpellIds[\"末日降临(恶魔变形)\"]=603;\r\nSpellIds[\"死亡缠绕\"]=6789;\r\nSpellIds[\"痛楚\"]=980;\r\nSpellIds[\"腐蚀术\"]=172;\r\n--SpellIds[\"虚弱诅咒\"]=702;\r\n--SpellIds[\"语言诅咒\"]=1714;\r\nSpellIds[\"腐蚀之种\"]=27243;\r\n--SpellIds[\"黑暗意图\"]=80398;\r\n\r\n \r\nSpellIds[\"暗影灼烧\"]=17877;  \r\n--SpellIds[\"混乱之箭\"]=50796;  \r\nSpellIds[\"燃烧\"]=17962;\r\n\r\nSpellIds[\"基尔加丹的狡诈\"]=137587;\r\n\r\n\r\n\r\nAM_GCD_SPELLID=SpellIds[\"腐蚀术\"];\r\n------------\r\n\r\n\r\nNoSpellTarget[SpellIds[\"召唤仪式\"]] =  true; --\t698;\r\nNoSpellTarget[SpellIds[\"召唤小鬼(召唤)\"]] =  true; --\t688;\r\nNoSpellTarget[SpellIds[\"召唤虚空行者(召唤)\"]] =  true; --\t697;\r\nNoSpellTarget[SpellIds[\"召唤地狱猎犬(召唤)\"]] =  true; --\t691;\r\nNoSpellTarget[SpellIds[\"召唤魅魔(召唤)\"]] =  true; --\t712;\r\nNoSpellTarget[SpellIds[\"召唤末日守卫(守卫)\"]] =  true; --\t18540;\r\nNoSpellTarget[SpellIds[\"召唤地狱火(守卫)\"]] =  true; --\t1122;\r\nNoSpellTarget[SpellIds[\"基尔罗格之眼(召唤)\"]] =  true; --\t126;\r\nNoSpellTarget[SpellIds[\"恶魔法阵：传送\"]] =  true; --\t48020;\r\nNoSpellTarget[SpellIds[\"恶魔法阵：召唤\"]] =  true; --\t48018;\r\n--NoSpellTarget[SpellIds[\"魔甲术\"]] =  true; --\t687;\r\nNoSpellTarget[SpellIds[\"生命通道\"]] =  true; --\t755;\r\nNoSpellTarget[SpellIds[\"制造治疗石\"]] =  true; --\t6201;\r\n--NoSpellTarget[SpellIds[\"制造灵魂石\"]] =  true; --\t693;\r\nNoSpellTarget[SpellIds[\"暮光结界\"]] =  true; --\t6229;\r\nNoSpellTarget[SpellIds[\"制造灵魂之井\"]] =  true; --\t29893;\r\n--NoSpellTarget[SpellIds[\"灵魂收割\"]] =  true; --\t79268;\r\nNoSpellTarget[SpellIds[\"灵魂燃烧\"]] =  true; --\t74434;\r\nNoSpellTarget[SpellIds[\"灵魂碎裂\"]] =  true; --\t29858;\r\n--NoSpellTarget[SpellIds[\"灵魂链接\"]] =  true; --\t19028;\r\n--NoSpellTarget[SpellIds[\"邪甲术\"]] =  true; --\t28176;\r\nNoSpellTarget[SpellIds[\"无尽呼吸\"]] =  true; --\t5697;\r\nNoSpellTarget[SpellIds[\"黑暗灵魂\"]] =  true; --\t77801;\r\nNoSpellTarget[SpellIds[\"地狱烈焰\"]] =  true; --\t1949;\r\nNoSpellTarget[SpellIds[\"暗影之怒\"]] =  true; --\t30283;\r\nNoSpellTarget[SpellIds[\"古尔丹之息\"]] =  true; --\t47897;\r\n--NoSpellTarget[SpellIds[\"浩劫\"]] =  true; --\t80240;\r\nNoSpellTarget[SpellIds[\"火焰之雨\"]] =  true; --\t5740;\r\nNoSpellTarget[SpellIds[\"恐惧嚎叫\"]] =  true; --\t5484;\r\nNoSpellTarget[SpellIds[\"生命分流\"]] =  true; --\t1454;\r\n--NoSpellTarget[SpellIds[\"恶魔增效\"]] =  true; --\t47193;\r\nNoSpellTarget[SpellIds[\"恶魔变形\"]] =  true; --\t36298;\r\n\r\n\r\n\r\n\r\n amAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n \r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\r\n\t\tif tostring(B) ~= tostring(D) then\r\n\t\t\ttable.insert(SpellErrList, errtext);\r\n\t\tend\r\n\t\t\r\n\tend\r\nend\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true;\r\nend\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId] and true;\r\n\t\r\nend\r\n\r\nfunction amIsMoveSpell(Id,unit,name) --处理移动中能施放的技能\r\n\r\n\t\r\n\tif amTalentInfo(GetSpellInfo(SpellIds[\"基尔加丹的狡诈\"]))  then \r\n\t\t\r\n\t\treturn true;\r\n\r\n\t\r\n\tend\r\n\t\r\nend\r\namIsClassLoad = true;\r\n\r\n--if GetLocale() ~= \"zhCN\" then return; end\r\nif amIsClassLoad then  return; end;\r\nlocal SpellErrList={};\r\n\r\nlocal playerClass, englishClass = UnitClass(\"player\");\r\n\r\nif englishClass ~= \"WARRIOR\" then\r\n\r\n\treturn;\r\nend\r\n\r\n\r\n\r\n\r\n\r\n\r\nlocal BuffName = {};\t\t\t\t--BUFF名称\r\nlocal RaidSpell={};\t\t\t\t\t--施放目标类型（团/队/个人）的技能 团=3,队=2,个人=1\r\nlocal SpellIds={};\t\t\t\t\t-- 技能ID\r\nlocal NoSpellTarget={}; \t\t--无目标标志\r\n\r\n\r\nSpellIds[\"复仇\"] = 6572;\r\nSpellIds[\"压制\"] = 7384;\r\nSpellIds[\"雷霆一击\"] = \t6343;\r\nSpellIds[\"命令怒吼\"] = \t469;\r\nSpellIds[\"战斗怒吼\"] = \t6673;\r\n--SpellIds[\"挑战怒吼\"] = \t1161;\r\nSpellIds[\"挫志怒吼\"] = \t1160;\r\nSpellIds[\"旋风斩\"] = \t1680;\r\nSpellIds[\"狂怒回复\"] = \t55694;\r\nSpellIds[\"狂暴之怒\"] = \t18499;\r\nSpellIds[\"破胆怒吼\"] = \t5246;\r\nSpellIds[\"鲁莽\"] = \t1719;\r\n\r\nSpellIds[\"法术反射\"] = \t23920;\r\nSpellIds[\"盾墙\"] = \t871;\r\nSpellIds[\"盾牌格挡\"] = \t2565;\r\nSpellIds[\"破釜沉舟\"] = \t12975;\r\nSpellIds[\"震荡波\"] = \t46968;\r\nSpellIds[\"防御姿态\"] = \t71;\r\nSpellIds[\"狂暴姿态\"] = \t2458;\r\nSpellIds[\"战斗姿态\"] = \t2457;\r\n\r\nSpellIds[\"横扫攻击\"]  = \t12328;\r\nSpellIds[\"致命平静\"] = \t85730;\r\n--SpellIds[\"击倒\"] = \t85388;\r\nSpellIds[\"剑刃风暴(等级 1)\"] = \t9632;\r\nSpellIds[\"刺耳怒吼\"]  = \t12323;\r\nSpellIds[\"浴血奋战\"]  = \t12292;\r\nSpellIds[\"怒风斩(狂怒)\"]  = \t58390;\r\nSpellIds[\"暴怒\"]  = \t6613;\r\n--SpellIds[\"英勇之怒\"] = \t60970;\r\nSpellIds[\"乘胜追击\"] =  34428;\r\nSpellIds[\"强力制胜雕文\"] =  58104;\r\n\r\nSpellIds[\"巨人打击\"] =  86346;\r\n--SpellIds[\"怒火中烧\"] =  1134;\r\nSpellIds[\"英勇飞跃\"] =  6544;\r\n\r\nSpellIds[\"冲锋\"] = \t100;\r\n\r\nSpellIds[\"援护\"] = \t3411;\r\n--SpellIds[\"拦截\"] = \t20252;\r\n--SpellIds[\"战神\"] =  57499;\r\n\r\nSpellIds[\"猛击\"] =  1464;\r\nSpellIds[\"拳击\"] = \t6552;\r\nSpellIds[\"集结呐喊\"] = \t97462;\r\n\r\n---CTM-\r\nSpellIds[\"射击\"]=3018;\r\n--SpellIds[\"投掷\"]=2764;\r\nSpellIds[\"投掷\"]=122475;\r\nSpellIds[\"攻击\"]=88163;\r\nSpellIds[\"自动攻击\"]=6603;\r\n--SpellIds[\"反击风暴\"]=20230;\r\n--SpellIds[\"撕裂\"]=772;\r\nSpellIds[\"断筋\"]=1715;\r\nSpellIds[\"英勇打击\"]=78;\r\n--SpellIds[\"重击\"]=88161;\r\nSpellIds[\"英勇投掷\"]=57755;\r\nSpellIds[\"碎裂投掷\"]=64382;\r\nSpellIds[\"斩杀\"]=5308;\r\nSpellIds[\"顺劈斩\"]=845;\r\nSpellIds[\"嘲讽\"]=355;\r\nSpellIds[\"破甲攻击\"]=7386;\r\nSpellIds[\"缴械\"]=676\r\n\r\n \r\nSpellIds[\"剑刃风暴\"]=46924;  \r\nSpellIds[\"致死打击\"]=12294; \r\n\r\nSpellIds[\"毁灭打击\"]=20243; \r\nSpellIds[\"盾牌猛击\"]=23922;\r\n\r\n--SpellIds[\"强化断筋\"]=23694;\r\n\r\n------\r\nAM_GCD_SPELLID=SpellIds[\"破甲攻击\"];\r\n\r\nBuffName[\"强力制胜雕文\"] = GetSpellInfo(SpellIds[\"强力制胜雕文\"]);\r\n--BuffName[\"强化断筋\"] = GetSpellInfo(SpellIds[\"强化断筋\"]);\r\n\r\n\r\n\r\nNoSpellTarget[SpellIds[\"雷霆一击\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"命令怒吼\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"战斗怒吼\"]] = \ttrue;\r\n--NoSpellTarget[SpellIds[\"挑战怒吼\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"挫志怒吼\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"旋风斩\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"狂怒回复\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"狂暴之怒\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"破胆怒吼\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"鲁莽\"]] = \ttrue;\r\n\r\nNoSpellTarget[SpellIds[\"法术反射\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"盾墙\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"盾牌格挡\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"破釜沉舟\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"震荡波\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"防御姿态\"]] = true;\r\nNoSpellTarget[SpellIds[\"狂暴姿态\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"战斗姿态\"]] = \ttrue;\r\n\r\n\r\n\r\nNoSpellTarget[SpellIds[\"致命平静\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"剑刃风暴(等级 1)\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"刺耳怒吼\"]]  = \ttrue;\r\nNoSpellTarget[SpellIds[\"浴血奋战\"]]  = \ttrue;\r\nNoSpellTarget[SpellIds[\"暴怒\"]]  = \ttrue;\r\n--NoSpellTarget[SpellIds[\"英勇之怒\"]] = \ttrue;\r\n\r\n--NoSpellTarget[SpellIds[\"怒火中烧\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"英勇飞跃\"]] = \ttrue;\r\nNoSpellTarget[SpellIds[\"集结呐喊\"]] = \ttrue;\r\n\r\n-------CTM---\r\n\r\n--NoSpellTarget[SpellIds[\"反击风暴\"]] = \ttrue;\r\n\r\n\r\n-----------\r\n\r\n\r\namAllClassInf(SpellIds,NoSpellTarget,BuffNames);\r\n\r\nlocal function TsetSpellIdAddLineList(menu,A,B,C,D,E,str,err)\r\n-- 表格内容行\r\n\tif not amAllClassIgnoreInf(A,E) then return false; end;\r\n\tif menu then\r\n\t\tmenu:AddLine(\r\n\t\t\t\t\t\t\r\n\t\t\t\"text1\", \"|cff00ffff\" .. A, \r\n\t\t\t\"text2\", \"|cff00ffff\" .. B,\r\n\t\t\t\"text3\", \"|cffff0000\" .. C,\r\n\t\t\t\"text4\", \"|cffffff00\" .. D,\r\n\t\t\t\"text5\", E,\r\n\t\t\t\"tooltipText\",str\r\n\t\t)\r\n\t\t\r\n\t\twowam.spell.ErrorText= wowam.spell.ErrorText .. \";  \" .. err;\r\n\t\t\r\n\telse\r\n\t\r\n\t\tlocal errtext =\"|cff00ffff\" .. A .. \"  \" .. \"|cff00ffff\" .. B .. \"  \" .. \"|cffff0000\" .. C .. \"  \" .. \"|cffffff00\" .. D .. \"  |r\" .. E;\r\n\t\t\r\n\t\ttable.insert(SpellErrList, errtext);\r\n\t\t\r\n\tend\r\nend\r\n\r\nlocal function TsetSpellId(TBL,menu)\r\n\t\r\n\tlocal str;\r\n\tlocal err = \"\";\r\n\t\r\n\tfor i,v in pairs(TBL) do\r\n\t\t\r\n\t\tlocal name = amGetSpellName(v);\r\n\t\t\r\n\t\tif not name then\r\n\t\t\t--print(wowam.Colors.MAGENTA  .. \"技能ID错误1:\" .. i )\r\n\t\t\tstr = \"ID无效\"\r\n\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. \"\"..\",\" .. str\r\n\t\t\tTsetSpellIdAddLineList(menu,i,v,v,\"\",\"ID无效\",str,err);\r\n\t\telse\r\n\t\t\tif name ~= i then\r\n\t\t\t\t\r\n\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"名称错误:\" )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误:|r\" .. i  )\r\n\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确:|r\" .. name  )\r\n\t\t\t\tstr = \"ID对照不了原来的名称\"\r\n\t\t\t\terr =i .. \",\" .. v .. \",\" .. i .. \",\" .. name..\",\" .. str\r\n\t\t\t\tTsetSpellIdAddLineList(menu,i,v,i,name,\"名称错误\",str,err);\r\n\t\t\t\t\r\n\t\t\telse\r\n\t\t\t\t\r\n\t\t\t\tlocal ID =amPlayerSpellId(i);\r\n\t\t\t\r\n\t\t\t\tif ID and ID ~= v then\r\n\t\t\t\t\t\r\n\t\t\t\t\t--local spellLink=GetSpellLink(v);\r\n\t\t\t\t\t--print(wowam.Colors.MAGENTA  .. \"ID错误:\" .. i )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"错误|r:\" .. v  )\r\n\t\t\t\t\t--print(wowam.Colors.CYAN  .. \"正确|r:\" .. ID  )\r\n\t\t\t\t\tstr = \"通过原来的名称获得ID，但和原来设定不一样。\"\r\n\t\t\t\t\terr =i .. \",\" .. v .. \",\" .. v .. \",\" .. ID..\",\" .. str\r\n\t\t\t\t\tTsetSpellIdAddLineList(menu,i,v,v,ID,\"ID错误\",str,err);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tend\r\n\t\t\t\t\r\n\t\t\tend\r\n\t\tend\r\n\t\t\r\n\tend\r\n\r\nend\r\n\r\n\r\nfunction amTsetSpellId(menu)\r\n\twowam.spell.ErrorText=\"\";\r\n\tSpellErrList={};\r\n\tTsetSpellId(SpellIds,menu);\r\n\t\r\n\tif not menu then\r\n\t\t\r\n\t\tif #SpellErrList>0 then\r\n\t\t\tprint(\"|cffff0000技能对照错误:|cffffff00请和管理员联繫解决\\n\");\r\n\t\t\r\n\t\t\tfor i,v in pairs(SpellErrList) do\r\n\t\t\t\tprint(i..\".\",v);\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\tprint(\"\\n|cffffff00共(\" .. #SpellErrList .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\t\r\n\t\tend\r\n\t\r\n\tend\r\n\t\r\n\tlocal tbl = amTestSpellBook(SpellIds);\r\n\t\r\n\t\r\n\t\r\n\tif #tbl>0 then\r\n\t\tprint(\"|cffff0000技能信息缺乏:|cffffff00请和管理员联繫解决\\n\");\r\n\t\r\n\t\tfor i,v in pairs(tbl) do\r\n\t\t\t\r\n\t\t\tlocal SpellLink = GetSpellLink(v);\r\n\t\t\t\r\n\t\t\tlocal spellName =amGetSpellName(v);\r\n\t\t\t\r\n\t\t\tprint(i..\".\",SpellLink);\r\n\t\t\t\r\n\t\t\tif menu then\r\n\t\t\t\tTsetSpellIdAddLineList(menu,spellName,v,\"\",\"\",\"缺乏技能说明\",\"\",'SpellIds[\"' ..spellName .. '\"]=' .. v )\r\n\t\t\tend\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tend\r\n\t\t\r\n\t\tprint(\"\\n|cffffff00共(\" .. #tbl .. \")错误，请在【技能错误信息】菜单哪里提取信息发给我。\");\r\n\t\r\n\tend\r\n\r\n\t\r\nend\r\n\r\n\r\n\r\nfunction amIsActivation(Id,unit) --处理被激活技能\r\n\r\n\treturn true;\r\nend\r\n\r\n\r\n\r\n\r\nfunction amIsNoSpellTarget(SpellId) --技能是否是有无目标标志\r\n\r\n\treturn NoSpellTarget[SpellId] and true\r\nend\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction amIsRaidSpell(spellId)\r\n\t\r\n\treturn RaidSpell[spellId];\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\n\r\nfunction amIsCurrentSpell(spellId)\r\n\r\n\tlocal spellNameX, spellSubNameX =GetSpellInfo(spellId);\r\n\t\r\n\tif not spellSubNameX then\r\n\t\tspellSubNameX=\"\";\r\n\tend\r\n\tlocal i = 1;\r\n\twhile true do\r\n\t\r\n\t\tspellName, spellSubName = GetSpellBookItemName(i, BOOKTYPE_SPELL)\r\n\t\tif not spellSubName then\r\n\t\t\tspellSubName=\"\";\r\n\t\tend\r\n\t\t\r\n\t\tif not spellName then\r\n\t\t  do break end\r\n\t\tend\r\n   \r\n\t\tif spellName == spellNameX and spellSubName == spellSubNameX then\r\n\r\n\t\t\t\r\n\t\t\tdo break end\r\n\t\t\r\n\t\tend\r\n   \r\n\t\ti = i + 1\r\n\tend\r\n\t\r\n\treturn IsCurrentSpell(i,BOOKTYPE_SPELL) ;\r\n\t\t\t\r\n\r\nend\r\n\r\n\r\nfunction amIsMoveSpell(Id,unit,name) --处理移动中能施放的技能\r\n\r\n\r\n\tif Id == SpellIds[\"猛击\"] then \r\n\t\t\r\n\t\treturn true;\r\n\r\n\tend\r\n\t\r\nend\r\n\r\n\r\n\r\n\r\namIsClassLoad = true;\r\n\r\n\r\n\r\n")
end

function UnlockerInitialize()
LoadCommonScript()
LoadClassSpecifitScript()
end
 